ğŸš€ å¦‚ä½•ä½¿ç”¨
===================================


1. å®‰è£…gotrackit
--------------------

å®‰è£…å‰ç¡®ä¿pythonç¯å¢ƒä¸­æœ‰ä»¥ä¸‹å‰ç½®ä¾èµ–åº“ï¼Œæ‹¬å·ä¸­ä¸ºä½œè€…ä½¿ç”¨ç‰ˆæœ¬(åŸºäºpython3.11)ï¼Œä»…ä¾›å‚è€ƒ

* geopy(2.4.1)

* gdal(3.4.3)

* shapely(2.0.3)

* fiona(1.9.5)

* pyproj(3.6.1)

* geopandas(0.14.3)

* networkx(3.2.1)

* pandas(2.0.3)

* numpy(1.26.2)

* keplergl(0.3.2)


ä½¿ç”¨pipå®‰è£… ::

    pip install -i https://pypi.org/simple/ gotrackit


å·²ç»å®‰è£…ï¼Œå¯ä»¥å‡çº§å·²æœ‰ç‰ˆæœ¬ ::

    pip install --upgrade  -i https://pypi.org/simple/ gotrackit



2. ç®—æ³•åŒ…æ¦‚è§ˆ
--------------------

2.1. æ¨¡å—æ¦‚è§ˆ
````````````````

åŒ…æ‹¬äº†äº”ä¸ªæ¨¡å—ï¼š`è·¯ç½‘ç”Ÿäº§`_ ã€`GPSæ•°æ®ç”Ÿäº§`_ ã€`GPSæ•°æ®è¡Œç¨‹åˆ‡åˆ†`_ ã€`åœ°å›¾åŒ¹é…`_ ä»¥åŠ `åŒ¹é…è¿‡ç¨‹å¯è§†åŒ–`_ ã€‚



.. _è·¯ç½‘ç”Ÿäº§:

2.1.1. è·¯ç½‘ç”Ÿäº§
::::::::::::::::::::::::::

.. note::

   é€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘ä¸¥ç¦ç”¨äºå•†ä¸šè¡Œä¸ºï¼Œä»…é™äºæ•™è‚²ä»¥åŠç§‘å­¦ç ”ç©¶ã€‚


è·¯ç½‘ç”Ÿäº§å·¥å…·ç”¨äºå¸®åŠ©ç”¨æˆ·è·å–è·¯ç½‘æ•°æ®ï¼Œä»¥åŠå¯¹è·¯ç½‘æ•°æ®è¿›è¡Œå„ç§æ£€æŸ¥ä¸ä¼˜åŒ–ï¼Œä½ åªéœ€å¯¥å¯¥å‡ è¡Œä»£ç ä¾¿å¯ä»¥è·å¾—è·¯ç½‘æ•°æ®ã€‚

è·¯ç½‘ç”Ÿäº§çš„ä¸»è¦æµç¨‹ä¸ºï¼šä¾æ®ç ”ç©¶åŒºåŸŸèŒƒå›´æ„é€ OD --> åŸºäºODè¯·æ±‚è·¯å¾„è§„åˆ’ --> åŸºäºè·¯å¾„è§„åˆ’ç»“æœæ‰§è¡Œç©ºé—´ä¼˜åŒ–å®ç°è·¯ç½‘é€†å‘

.. image:: _static/images/netreverse_tech_way.png
    :align: center

--------------------------------------------------------------------------------

æœ¬å¼€æºåŒ…å°†ç›¸å…³çš„æ–¹æ³•éƒ½å°è£…ä¸ºäº†æ ‡å‡†å‡½æ•°æ¥å£ï¼Œæ‚¨åªç”¨æä¾›ä¸€ä¸ªkeyä¾¿å¯ä»¥è¿›è¡Œä¸­å›½å¢ƒå†…ä»»æ„åŒºåŸŸè·¯ç½‘çš„è·å–ã€‚


* æ„é€ OD
    æä¾›åŸºäºä»»æ„å½¢çŠ¶åŒºåŸŸéšæœºæ„é€ ODçš„æ–¹æ³•ï¼›

    æä¾›åŸºäºåœ°å—æ„é€ å½¢å¿ƒå‡ºè¡ŒODçš„æ–¹æ³•ï¼›

    æä¾›åŸºäºGPSæ•°æ®ç²¾å‡†æ„é€ å¸¦é€”å¾„ç‚¹ODçš„æ–¹æ³•ï¼›

    æ”¯æŒè‡ªå®šä¹‰æ„é€ ODã€‚

.. _od_type:

.. image:: _static/images/od_gen.png
    :align: center

--------------------------------------------------------------------------------

ä¸‰å¼ å›¾åˆ†åˆ«å¯¹åº”od_typeå‚æ•°ä¸ºrand_odã€region_odã€gps_based

æ„é€ ODéå¸¸é‡è¦ï¼Œå› ä¸ºODæ„é€ çš„è¶Šç²¾å‡†ï¼Œè·¯å¾„è§„åˆ’æ‰€è¦†ç›–çš„é“è·¯è·¯æ®µå°±è¶Šå…¨é¢ï¼Œæˆ‘ä»¬å¾—åˆ°çš„è·¯ç½‘è¦†ç›–ç‡å°±è¶Šé«˜ã€‚

.. _ODè¡¨è¦æ±‚:

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ODï¼Œè¯·æä¾›ä»¥ä¸‹å­—æ®µè¦æ±‚çš„ODè¡¨ï¼š

.. csv-table:: ODè¡¨å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 5, 40

    "od_id","int","ODå”¯ä¸€ç¼–ç ï¼Œä¸å…è®¸ä¸ºç©º"
    "o_x","float","èµ·ç‚¹ç»åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "o_y","float","èµ·ç‚¹çº¬åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "d_x","float","ç»ˆç‚¹ç»åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "d_y","float","ç»ˆç‚¹çº¬åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "hh","int","è¯·æ±‚æ—¶æ®µ(0~23)ï¼Œå¦‚æœå¯¹æ¯ä¸ªODæœ‰å…·ä½“çš„è¯·æ±‚æ—¶æ®µé™åˆ¶ï¼Œè¯·ç¡®ä¿æœ‰è¯¥åˆ—ï¼Œä¸”å°†ignore_hhç½®ä¸ºFalseï¼Œä¸å…è®¸æœ‰ç©ºå€¼ï¼›å¦‚æœæ²¡æœ‰æ—¶æ®µé™åˆ¶, è¯¥åˆ—å¯ä»¥ä¸æä¾›"
    "way_points","string","é€”å¾„ç‚¹åæ ‡ä¸²ï¼Œæœ€å¤šæ”¯æŒ10ä¸ªé€”å¾„ç‚¹ï¼Œå…è®¸ä¸ºç©ºå€¼"

æ ·ä¾‹ODæ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: ODæ ·ä¾‹æ•°æ®
    :header: "od_id", "o_x", "o_y", "d_x", "d_y", "way_points"
    :widths: 3, 5, 5, 5, 5, 10

    "1","120.73054930354505","31.672649340942495","120.73338512634608","31.667515168299673","120.73176445980103,31.6705214428833"
    "2","120.73050669059927","31.666431974714015","120.74717247617396","31.669917988588765","120.73119124695165,31.666929583950083;120.7380010705855,31.66916745090122"
    "3", "120.74229535581601","31.660716341555","120.74250979515529","31.652820575113125",""

--------------------------------------------------------------------------------


* è·¯å¾„è§„åˆ’è¯·æ±‚
    æ‚¨åªéœ€è¦ç”³è¯·ä¸€ä¸ª `å¼€å‘è€…key <https://lbs.amap.com>`_ ï¼›

    æ”¯æŒè‡ªç”±è¯·æ±‚ã€æŒ‰ç…§æ—¶æ®µè¯·æ±‚ã€‚


* ç©ºé—´ä¼˜åŒ–
    è·¯å¾„æ‹†åˆ†ï¼šåŸºäºè·¯å¾„æ‹“æ‰‘ç‚¹æ‹†åˆ†æœ€å°è·¯æ®µï¼›

    æ‹“æ‰‘å…³è”ï¼šç”Ÿäº§ç‚¹å±‚ï¼Œæ·»åŠ æ‹“æ‰‘å…³ç³»ï¼›

    è·¯æ®µæ‹“æ‰‘ä¼˜åŒ–ï¼šä»¥ä¸€å®šçš„é™åˆ¶è§„åˆ™å°†è·¯æ®µè¿›è¡Œåˆå¹¶ï¼Œæ”¯æŒå±æ€§é™åˆ¶ã€ç´¯è®¡é•¿åº¦é™åˆ¶ã€æœ€å¤§è½¬è§’é™åˆ¶ã€ç¯æ£€æµ‹ï¼›

    é‡å è·¯æ®µè¯†åˆ«ï¼šéƒ¨åˆ†è·¯å¾„è·ç¦»éå¸¸è¿‘ï¼Œä½†æ˜¯å´æ²¡æœ‰å®Œå…¨é‡åˆï¼Œæœ¬åŒ…å¯ä»¥è¿›è¡Œè¯†åˆ«ä¸ä¼˜åŒ–ï¼›

    è”é€šæ€§æ ¡å‡†ï¼šè¯†åˆ«è·¯ç½‘ä¸­æ½œåœ¨çš„ä¸è¿é€šèŠ‚ç‚¹å¹¶è¿›è¡Œå¤„ç†ã€‚


ç©ºé—´ä¼˜åŒ–çš„ç›¸å…³ç±»å‚æ•°å¯è§ï¼š:doc:`ç±»æ–¹æ³•æ±‡æ€»`


ç©ºé—´ä¼˜åŒ–çš„å…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢ï¼š`ä»è·¯å¾„è§„åˆ’æ¥å£é€†å‘è·¯ç½‘çš„ä¸€ç§æ–¹æ³• <https://juejin.cn/post/7268187099526152247>`_


å…·ä½“çš„ä»£ç å®æ“è§ `è·¯ç½‘ç”Ÿäº§ä»£ç ç¤ºä¾‹`_


.. _GPSæ•°æ®ç”Ÿäº§:

2.1.2. GPSæ•°æ®ç”Ÿäº§
::::::::::::::::::::::::::

è¯¥æ¨¡å—ä¾æ‰˜è·¯ç½‘æ–‡ä»¶æ¨¡æ‹Ÿè½¦è¾†è¡Œé©¶å¹¶ä¸”äº§ç”ŸGPSæ•°æ®ï¼Œå½“ç”¨æˆ·æ²¡æœ‰å®é™…GPSæ•°æ®æ—¶å¯ä»¥å€ŸåŠ©è¯¥æ¨¡å—ç”Ÿäº§GPSæ•°æ®ã€‚


åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/GpsGenGraph.png
    :align: center

----------------------------------------

å…·ä½“çš„ä»£ç å®æ“è§ `GPSæ•°æ®ç”Ÿäº§ä»£ç ç¤ºä¾‹`_ ã€‚


.. _GPSæ•°æ®è¡Œç¨‹åˆ‡åˆ†:

2.1.3. GPSæ•°æ®è¡Œç¨‹åˆ‡åˆ†
::::::::::::::::::::::::::

ä¸»è¡Œç¨‹ä¸¾ä¾‹ï¼š ä¸€è¾†è½¦ä»å®¶å‡ºå‘åˆ°è¾¾å…¬å¸ï¼Œå°†è½¦è¾†åœåœ¨è½¦åº“ï¼Œç†„ç«åï¼Œè½¦è¾†ä¸å†äº§ç”ŸGPSæ•°æ®ï¼Œä¸‹ç­åå†æ¬¡å¯åŠ¨ï¼ŒGPSæ•°æ®é‡æ–°äº§ç”Ÿï¼Œæ—©ä¸Šåˆ°è¾¾å…¬å¸çš„æœ€åä¸€ä¸ªå®šä½ç‚¹å’Œä¸‹ç­åå¯åŠ¨è½¦è¾†çš„ç¬¬ä¸€ä¸ªå®šä½ç‚¹ï¼Œå…¶æ—¶é—´å·®è¶…è¿‡group_gap_thresholdï¼Œåˆ™åœ¨æ­¤å¤„åˆ‡åˆ†ä¸»è¡Œç¨‹

å­è¡Œç¨‹ä¸¾ä¾‹ï¼š ä¸€è¾†è½¦ä»å®¶å‡ºå‘åˆ°è¾¾å…¬å¸ï¼Œåœ¨åˆ°è¾¾å…¬å¸ä¹‹å‰ï¼Œåœ¨åŠ æ²¹ç«™åŠ æ²¹ï¼ŒGPSç‚¹æŒç»­äº§ç”Ÿï¼Œä½†æ˜¯å®šä½ç‚¹é›†ä¸­åœ¨åŠ æ²¹ç«™é™„è¿‘ï¼Œäº§ç”Ÿäº†åœç•™ï¼Œé‚£ä¹ˆä»å®¶-åŠ æ²¹ç«™å°±æ˜¯ä¸€æ®µå­è¡Œç¨‹

å…·ä½“çš„ä»£ç å®æ“è§ `è¡Œç¨‹åˆ‡åˆ†ä»£ç ç¤ºä¾‹`_


.. _åœ°å›¾åŒ¹é…:

2.1.4. åœ°å›¾åŒ¹é…
::::::::::::::::::::::::::

ä¾æ‰˜è·¯ç½‘æ–‡ä»¶ã€GPSæ•°æ®ï¼Œå¯¹GPSæ•°æ®è¿›è¡Œåœ°å›¾åŒ¹é…ï¼ŒåŒ¹é…ç»“æœç»™å‡ºæ¯ä¸ªGPSç‚¹å®é™…çš„åŒ¹é…è·¯æ®µä¿¡æ¯ã€‚

åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/MatchGraph.png
    :align: center

----------------------------------------

å…·ä½“çš„ä»£ç å®æ“è§ `åœ°å›¾åŒ¹é…ä»£ç ç¤ºä¾‹`_ ã€‚


.. _åŒ¹é…è¿‡ç¨‹å¯è§†åŒ–:

2.1.5. keplerå¯è§†åŒ–
::::::::::::::::::::::::::


å°†åŒ¹é…ç»“æœç»Ÿä¸€è¾“å‡ºåˆ°HTMLæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶æ’­æ”¾åŒ¹é…åŠ¨ç”»ã€‚

åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/visualization.png
    :align: center

----------------------------------------


å…·ä½“çš„ä»£ç å®æ“è§ä¸‹æ–‡ç¤ºä¾‹ä»£ç ã€‚


2.2. æ•°æ®è¦æ±‚
````````````````

è¿™ä¸‰ä¸ªæ¨¡å—æ‰€æ¶‰åŠçš„æ•°æ®è¯´æ˜å¦‚ä¸‹ï¼š

2.2.1. è·¯ç½‘æ•°æ®
::::::::::::::::::::::::::

.. _è·¯ç½‘æ•°æ®è¦æ±‚:

è·¯ç½‘ç”±çº¿å±‚æ–‡ä»¶å’Œç‚¹å±‚æ–‡ä»¶ç»„æˆï¼Œä¸¤ä¸ªæ–‡ä»¶å­˜åœ¨å…³è”å…³ç³»ã€‚`è¥¿å®‰æ ·ä¾‹è·¯ç½‘ <https://github.com/zdsjjtTLG/TrackIt/tree/main/data/input/net/xian>`_


(1) è·¯ç½‘-ç‚¹å±‚
'''''''''''''

ä¸€èˆ¬æ˜¯shpæ–‡ä»¶æˆ–è€…geojsonæ–‡ä»¶ï¼Œè·¯ç½‘ç‚¹å±‚æ–‡ä»¶å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: èŠ‚ç‚¹å±‚å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 15, 40

    "node_id","int","èŠ‚ç‚¹å”¯ä¸€ç¼–ç , ä¸€å®šæ˜¯å¤§äº0çš„æ­£æ•´æ•°"
    "geometry","geometry","èŠ‚ç‚¹åæ ‡å‡ ä½•åˆ—"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."

æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: èŠ‚ç‚¹æ ·ä¾‹æ•°æ®
    :header: "node_id", "geometry"
    :widths: 3, 20

    "4290","POINT (108.84059274796762 34.20380728755708)"
    "7449","POINT (108.83996876020116 34.20398312458892)"
    "19893","POINT (108.8410333043887 34.20538952458989)"
    "22765","POINT (108.8396462868452 34.20358068920948)"
    "29974","POINT (108.84304743483109 34.20477124733548)"
    "31762","POINT (108.84007099594207 34.20303962600771)"
    "34152","POINT (108.84337595161946 34.20450390550994)"
    "44441","POINT (108.8435151462407 34.204686083275455)"
    "63637","POINT (108.8415703783543 34.20233450491169)"
    "68869","POINT (108.842021912175 34.20431362229388)"
    "82793","POINT (108.84178453991281 34.204420171642816)"
    "91199","POINT (108.84129068661863 34.20558291058989)"
    "92706","POINT (108.84207500541686 34.2041637658475)"
    "118381","POINT (108.84208596575294 34.20486654570958)"
    "122487","POINT (108.84210722600966 34.20202954576994)"
    "124862","POINT (108.83952308374874 34.20369843029777)"
    "145105","POINT (108.84239758378014 34.20309169152201)"
    "166381","POINT (108.84139277469502 34.20644679433629)"
    "169462","POINT (108.84160833213731 34.20363712972413)"
    "170508","POINT (108.841425074665 34.203330912749905)"
    "177594","POINT (108.84176365682967 34.202564765029564)"
    "181808","POINT (108.84049555540867 34.20432194107051)"
    "191714","POINT (108.84048418194278 34.208751404812496)"
    "198856","POINT (108.84627615033686 34.205495498912406)"
    "199563","POINT (108.84081270761097 34.208564048548254)"

.. note::

   ç‚¹å±‚è¡¨çš„geometryå­—æ®µä¸­ä¸å…è®¸å‡ºç°MultiPointç±»å‹ï¼Œä¸æ”¯æŒä¸‰ç»´åæ ‡ã€‚



(2) è·¯ç½‘-çº¿å±‚
'''''''''''''

ä¸€èˆ¬æ˜¯shpæ–‡ä»¶æˆ–è€…geojsonæ–‡ä»¶ï¼Œè·¯ç½‘çº¿å±‚æ–‡ä»¶å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: çº¿å±‚å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 10, 10, 30

    "link_id","int","è·¯æ®µå”¯ä¸€ç¼–ç , ä¸€å®šæ˜¯å¤§äº0çš„æ­£æ•´æ•°"
    "from_node","int","è·¯æ®µæ‹“æ‰‘èµ·ç‚¹èŠ‚ç‚¹ç¼–å·, ä¸€å®šæ˜¯å¤§äº0çš„æ­£æ•´æ•°"
    "to_node","int","è·¯æ®µæ‹“æ‰‘ç»ˆç‚¹èŠ‚ç‚¹ç¼–å·, ä¸€å®šæ˜¯å¤§äº0çš„æ­£æ•´æ•°"
    "dir","int","è·¯æ®µæ–¹å‘ï¼Œå–å€¼ä¸º0æˆ–è€…1ï¼Œ 0ä»£è¡¨åŒå‘é€šè¡Œï¼Œ1ä»£è¡¨é€šè¡Œæ–¹å‘ä¸ºè·¯æ®µæ‹“æ‰‘æ­£å‘"
    "length","float","è·¯æ®µé•¿åº¦ï¼Œå•ä½ç±³"
    "geometry","geometry","è·¯æ®µå‡ ä½•çº¿å‹"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."



æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: çº¿å±‚æ ·ä¾‹æ•°æ®
    :header: "link_id", "dir", "length", "from_node", "to_node", "road_name", "geometry"
    :widths: 5, 5,5,5,5,5,40

    "50542","1","379.03","191714","19893","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.84048418194278 34.208751404812496, 108.8410333043887 34.20538952458989)"
    "50545","1","112.13","170508","63637","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.841425074665 34.203330912749905, 108.8415703783543 34.20233450491169)"
    "91646","1","120.66","177594","169462","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84176365682967 34.202564765029564, 108.84160833213731 34.20363712972413)"
    "117776","1","91.19","22765","4290","ç§‘æŠ€å…«è·¯","LINESTRING (108.8396462868452 34.20358068920947, 108.84059274796762 34.20380728755708)"
    "117777","1","142.87","4290","92706","ç§‘æŠ€å…«è·¯","LINESTRING (108.84059274796762 34.20380728755708, 108.84207500541686 34.2041637658475)"
    "225724","1","126.28","92706","34152","ç§‘æŠ€å…«è·¯","LINESTRING (108.84207500541686 34.2041637658475, 108.84337595161946 34.20450390550994)"
    "353809","1","309.67","198856","29974","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84627615033686 34.205495498912406, 108.84304743483109 34.20477124733548)"
    "353810","1","123.30","29974","82793","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84304743483109 34.20477124733548, 108.84178453991281 34.204420171642816)"
    "50543","1","232.85","19893","170508","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.8410333043887 34.20538952458989, 108.84113550636526 34.204842890573545, 108.841425074665 34.203330912749905)"
    "60333","1","131.43","19893","181808","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.8410333043887 34.20538952458989, 108.84097922452833 34.2053414459058, 108.8409571929787 34.20530941808315, 108.84094718092301 34.205266415141416, 108.84093116775695 34.205121436415766, 108.84088210545373 34.20495040838689, 108.84082903440334 34.20481036268511, 108.84074291369149 34.204649265874245, 108.84062975122784 34.20448312297699, 108.84049555540867 34.20432194107051)"
    "60342","1","114.48","181808","124862","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84049555540867 34.20432194107051, 108.84036636411828 34.20419775516095, 108.84024318008004 34.20409657182006, 108.84004387862637 34.203972261359624, 108.83952308374874 34.20369843029777)"
    "72528","1","144.36","44441","68869","ç§‘æŠ€å…«è·¯","LINESTRING (108.8435151462407 34.204686083275455, 108.84276803395724 34.20449685714005, 108.842021912175 34.20431362229388)"
    "72530","1","241.31","68869","124862","ç§‘æŠ€å…«è·¯","LINESTRING (108.842021912175 34.20431362229388, 108.84045752847501 34.20392001061749, 108.83999080892261 34.20380622377766, 108.83952308374874 34.20369843029777)"
    "91647","1","219.39","169462","91199","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84160833213731 34.20363712972413, 108.84159129993026 34.20371207446149, 108.84158127801764 34.20379302941826, 108.84129068661863 34.20558291058989)"
    "91650","1","336.01","91199","199563","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84129068661863 34.20558291058989, 108.8412796652767 34.20563687282872, 108.8412686439326 34.205690835063145, 108.84115642068461 34.20631242560034, 108.84081270761097 34.208564048548254)"
    "117778","1","210.78","92706","145105","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84207500541686 34.2041637658475, 108.84246760555624 34.204148454345315, 108.84259079504238 34.204121677386546, 108.84270897833433 34.204073898662514, 108.84278409570048 34.20403104344158, 108.84285420666204 34.203972184904536, 108.84290829376307 34.20390730060347, 108.84296138178485 34.20381142505641, 108.84298842958638 34.20372550103973, 108.84300445983821 34.203650554222975, 108.8430044667493 34.203564583429824, 108.84298844855175 34.20348958118876, 108.84295640699884 34.20340355495798, 108.84291334698771 34.20333950217767, 108.84283823977152 34.203258399651446, 108.84274109807303 34.203189254785585, 108.84262893217804 34.20313507862982, 108.84249973838324 34.20310286525956, 108.84239758378014 34.20309169152201)"
    "117796","1","101.54","145105","169462","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84239758378014 34.20309169152201, 108.84226337833424 34.20310245441332, 108.84214018818257 34.20312823114287, 108.84201599437151 34.20317699810311, 108.84191984203596 34.20324080868778, 108.84186074674892 34.20329968553512, 108.84168846217199 34.20355129904852, 108.84166642567236 34.203584249318894, 108.84160833213731 34.20363712972413)"
    "142834","1","137.18","44441","118381","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.8435151462407 34.204686083275455, 108.84286516861593 34.20465297225673, 108.84270392291693 34.20466868749383, 108.84255369259174 34.20469541771726, 108.8423543849143 34.204749053102546, 108.84220415103883 34.204807771645406, 108.84208596575294 34.20486654570958)"
    "142840","1","109.65","118381","91199","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84208596575294 34.20486654570958, 108.84193572856508 34.20495725275265, 108.84187062536941 34.20500012448543, 108.84174241973271 34.205111862398475, 108.84152206339351 34.2053314019811, 108.84138183320681 34.205508095978935, 108.84129068661863 34.20558291058989)"
    "313011","1","185.48","170508","31762","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.841425074665 34.203330912749905, 108.84138201087228 34.20329884814687, 108.8413549721588 34.20326181330508, 108.84133394278078 34.20322378932678, 108.84130691144021 34.20309478566952, 108.84126886083386 34.20299375316963, 108.84121578539629 34.2029126874992, 108.84113566851988 34.20282657599954, 108.84107557946284 34.2027784867213, 108.84098444236022 34.20272934315392, 108.84090432074107 34.20269821275392, 108.84078013032108 34.202671003329115, 108.84065193124133 34.202670777488386, 108.84052272903759 34.202686544240095, 108.8404205674005 34.20271835309855, 108.84031840430188 34.20276615639653, 108.84024328324365 34.202814007367984, 108.84015714222738 34.20289482758925, 108.8401090614738 34.20296471879859, 108.84007099594207 34.20303962600771)"
    "313030","1","107.96","31762","4290","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84007099594207 34.20303962600771, 108.84004995701892 34.20311456333897, 108.84003893335381 34.20319451669712, 108.84004393467363 34.203275498082384, 108.8400609552723 34.203350502775116, 108.8401090222339 34.20345255324469, 108.8401681085395 34.20352763233158, 108.8402271964761 34.2035817184994, 108.84032334095258 34.20365086500884, 108.84044152120677 34.20370005708676, 108.84059274796762 34.20380728755708)"
    "336493","1","268.77","122487","82793","è¥¿ä¸‰ç¯è¾…è·¯","LINESTRING (108.84210722600966 34.20202954576994, 108.84186570306134 34.20393847725639, 108.84178453991281 34.204420171642816)"
    "336495","1","229.43","82793","166381","è¥¿ä¸‰ç¯è¾…è·¯","LINESTRING (108.84178453991281 34.204420171642816, 108.84169935963888 34.205036812701614, 108.84162421311767 34.20542354934598, 108.84139277469502 34.20644679433629)"
    "353811","1","175.06","82793","7449","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84178453991281 34.204420171642816, 108.8409632885549 34.20423679420731, 108.83996876020116 34.20398312458892)"


.. note::

   çº¿å±‚è¡¨çš„geometryå­—æ®µä¸­ä¸å…è®¸å‡ºç°MultiLineStringç±»å‹ï¼Œåªå…è®¸LineStringç±»å‹ï¼Œä¸æ”¯æŒä¸‰ç»´åæ ‡ã€‚



(3) ç‚¹å±‚ã€çº¿å±‚å…³è”å…³ç³»
''''''''''''''''''''''''''

æŒ‰ç…§ä»¥ä¸Šæ ·ä¾‹æ•°æ®å‡†å¤‡è·¯ç½‘æ–‡ä»¶ï¼Œshpã€geojsonç­‰æ ¼å¼éƒ½å¯ä»¥ã€‚

æ ·ä¾‹æ•°æ®åœ¨QGIS(æˆ–è€…TransCADç­‰å…¶ä»–GISè½¯ä»¶)ä¸­è¿›è¡Œå¯è§†åŒ–ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š

.. image:: _static/images/sample_net.png
    :align: center

* çº¿å±‚dirå­—æ®µä¸æ‹“æ‰‘æ–¹å‘
    çº¿å±‚çš„ç®­å¤´æ–¹å‘ä¸ºæ‹“æ‰‘æ–¹å‘(å³linkå±‚geometryä¸­çš„æŠ˜ç‚¹è¡Œè¿›æ–¹å‘)ï¼Œdirå­—æ®µæ‰€æè¿°çš„è¡Œè½¦æ–¹å‘å°±æ˜¯ä¸ä¹‹å…³è”çš„ï¼Œdirä¸º1ä»£è¡¨è¯¥æ¡linkæ˜¯å•å‘è·¯æ®µï¼Œè¡Œè½¦æ–¹å‘ä¸æ‹“æ‰‘æ–¹å‘ä¸€è‡´ï¼Œdirä¸º0ä»£è¡¨è¯¥æ¡linkæ˜¯åŒå‘è·¯æ®µ


* ç‚¹å±‚node_idä¸çº¿å±‚from_nodeã€to_nodeå…³è”
    Linkå±‚ä¸­ï¼šä¸€æ¡linkçš„from_nodeã€to_nodeå±æ€§å¯¹åº”èŠ‚ç‚¹å±‚çš„node_id

.. image:: _static/images/LinkNodeCon.png
    :align: center


-------------------------------------

åœ¨æœ¬åœ°å›¾åŒ¹é…åŒ…ä¸­ï¼Œä½¿ç”¨Netå¯¹è±¡æ¥ç®¡ç†è·¯ç½‘ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šLinkå±‚å’ŒNodeå±‚æ–‡ä»¶è·¯å¾„æˆ–è€…ä¼ å…¥linkå±‚å’Œnodeå±‚çš„GeoDataFrameï¼Œä¾¿å¯ä»¥åˆ›å»ºä¸€ä¸ªNetå¯¹è±¡ï¼Œè¿™ä¸ªNetå¯¹è±¡æ˜¯æˆ‘ä»¬å¼€å±•GPSæ•°æ®ç”Ÿäº§ã€åœ°å›¾åŒ¹é…çš„åŸºå‡†Netï¼Œè¿™ä¸ªNetå¯¹è±¡æä¾›äº†å¾ˆå¤šæ“ä½œè·¯ç½‘çš„æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹è·¯ç½‘è¿›è¡Œæ“ä½œã€‚

.. image:: _static/images/create_net.png
    :align: center

-------------------------------------



å¦‚æœæ‚¨æ²¡æœ‰è·¯ç½‘æ•°æ®ï¼Œè¯·å‚è€ƒ `è·¯ç½‘ç”Ÿäº§`_ ã€‚


2.2.2. GPSå®šä½æ•°æ®
::::::::::::::::::::::::::

.. _GPSå®šä½æ•°æ®å­—æ®µè¦æ±‚:

GPSæ•°æ®å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: GPSæ•°æ®å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 15, 40

    "agent_id","string","è½¦è¾†å”¯ä¸€ç¼–ç ,å‡†ç¡®æ¥è¯´è¿™ä¸ªå­—æ®µæ ‡æ³¨çš„æ˜¯è½¦è¾†çš„æŸä¸€æ¬¡å®Œæ•´å‡ºè¡Œ"
    "lng","float","ç»åº¦"
    "lat","float","çº¬åº¦"
    "time","string","å®šä½æ—¶é—´æˆ³"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."

GPSæ•°æ®è¡¨ä¸­ä¸å¯å‡ºç°ä»¥ä¸‹å†…ç½®å­—æ®µï¼šgv_dxã€gv_dyã€gvlï¼Œè¿™äº›å­—æ®µä¸ºgotrackitçš„å†…ç½®è®¡ç®—å­—æ®µ

æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: GPSæ ·ä¾‹æ•°æ®
    :header: "agent_id", "lng", "lat", "time"
    :widths: 5,10,10,10

    "22413","113.8580665194923","22.774040768110932","2024-01-15 16:00:29"
    "22413","113.85816528930164","22.774241671596673","2024-01-15 16:00:59"
    "22413","113.86015961029372","22.77713838336715","2024-01-15 16:01:29"
    "22413","113.86375221173896","22.779334473598812","2024-01-15 16:02:00"
    "22413","113.864148301839","22.77953193554016","2024-01-15 16:02:29"
    "22413","113.86793876830578","22.78092681645836","2024-01-15 16:02:59"

åœ¨æœ¬åœ°å›¾åŒ¹é…åŒ…ä¸­ï¼Œä½¿ç”¨GpsPointsGdfå¯¹è±¡æ¥ç®¡ç†ä¸€è¾†è½¦çš„ä¸€æ¬¡å‡ºè¡Œè½¨è¿¹æ•°æ®ï¼Œç”¨æˆ·åœ¨æ„å»ºGpsPointsGdfä¹‹å‰åº”è¯¥å…ˆå¯¹GPSæ•°æ®åšé¢„å¤„ç†å¦‚è¡Œç¨‹åˆ‡åˆ†ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªè½¦è¾†å”¯ä¸€ç¼–ç agent_idæ¥æ ‡æ³¨è¿™æ¬¡å‡ºè¡Œï¼ŒGpsPointsGdfæä¾›äº†å¾ˆå¤šæ“ä½œGPSæ•°æ®çš„æ–¹æ³•

.. image:: _static/images/gps_obj.png
    :align: center

----------------------------------------


3. è·¯ç½‘æ¨¡å—
-------------------------

è¯¥æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•å¸®åŠ©æ‚¨ç”Ÿäº§gotrackitæ ‡å‡†è·¯ç½‘ï¼Œäº¦æˆ–æ˜¯ å¸®åŠ©æ‚¨ å°† å…¶ä»–æ•°æ®æ¥æºçš„è·¯ç½‘ è½¬åŒ–ä¸ºgotrackitæ ‡å‡†è·¯ç½‘ã€‚gotrackitçš„æ ‡å‡†è·¯ç½‘æ•°æ®ç»“æ„è§ï¼š`è·¯ç½‘æ•°æ®è¦æ±‚`_

.. _è·¯ç½‘ç”Ÿäº§ä»£ç ç¤ºä¾‹:

ä½¿ç”¨è·¯ç½‘ç”Ÿäº§å·¥å…·ï¼Œå…ˆä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng


3.1. è·¯ç½‘ç”Ÿäº§
```````````````````````


.. note::

   é€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘ä¸¥ç¦ç”¨äºå•†ä¸šè¡Œä¸ºï¼Œä»…é™äºæ•™è‚²ä»¥åŠç§‘å­¦ç ”ç©¶ã€‚


.. note::

   è¯·æ³¨æ„ï¼šé€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘çš„åæ ‡ç³»æ˜¯GCJ-02ï¼Œä¸€èˆ¬çš„GPSæ•°æ®åæ ‡ç³»éƒ½æ˜¯WGS-84ã€‚

è·¯ç½‘ç”Ÿäº§çš„ç›¸å…³å‡½æ•°ä¸éœ€è¦æ‚¨æä¾›ä»»ä½•çš„ç©ºé—´åœ°ç†ä¿¡æ¯æ–‡ä»¶ï¼Œåªéœ€æŒ‡å®šèŒƒå›´ã€å’Œç”³è¯· `å¼€å‘è€…key <https://lbs.amap.com>`_ å³å¯è·å–è·¯ç½‘ã€‚



3.1.1. åŸºäºçŸ©å½¢åŒºåŸŸéšæœºæ„é€ ODè¯·æ±‚è·¯å¾„, è·å–è·¯ç½‘
:::::::::::::::::::::::::::::::::::::::::::::::::::::

* åˆå§‹åŒ–NetReverseç±»
    flag_nameï¼šé¡¹ç›®åç§°ï¼Œå¿…é¡»æŒ‡å®šï¼›

    net_out_fldrï¼šæœ€ç»ˆè·¯ç½‘çš„å­˜å‚¨ç›®å½•ï¼Œå¿…é¡»æŒ‡å®š

    plain_crsï¼šè¦ä½¿ç”¨çš„å¹³é¢æŠ•å½±åæ ‡ç³»ï¼Œå¿…é¡»æŒ‡å®šï¼Œå‚è§: `6åº¦å¸¦åˆ’åˆ†è§„åˆ™`_

* è¯·æ±‚å‚æ•°
    key_listï¼šå¼€å‘è€…keyå€¼åˆ—è¡¨ï¼Œå¿…é¡»æŒ‡å®š

    binary_path_fldrï¼šè¯·æ±‚è·¯å¾„æºæ–‡ä»¶çš„å­˜å‚¨ç›®å½•ï¼Œå¿…é¡»æŒ‡å®š

    save_log_fileï¼šæ˜¯å¦ä¿å­˜æ—¥å¿—æ–‡ä»¶ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤False

    log_fldrï¼šæ—¥å¿—çš„å­˜å‚¨ç›®å½•ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤None

    min_lngï¼Œmin_latï¼šçŸ©å½¢åŒºåŸŸå·¦ä¸‹è§’ç»çº¬åº¦åæ ‡(GCJ-02åæ ‡)ï¼Œå¿…é¡»æŒ‡å®š

    wï¼Œhï¼šçŸ©å½¢åŒºåŸŸçš„å®½åº¦å’Œé«˜åº¦(ç±³)ï¼Œå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤å€¼2000ï¼Œ2000

    od_typeï¼šç”ŸæˆODçš„ç±»å‹ï¼Œå¿…é¡»æŒ‡å®šï¼Œå«ä¹‰è§ï¼š`od_type`_

    od_numï¼Œgap_nï¼Œmin_od_lengthï¼šç”Ÿæˆçš„odæ•°ã€åˆ’åˆ†ç½‘æ ¼æ•°ã€æœ€å°çš„odç›´çº¿è·ç¦»é™åˆ¶ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤100ï¼Œ1000ï¼Œ1200

    æŒ‡å®šçŸ©å½¢åŒºåŸŸçš„å·¦ä¸‹ç‚¹ç»çº¬åº¦åæ ‡(GCJ-02åæ ‡ç³»)ï¼Œä»¥åŠçŸ©å½¢åŒºåŸŸçš„å®½åº¦å’Œé•¿åº¦(å•ä½ç±³)ï¼Œå¿…é¡»æŒ‡å®š


æ‰€æœ‰å‚æ•°è§£é‡Šè§ :doc:`ç±»æ–¹æ³•æ±‡æ€»`


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š


.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_rectangle', net_out_fldr=r'./data/output/reverse/test_rectangle/',
                       plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=40)

        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_rectangle/',
                                     w=1500, h=1500, min_lng=126.665019, min_lat=45.747539, od_type='rand_od',
                                     od_num=200, gap_n=1000, min_od_length=800)

è¿è¡Œè¯¥ä»£ç åï¼Œå…ˆåœ¨ç›®å½•./data/output/request/test_rectangle/ä¸‹ç”Ÿæˆè·¯å¾„æºæ–‡ä»¶ï¼Œç„¶ååœ¨ç›®å½•./data/output/reverse/test_rectangle/ä¸‹ç”ŸæˆFinalLink.shpå’ŒFinalNode.shpæ–‡ä»¶


3.1.2. åŸºäºè‡ªå®šä¹‰åŒºåŸŸéšæœºæ„é€ ODè¯·æ±‚è·¯å¾„, è·å–è·¯ç½‘
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

æˆ‘ä»¬é€šè¿‡è¯»å–diy_region.shpæ¥æŒ‡å®šæˆ‘ä»¬æ„é€ éšæœºODçš„åŒºåŸŸèŒƒå›´ï¼š

.. image:: _static/images/diy_region.png
    :align: center

-------------------------------------------------------

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_diy_region', net_out_fldr=r'./data/output/reverse/test_diy_region/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        target_region_gdf = gpd.read_file(r'./data/input/region/diy_region.shp')
        print(target_region_gdf)
        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_diy_region/',
                                     region_gdf=target_region_gdf, od_type='rand_od', gap_n=1000,
                                     min_od_length=1200, od_num=20)


3.1.3. åŸºäºåŒºåŸŸ-åŒºåŸŸODè¯·æ±‚è·¯å¾„, è·å–è·¯ç½‘
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

è¯»å–äº¤é€šå°åŒºæ–‡ä»¶ï¼ŒæŒ‡å®šod_typeä¸ºregion_odï¼Œä¼šè‡ªåŠ¨æ„é€ ä¸¤ä¸¤åœ°å—å½¢å¿ƒä¹‹é—´çš„ODã€‚ä½¿ç”¨è¯¥æ–¹æ³•æ„é€ ODï¼Œéœ€è¦ç¡®ä¿é¢åŸŸæ–‡ä»¶ä¸­åŒ…å«region_idå­—æ®µã€‚


.. image:: _static/images/test_taz.png
    :align: center

-------------------------------------------------------


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_taz', net_out_fldr=r'./data/output/reverse/test_taz/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        target_region_gdf = gpd.read_file(r'./data/input/region/simple_taz.shp')
        print(target_region_gdf)
        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_taz/',
                                     region_gdf=target_region_gdf, od_type='region_od')



3.1.4. åŸºäºè‡ªå®šä¹‰ODè¯·æ±‚è·¯å¾„ï¼Œè·å–è·¯ç½‘
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

ä½ å¯ä»¥é€šè¿‡è‡ªå·±çš„ç›¸å…³ç®—æ³•å»æ„é€ ODï¼Œç¡®ä¿ODè¡¨ç¬¦åˆ `ODè¡¨è¦æ±‚`_ ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ODå»è¯·æ±‚è·¯å¾„ã€æ„é€ è·¯ç½‘

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_diy_od', net_out_fldr=r'./data/output/reverse/test_diy_od/',
                           plain_prj='EPSG:32651', save_tpr_link=True, angle_threshold=20)
        nv.generate_net_from_request(binary_path_fldr=r'./data/output/request/test_diy_od/',
                                     key_list=['ä½ çš„Key'],
                                     od_file_path=r'./data/output/od/è‹å·å¸‚.csv', od_type='diy_od')

        # æˆ–è€…
        # diy_od_df = pd.read_csv(r'./data/output/od/è‹å·å¸‚.csv')
        # nv.generate_net_from_request(binary_path_fldr=r'./data/output/request/test_diy_od/',
        #                              key_list=['ä½ çš„Key'],
        #                              od_df=diy_od_df,
        #                              od_type='diy_od')


æœ¬ç®—æ³•åŒ…æä¾›äº†ä¸€ä¸ªä¾æ®GPSæ•°æ®æ¥ç”Ÿäº§è‡ªå®šä¹‰ODçš„æ¥å£ï¼Œå‚è§ `é€”å¾„ç‚¹ODè®¡ç®—`_


3.1.5. è§£æè·¯å¾„æºæ–‡ä»¶, è·å–è·¯ç½‘
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

å¦‚æœå·²ç»æœ‰äº†è¯·æ±‚å¥½çš„è·¯å¾„æºæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä»è·¯å¾„æºæ–‡ä»¶ä¸­åˆ›å»ºè·¯ç½‘ï¼Œåªéœ€è¦æŒ‡å®šè·¯å¾„æºæ–‡ä»¶ç›®å½•å’Œè·¯å¾„æºæ–‡ä»¶åç§°åˆ—è¡¨

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_pickle', net_out_fldr=r'./data/output/reverse/test_pickle/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        nv.generate_net_from_pickle(binary_path_fldr=r'./data/output/request/test_taz/',
                                    pickle_file_name_list=['14_test_taz_gd_path_1'])


3.1.6. åŸºäºå·²æœ‰è·¯ç½‘çº¿å±‚, ç”Ÿäº§ç‚¹å±‚
:::::::::::::::::::::::::::::::::::::::::

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚(ä»osmæˆ–è€…å…¶ä»–ä»»ä½•é€”å¾„è·å–çš„)ï¼Œç¼ºå°‘æ‹“æ‰‘å…³è”å…³ç³»ä»¥åŠç‚¹å±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ„å»ºç‚¹å±‚ä»¥åŠæ·»åŠ ç‚¹å±‚ã€çº¿å±‚çš„å…³è”å…³ç³»


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # å¯¹link.shpçš„è¦æ±‚: åªéœ€è¦æœ‰geometryå­—æ®µå³å¯, ä½†æ˜¯geometryå­—æ®µçš„å‡ ä½•å¯¹è±¡å¿…é¡»ä¸ºLineStringç±»å‹(ä¸å…è®¸Zåæ ‡)
        nv = ng.NetReverse()
        link_gdf = gpd.read_file(r'./data/output/create_node/link.shp')
        print(link_gdf)
        # update_link_field_listæ˜¯éœ€è¦æ›´æ–°çš„è·¯ç½‘åŸºæœ¬å±æ€§å­—æ®µï¼šlink_idï¼Œfrom_nodeï¼Œto_nodeï¼Œlengthï¼Œdir
        # ç¤ºä¾‹ä¸­ï¼šlink_gdfæœ¬èº«å·²æœ‰dirå­—æ®µï¼Œæ‰€ä»¥æ²¡æœ‰æŒ‡å®šæ›´æ–°dir
        new_link_gdf, new_node_gdf, node_group_status_gdf = nv.create_node_from_link(link_gdf=link_gdf, using_from_to=False,
                                                                                     update_link_field_list=['link_id',
                                                                                                             'from_node',
                                                                                                             'to_node',
                                                                                                             'length'],
                                                                                     plain_prj='EPSG:32651',
                                                                                     modify_minimum_buffer=0.7,
                                                                                     execute_modify=True,
                                                                                     ignore_merge_rule=True,
                                                                                     out_fldr=r'./data/output/create_node/')


3.1.7. å¯ç”¨å¤šæ ¸å¹¶è¡Œé€†å‘è·¯ç½‘
:::::::::::::::::::::::::::::::::::::::::

è‹¥éœ€è¦è·å–å¤§èŒƒå›´çš„è·¯ç½‘ï¼Œæˆ‘ä»¬æ¨èä½¿ç”¨å¤šæ ¸å¹¶è¡Œè¯·æ±‚ï¼Œå³åœ¨åˆå§‹åŒ–NetReverseç±»æ—¶ï¼ŒæŒ‡å®šmulti_core_reverse=Trueï¼Œreverse_core_num=x

ç¨‹åºä¼šè‡ªåŠ¨å°†è·¯ç½‘åˆ’åˆ†ä¸ºxä¸ªå­åŒºåŸŸï¼Œåœ¨æ¯ä¸ªå­åŒºåŸŸå†…è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æŸåï¼Œåœ¨net_out_fldrä¸‹ä¼šç”Ÿæˆxä¸ªå­æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«å­˜æ”¾æœ€ç»ˆçš„å­åŒºåŸŸè·¯ç½‘ï¼Œå¦‚æœä½ æƒ³å°†è¿™äº›è·¯ç½‘è¿›è¡Œåˆå¹¶ï¼Œè¯·ä½¿ç”¨è·¯ç½‘åˆå¹¶æ¥å£


3.1.8. åˆå¹¶gotrackitæ ‡å‡†è·¯ç½‘
:::::::::::::::::::::::::::::::::::::::::

åˆå¹¶å¤šä¸ªåœ°åŒºçš„æ ‡å‡†è·¯ç½‘ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        fldr = r'F:\PyPrj\TrackIt\data\input\net\test\all_sichuan_path\net'
        net_list = []
        for i in range(0,6):
            net_list.append([gpd.read_file(os.path.join(fldr, f'region-{i}', 'FinalLink.shp')),
                             gpd.read_file(os.path.join(fldr, f'region-{i}', 'FinalNode.shp'))])

        l, n = ng.NetReverse.merge_net(net_list=net_list, conn_buffer=0.2,
                                       out_fldr=r'F:\PyPrj\TrackIt\data\input\net\test\all_sichuan_path\net\merge')
        l.to_file(r'F:\PyPrj\TrackIt\data\input\net\test\all_sichuan_path\net\merge\link.shp', encoding='gbk')
        n.to_file(r'F:\PyPrj\TrackIt\data\input\net\test\all_sichuan_path\net\merge\node.shp', encoding='gbk')




3.2. è·¯ç½‘ä¼˜åŒ–
```````````````````````

ä»¥ä¸‹ä¼˜åŒ–æ“ä½œä¸æ˜¯å¿…é¡»è¦åšçš„ï¼Œå¤§å®¶ä¾æ®è‡ªå·±çš„è·¯ç½‘æƒ…å†µé€‰æ‹©ä½¿ç”¨å³å¯

.. _æ¸…æ´—è·¯ç½‘çº¿å±‚æ•°æ®:

3.2.1. æ¸…æ´—ä½ çš„è·¯ç½‘çº¿å±‚æ•°æ®
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚æ•°æ®(ä»osmæˆ–è€…å…¶ä»–ä»»ä½•é€”å¾„è·å–çš„), ä½ å¯èƒ½æƒ³ä½¿ç”¨nv.create_node_from_linkå‡½æ•°æ¥ç”Ÿäº§ç‚¹å±‚ä»¥åŠç”Ÿäº§æ‹“æ‰‘å…³è”ä»¥å¾—åˆ°æ ‡å‡†çš„è·¯ç½‘æ•°æ®ï¼Œä½†æ˜¯nv.create_node_from_linkå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ çš„è·¯ç½‘çº¿å±‚æ•°æ®å¯èƒ½åŒ…å«äº†Multiç±»å‹æˆ–è€…æ˜¯å¸¦æœ‰zåæ ‡æˆ–è€…æ˜¯çº¿å¯¹è±¡ä¸­å«æœ‰å¤§é‡çš„é‡å ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨nvç±»çš„é™æ€æ–¹æ³•clean_link_geoæ¥æ¶ˆé™¤zåæ ‡ä»¥åŠmultiç±»å‹


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # è¯»å–æ•°æ®
        df = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')

        # å¤„ç†geometry
        # l_thresholdè¡¨ç¤ºå°†çº¿å‹ä¸­è·ç¦»å°äºl_thresholdç±³çš„æŠ˜ç‚¹è¿›è¡Œåˆå¹¶ï¼Œç®€åŒ–è·¯ç½‘ï¼ŒåŒæ—¶æ¶ˆé™¤é‡å æŠ˜ç‚¹
        # l_thresholdæ¨è 1m ~ 5mï¼Œè¿‡å¤§ä¼šå¯¼è‡´çº¿å‹ç»†èŠ‚å¤±çœŸ
        # plain_crsæ˜¯è¦ä½¿ç”¨çš„å¹³é¢æŠ•å½±åæ ‡ç³»
        link_gdf = ng.NetReverse.clean_link_geo(gdf=df, plain_crs='EPSG:32649', l_threshold=1.0)


3.2.2. åŸºäºå·²æœ‰æ ‡å‡†è·¯ç½‘, æ£€æŸ¥è·¯ç½‘çš„è”é€šæ€§å¹¶è¿›è¡Œä¿®å¤
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚å’Œç‚¹å±‚(ä¸”å­—æ®µå’Œæ‹“æ‰‘å…³è”å…³ç³»æ»¡è¶³æœ¬ç®—æ³•åŒ…çš„è¦æ±‚)ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥æ£€æŸ¥è·¯ç½‘çš„è”é€šæ€§

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        link_gdf = gpd.read_file(r'./data/input/net/test/sz/FinalLink.shp')
        node_gdf = gpd.read_file(r'./data/input/net/test/sz/FinalNode.shp')

        # net_file_typeæŒ‡çš„æ˜¯è¾“å‡ºè·¯ç½‘æ–‡ä»¶çš„ç±»å‹
        nv = ng.NetReverse(net_file_type='shp', conn_buffer=0.8, net_out_fldr=r'./data/input/net/test/sz/')
        new_link_gdf, new_node_gdf = nv.modify_conn(link_gdf=link_gdf, node_gdf=node_gdf, book_mark_name='sz_conn_test', generate_mark=True)

        print(new_link_gdf)
        print(new_node_gdf)

åœ¨net_out_fldrä¸‹ä¼šç”Ÿæˆè”é€šæ€§ä¿®å¤å®Œæˆåçš„è·¯ç½‘æ–‡ä»¶ä»¥åŠxmlç©ºé—´ä¹¦ç­¾æ–‡ä»¶ï¼Œå°†xmlæ–‡ä»¶å¯¼å…¥åˆ°QGISå¯ä»¥æŸ¥çœ‹ä¿®å¤çš„ç‚¹ä½æƒ…å†µä»¥ä¾¿æ’æŸ¥æ˜¯å¦æ‰€æœ‰ä¿®å¤éƒ½æ˜¯åˆç†çš„


ä»€ä¹ˆæ˜¯è”é€šæ€§ä¿®å¤ï¼Ÿ

.. image:: _static/images/conn_1.png
    :align: center

--------------------------------------------------------------------------------

.. image:: _static/images/conn_2.png
    :align: center

--------------------------------------------------------------------------------


3.2.3. è·¯æ®µåˆ’åˆ†
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

ä½ å·²ç»æœ‰äº†ä¸€å¥—linkå’Œnodeæ–‡ä»¶, ä½ å¸Œæœ›å¯¹linkå±‚è¿›è¡Œè·¯æ®µé‡å¡‘ï¼Œå³å°†é•¿åº¦å¤§äºL(m)çš„è·¯æ®µéƒ½è¿›æ‰“æ–­ï¼ŒåŒæ—¶ç‚¹å±‚æ•°æ®ä¹Ÿä¼šéšä¹‹è‡ªåŠ¨å˜åŒ–


åˆ’åˆ†å‰ï¼š

.. image:: _static/images/before_divide.png
    :align: center

--------------------------------------------------------------------------------

åˆ’åˆ†åï¼š

.. image:: _static/images/after_divide.png
    :align: center

--------------------------------------------------------------------------------

ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng


.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        link = gpd.read_file(r'./data/input/net/test/0317/link1.geojson')
        node = gpd.read_file(r'./data/input/net/test/0317/node1.geojson')

        nv = ng.NetReverse()
        # æ‰§è¡Œåˆ’åˆ†è·¯ç½‘
        # divide_l: æ‰€æœ‰é•¿åº¦å¤§äºdivide_lçš„è·¯æ®µéƒ½å°†æŒ‰ç…§divide_lè¿›è¡Œåˆ’åˆ†
        # min_l: åˆ’åˆ†åå¦‚æœå‰©ä¸‹çš„è·¯æ®µé•¿åº¦å°äºmin_l, é‚£ä¹ˆæ­¤æ¬¡åˆ’åˆ†å°†ä¸è¢«å…è®¸
        new_link, new_node = nv.divide_links(link_gdf=link, node_gdf=node, divide_l=50, min_l=5.0)

        new_link.to_file(r'./data/input/net/test/0317/divide_link.geojson', driver='GeoJSON', encoding='gbk')
        new_node.to_file(r'./data/input/net/test/0317/divide_node.geojson', driver='GeoJSON', encoding='gbk')


3.2.4. idé‡æ˜ å°„
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng

å¦‚æœä½ çš„linkè¡¨çš„link_idæˆ–è€…nodeè¡¨çš„node_idæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•´æ•°, ä½¿ç”¨è¿™æ ·çš„è·¯ç½‘å­˜åœ¨é£é™©ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°è¿›è¡ŒIDé‡æ˜ å°„

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        l = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        n = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        print(l[['link_id', 'from_node', 'to_node']])
        print(n[['node_id']])
        nv = ng.NetReverse()
        nv.remapping_link_node_id(l, n)
        print(l[['link_id', 'from_node', 'to_node']])
        print(n[['node_id']])


3.2.5. è·¯ç½‘è·¯æ®µã€èŠ‚ç‚¹é‡å¡‘
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

ä½ å·²ç»æœ‰äº†ä¸€å¥—linkæ–‡ä»¶ï¼Œä½†æ˜¯å…¶å­˜åœ¨æŠ˜ç‚¹è”é€šæ€§é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š

.. image:: _static/images/before_redivide.jpg
    :align: center

--------------------------------------------------------------------------------


å¯ä»¥ä½¿ç”¨è¯¥æ¥å£è¿›è¡Œè·¯æ®µå’ŒèŠ‚ç‚¹çš„é‡å¡‘ä»¥åŠè”é€šæ€§çš„ä¼˜åŒ–ï¼Œä½ åªéœ€è¦è¾“å…¥ä¸€ä¸ªçº¿å±‚ï¼Œè¯¥å‡½æ•°ä¼šå¸®ä½ é‡å¡‘èŠ‚ç‚¹åˆ’åˆ†ä»¥åŠè·¯æ®µåˆ’åˆ†ï¼Œå¹¶ä¸”ä¿®å¤è”é€šæ€§

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # è¯»å–æ•°æ®
        origin_link = gpd.read_file(r'./data/input/net/test/0402BUG/load/test_link.geojson')
        print(origin_link)

        # ä¸ºé˜²æ­¢çº¿å±‚çº¿å‹æœ‰é‡å¤ç‚¹ï¼Œå…ˆåšæ¸…æ´—
        origin_link = ng.NetReverse.clean_link_geo(gdf=origin_link, l_threshold=1.0, plain_crs='EPSG:32650')

        # multi_core_merge=Trueè¡¨ç¤ºå¯ç”¨å¤šè¿›ç¨‹è¿›è¡Œæ‹“æ‰‘ä¼˜åŒ–
        # merge_core_numè¡¨ç¤ºå¯ç”¨ä¸¤ä¸ªæ ¸
        nv = ng.NetReverse(net_out_fldr=r'./data/input/net/test/0402BUG/redivide',
                           plain_prj='EPSG:32650', flag_name='new_divide', multi_core_merge=True,
                           merge_core_num=2)

        # è·¯æ®µã€èŠ‚ç‚¹é‡æ–°åˆ’åˆ†ã€è”é€šæ€§ä¿®å¤ï¼Œæ–°çš„ç½‘ç»œæ–‡ä»¶åœ¨net_out_fldrä¸‹ç”Ÿæˆ
        nv.redivide_link_node(link_gdf=origin_link)


é‡å¡‘ä¿®å¤åï¼š

.. image:: _static/images/after_redivide.jpg
    :align: center

--------------------------------------------------------------------------------


3.2.6. å¤„ç†ç¯è·¯å’Œç›¸åŒ(from_nodeï¼Œto_node)çš„è·¯æ®µ
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

gotrackitä¸å…è®¸è·¯ç½‘å‡ºç°ç¯è·¯ä»¥åŠ(from_nodeï¼Œto_node)ç›¸åŒçš„linkå­˜åœ¨(å¦‚ä¸‹å›¾), åœ¨æ„å»ºNetæ—¶ä¼šè‡ªåŠ¨è¯†åˆ«è¿™äº›linkå¹¶ä¸”è¿›è¡Œåˆ é™¤, å¦‚æœä½ æƒ³ä¿ç•™è¿™äº›linkè¯·ä½¿ç”¨circle_processè¿›è¡Œè·¯ç½‘å¤„ç†

.. image:: _static/images/circle_before.jpg
    :align: center

--------------------------------------------------------------------------------

.. image:: _static/images/same_ft_before.jpg
    :align: center

--------------------------------------------------------------------------------


.. code-block:: python
    :linenos:

    import gotrackit.netreverse.NetGen as ng

    if __name__ == '__main__':
        l = gpd.read_file('./data/input/net/test/0506yg/link.shp')
        n = gpd.read_file('./data/input/net/test/0506yg/node.shp')

        # å¤„ç†ç¯è·¯å’Œç›¸åŒfrom_node - to_nodeçš„link
        new_link, new_node = ng.NetReverse.circle_process(link_gdf=l, node_gdf=n)

        # circle_processå¤„ç†åè¾“å‡ºçš„è·¯ç½‘æ˜¯å¹³é¢æŠ•å½±åæ ‡ç³», éœ€è¦è½¬åŒ–ä¸ºEPSG:4326
        new_link = new_link.to_crs('EPSG:4326')
        new_node = new_node.to_crs('EPSG:4326')

        new_link.to_file('./data/input/net/test/0506yg/new_link.shp')
        new_node.to_file('./data/input/net/test/0506yg/new_node.shp')



circle_processå¤„ç†åå¦‚å›¾

.. image:: _static/images/circle_after.jpg
    :align: center

--------------------------------------------------------------------------------

.. image:: _static/images/same_ft_after.jpg
    :align: center

--------------------------------------------------------------------------------



3.2.7. åæ ‡è½¬æ¢(å¦‚æœ‰éœ€è¦)
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

æä¾›äº† GCJ-02ã€wgs84ã€ç™¾åº¦ åæ ‡ç³»ä¹‹é—´çš„ç›¸äº’è½¬æ¢æ¥å£


.. code-block:: python
    :linenos:

    from gotrackit.tools.coord_trans import LngLatTransfer
    from shapely.geometry import LineString

    if __name__ == '__main__':

        trans = LngLatTransfer()
        # å•ä¸ªåæ ‡ç‚¹è½¬æ¢
        # con_typeå«ä¹‰: gc-84: GCJ-02å‘WGS84è½¬æ¢, 84-bd: WGS84å‘ç™¾åº¦è½¬æ¢, å…¶ä»–åŒç†...
        trans_x, trans_y = trans.loc_convert(lng=114.361, lat=22.362, con_type='gc-84')

        # å‡ ä½•å¯¹è±¡è½¬æ¢
        # æ”¯æŒshapelyçš„ç‚¹ã€çº¿ã€é¢å¯¹è±¡è½¬æ¢
        trans_line = trans.obj_convert(geo_obj=LineString([(114.325, 22.36), (114.66, 22.365), (114.321, 22.452)]),
                                       con_type='gc-84')
        print(trans_line)


å‡½æ•°æ–¹æ³•çš„ç›¸å…³å‚æ•°è§ :doc:`ç±»æ–¹æ³•æ±‡æ€»`





4. GPSæ•°æ®ç”Ÿäº§
-----------------------------

æœ¬æ¨¡å—æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œä½ åªéœ€è¦æŒ‡å®šä¸€ä¸ªè·¯ç½‘ï¼Œè¯¥æ¨¡å—å¯ä»¥æ¨¡æ‹Ÿè¡Œè½¦å¹¶ä¸”ç”Ÿæˆè½¨è¿¹æ•°æ®ã€GPSæ•°æ®ï¼Œç¤ºä¾‹ä»£ç å’Œå‚æ•°è§£é‡Šå¦‚ä¸‹ï¼š

è·¯ç½‘çš„æ•°æ®è¦æ±‚è§ï¼š`è·¯ç½‘æ•°æ®è¦æ±‚`_

.. _GPSæ•°æ®ç”Ÿäº§ä»£ç ç¤ºä¾‹:

.. code-block:: python
    :linenos:

    # ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—ï¼šNetå’ŒTripGeneration
    from gotrackit.map.Net import Net
    from gotrackit.generation.SampleTrip import TripGeneration


    if __name__ == '__main__':
        # 1.æ„å»ºä¸€ä¸ªnet, è¦æ±‚è·¯ç½‘çº¿å±‚å’Œè·¯ç½‘ç‚¹å±‚å¿…é¡»æ˜¯WGS-84, EPSG:4326 åœ°ç†åæ ‡ç³»
        my_net = Net(link_path=r'data/input/net/xian/modifiedConn_link.shp',
                     node_path=r'data/input/net/xian/modifiedConn_node.shp')
        # è·¯ç½‘å¯¹è±¡åˆå§‹åŒ–
        my_net.init_net()

        # æ–°å»ºä¸€ä¸ªè¡Œç¨‹ç”Ÿæˆç±»
        ts = TripGeneration(net=my_net, loc_error_sigma=50.0, loc_frequency=30, time_step=0.1)

        # éšæœºç”Ÿæˆè¡Œç¨‹å¹¶ä¸”è¾“å‡ºGPSæ•°æ®
        ts.generate_rand_trips(trip_num=5, out_fldr=r'./data/output/sample_gps',
                               agent_flag='0527-agent', instant_output=True)


Netæ„å»ºå‚æ•°è§ï¼š`æ„å»ºNetçš„ç›¸å…³å‚æ•°`_


4.1. TripGenerationåˆå§‹åŒ–å‚æ•°
`````````````````````````````````

* net
    è·¯ç½‘å¯¹è±¡ï¼Œå¿…é¡»æŒ‡å®š

* time_step
    ä»¿çœŸæ­¥é•¿(s)ï¼Œé»˜è®¤0.1s

* speed_miu
    ä»¿çœŸé€Ÿåº¦å‡å€¼(m/s)ï¼Œé»˜è®¤12.0

* speed_sigma
    ä»¿çœŸé€Ÿåº¦æ ‡å‡†å·®(m/s)ï¼Œé»˜è®¤3.6

* save_gap
    æ¯å¤šå°‘ä»¿çœŸæ­¥ä¿å­˜ä¸€æ¬¡çœŸå®è½¨è¿¹æ•°æ®ï¼Œæ•´æ•°ï¼Œé»˜è®¤1

* loc_frequency
    æ¯å¤šå°‘sè¿›è¡Œä¸€æ¬¡GPSå®šä½ï¼Œé»˜è®¤2.0ï¼Œè¯¥å€¼å¿…é¡»å¤§äºä»¿çœŸæ­¥é•¿

* loc_error_sigma
    å®šä½è¯¯å·®æ ‡å‡†å·®(m)ï¼Œé»˜è®¤40.0

* loc_error_miu
    å®šä½è¯¯å·®å‡å€¼(m)ï¼Œé»˜è®¤0.0



4.2. generate_rand_tripsç›¸å…³å‚æ•°
`````````````````````````````````

* trip_num
    è¡Œç¨‹æ•°ï¼Œæ•´æ•°ï¼Œä¸€å…±è¾“å‡ºå¤šå°‘æ¬¡è¡Œç¨‹ï¼Œé»˜è®¤10

* instant_output
    æ˜¯å¦å³æ—¶è¾“å‡ºï¼Œå³æ˜¯å¦æ¯è®¡ç®—å®Œä¸€æ¬¡è¡Œç¨‹å°±å­˜å‚¨GPSæ•°æ®æ–‡ä»¶ã€é€å¸§è½¨è¿¹æ–‡ä»¶ï¼Œé»˜è®¤False

* out_fldr
    å­˜å‚¨è¾“å‡ºæ–‡ä»¶çš„ç›®å½•ï¼Œé»˜è®¤å½“å‰ç›®å½•

* time_format
    è¾“å‡ºGPSæ•°æ®çš„æ—¶é—´åˆ—çš„æ ¼å¼ï¼Œé»˜è®¤"%Y-%m-%d %H:%M:%S"ï¼Œå¯ä»¥å‚ç…§pandasä¸­pd.to_datetime()å‡½æ•°çš„formatå‚æ•°

    å‚è€ƒï¼š`pd.to_datetimeè§£é‡Š <https://pandas.pydata.org/pandas-docs/version/0.20/generated/pandas.to_datetime.html#>`_ã€`ISO_8601 <https://en.wikipedia.org/wiki/ISO_8601>`_

* start_yearã€start_monthã€start_day
    èµ·å§‹å¹´æœˆæ—¥ï¼Œé»˜è®¤2022ã€5ã€15

* start_hourã€start_minuteã€start_second
    èµ·å§‹æ—¶åˆ†ç§’ï¼Œé»˜è®¤10ã€20ã€12

* agent_flag
    æ ‡å¿—å­—ç¬¦ï¼Œé»˜è®¤agent


5. GPSæ•°æ®è¡Œç¨‹åˆ‡åˆ†
-----------------------------

åŸå§‹çš„GPSæ•°æ®åŒ…å«äº†ä¸€è¾†è½¦çš„å¤šæ¬¡å‡ºè¡Œï¼Œæˆ‘ä»¬éœ€è¦å¯¹è½¦è¾†çš„å‡ºè¡Œè¿›è¡Œåˆ’åˆ†ï¼ŒGpsPreProcessæä¾›äº†è¡Œç¨‹åˆ‡åˆ†ã€å¸¦é€”å¾„ç‚¹ä¿¡æ¯çš„ODæŠ½å–è¿™ä¸¤å¤§åŠŸèƒ½ï¼Œä½ åªéœ€è¦ä¼ å…¥GPSè¡¨æ•°æ®å³å¯ã€‚

ç¡®ä¿GPSæ•°æ®æ»¡è¶³ `GPSå®šä½æ•°æ®å­—æ®µè¦æ±‚`_ ã€‚

.. _è¡Œç¨‹åˆ‡åˆ†ä»£ç ç¤ºä¾‹:

5.1. è¡Œç¨‹åˆ‡åˆ†
`````````````````````````````````````````````````````

è¯¥æ¥å£å‡½æ•°æä¾›äº†ä¸»è¡Œç¨‹å’Œå­è¡Œç¨‹çš„åˆ’åˆ†åŠŸèƒ½ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š


.. code-block:: python
    :linenos:

    import pandas as pd
    from gotrackit.gps.GpsTrip import GpsPreProcess

    if __name__ == '__main__':
        # è¯»å–GPSæ•°æ®
        gps_gdf = pd.read_csv(r'data/output/gps/example/origin_gps.cssv')

        # æ–°å»ºä¸€ä¸ªGpsPreProcessç¤ºä¾‹
        grp = GpsPreProcess(gps_df=gps_gdf, use_multi_core=False)

        # è°ƒç”¨trip_segmentationsæ–¹æ³•è¿›è¡Œè¡Œç¨‹åˆ‡åˆ†
        # åˆ‡åˆ†åçš„æ•°æ®ä¼šæ›´æ–°agent_idå­—æ®µç”¨ä»¥åŒºåˆ†ä¸åŒçš„å‡ºè¡Œæ—…ç¨‹ï¼ŒåŸGPSè¡¨çš„agent_idä¼šå­˜å‚¨åœ¨origin_agent_idå­—æ®µä¸­
        gps_trip = grp.trip_segmentations(group_gap_threshold=1800, plain_crs='EPSG:32650', min_distance_threshold=10.0)

        gps_trip.to_csv(r'./data/output/gps/example/gps_trip.csv', encoding='utf_8_sig', index=False)


5.1.1. åˆå§‹åŒ–GpsPreProcessçš„ç›¸å…³å‚æ•°
::::::::::::::::::::::::::::::::::::::::::::::::

* gps_df
    gpsæ•°æ®è¡¨ï¼Œç±»å‹ï¼špd.DataFrameï¼Œå¿…é¡»æŒ‡å®š

* use_multi_core
    æ˜¯å¦å¯ç”¨å¤šæ ¸å¹¶è¡Œï¼Œé»˜è®¤Falseï¼Œæ•°æ®é‡è¾ƒå¤§æ—¶å¯ä»¥å¯ç”¨

* used_core_num
    å¯ç”¨çš„æ ¸æ•°ï¼Œé»˜è®¤2

5.1.2. ç±»æ–¹æ³•trip_segmentationsç›¸å…³å‚æ•°
::::::::::::::::::::::::::::::::::::::::::::::::

* time_unitã€time_format
    GPSæ•°æ®ç›¸å…³å‚æ•°ï¼Œå‚è§ï¼š`åœ°å›¾åŒ¹é…å‚æ•°è§£é‡Š`_ ä¸­çš„time_unitã€time_format

* plain_crs
    è¦ä½¿ç”¨çš„å¹³é¢æŠ•å½±åæ ‡ç³»

    åæ ‡ç³»ç›¸å…³å‚æ•°æŸ¥è¯¢å¯ä»¥å‚è€ƒï¼š`epsg.io <https://epsg.io/>`_ã€åæ ‡ç³»çš„ç›¸å…³çŸ¥è¯†è®²è§£å¯ä»¥å‚è€ƒï¼š`åæ ‡ç³»ç®€ä»‹ <https://mp.weixin.qq.com/s/Ot_Vo4CEtGYRblTMjMQYiw>`_

    .. _6åº¦å¸¦åˆ’åˆ†è§„åˆ™:
    å¹³é¢æŠ•å½±åæ ‡ç³»æœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œä»…ä»…åˆ—å‡º6åº¦å¸¦çš„åˆ’åˆ†ï¼ŒæŒ‰ç…§ç»åº¦ï¼Œæ¯6åº¦å¯¹åº”ä¸€ä¸ªå¹³é¢æŠ•å½±åæ ‡ç³»ï¼Œå¯ä»¥æŒ‰ç…§ç ”ç©¶èŒƒå›´çš„ä¸­å¿ƒç‚¹ç»çº¬åº¦å‚ç…§ä¸‹è¡¨é€‰å–

    å¦‚æœä½ çš„ç ”ç©¶åŒºåŸŸæ˜¯ä¸–ç•ŒèŒƒå›´ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨EPSG:3857ï¼Œè¿™ä¸ªå¹³é¢æŠ•å½±åæ ‡ç³»é€‚ç”¨äºå…¨çƒä»»ä½•åœ°åŒº


.. csv-table:: 6åº¦å¸¦åˆ’åˆ†
    :header: "ç»åº¦èŒƒå›´", "-180 ~ -174", "-174 ~ -168", "-168 ~ -162", "...", "108 ~ 114", "114 ~ 120", "120 ~ 126", "...", "174 ~ 180"
    :widths: 15, 15, 15, 15, 15, 15, 15, 15, 15, 15

    "6åº¦å¸¦å¹³é¢æŠ•å½±CRSåç§°", "EPSG:32601", "EPSG:32602", "EPSG:32603", "...", "EPSG:32649", "EPSG:32650", "EPSG:32651", "...", "EPSG:32660"


* group_gap_threshold
    æ—¶é—´é˜ˆå€¼ï¼Œä¸»è¡Œç¨‹åˆ’åˆ†å‚æ•°ï¼Œå•ä½ç§’ï¼Œå¦‚æœå‰åGPSç‚¹çš„å®šä½æ—¶é—´è¶…è¿‡è¯¥é˜ˆå€¼ï¼Œåˆ™åœ¨è¯¥ç‚¹åˆ‡åˆ†ä¸»è¡Œç¨‹ï¼Œé»˜è®¤1800s(30åˆ†é’Ÿ)

* min_distance_threshold
    å­è¡Œç¨‹åˆ‡åˆ†è·ç¦»é˜ˆå€¼ï¼Œå•ä½ç±³ï¼Œé»˜è®¤10.0m

* dwell_accu_time
    å­è¡Œç¨‹åˆ‡åˆ†æ—¶é—´é˜ˆå€¼ï¼Œç§’ï¼Œé»˜è®¤60ç§’

* n
    å­è¡Œç¨‹åˆ‡åˆ†å‚æ•°ï¼Œæ•´æ•°ï¼Œå¦‚æœè¶…è¿‡è¿ç»­nä¸ªgpsç‚¹çš„è·ç¦»å°äºmin_distance_threshold ä¸” æŒç»­æ—¶é—´è¶…è¿‡dwell_accu_timeï¼Œé‚£ä¹ˆè¯¥å¤„è¢«è¯†åˆ«ä¸ºåœç•™ç‚¹ï¼Œä»è¯¥å¤„åˆ‡åˆ†å­è¡Œç¨‹ï¼Œé»˜è®¤5


5.1.3. å¦‚ä½•ç†è§£ä¸»è¡Œç¨‹å’Œå­è¡Œç¨‹ï¼Ÿ
::::::::::::::::::::::::::::::::::::::::::::::::

ä¸»è¡Œç¨‹ä¸¾ä¾‹ï¼š ä¸€è¾†è½¦ä»å®¶å‡ºå‘åˆ°è¾¾å…¬å¸ï¼Œå°†è½¦è¾†åœåœ¨è½¦åº“ï¼Œç†„ç«åï¼Œè½¦è¾†ä¸å†äº§ç”ŸGPSæ•°æ®ï¼Œä¸‹ç­åå†æ¬¡å¯åŠ¨ï¼ŒGPSæ•°æ®é‡æ–°äº§ç”Ÿï¼Œæ—©ä¸Šåˆ°è¾¾å…¬å¸çš„æœ€åä¸€ä¸ªå®šä½ç‚¹å’Œä¸‹ç­åå¯åŠ¨è½¦è¾†çš„ç¬¬ä¸€ä¸ªå®šä½ç‚¹ï¼Œå…¶æ—¶é—´å·®è¶…è¿‡group_gap_thresholdï¼Œåˆ™åœ¨æ­¤å¤„åˆ‡åˆ†ä¸»è¡Œç¨‹

å­è¡Œç¨‹ä¸¾ä¾‹ï¼š ä¸€è¾†è½¦ä»å®¶å‡ºå‘åˆ°è¾¾å…¬å¸ï¼Œåœ¨åˆ°è¾¾å…¬å¸ä¹‹å‰ï¼Œåœ¨åŠ æ²¹ç«™åŠ æ²¹ï¼ŒGPSç‚¹æŒç»­äº§ç”Ÿï¼Œä½†æ˜¯å®šä½ç‚¹é›†ä¸­åœ¨åŠ æ²¹ç«™é™„è¿‘ï¼Œäº§ç”Ÿäº†åœç•™ï¼Œé‚£ä¹ˆä»å®¶-åŠ æ²¹ç«™å°±æ˜¯ä¸€æ®µå­è¡Œç¨‹

æ¯ä¸€ä¸ªæ®µä¸»è¡Œç¨‹ã€å­è¡Œç¨‹ï¼Œå‡æ‹¥æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„agent_id

å¦‚æœä½ åªæƒ³åˆ’åˆ†ä¸»è¡Œç¨‹ï¼Œåˆ™æŒ‡å®šmin_distance_thresholdä¸ºè´Ÿæ•°å³å¯


.. _é€”å¾„ç‚¹ODè®¡ç®—:

5.2. ä»GPSæ•°æ®è®¡ç®—é€”å¾„ç‚¹OD
`````````````````````````````````````````````````````
å¦‚æœä½ çš„GPSæ•°æ®å·²ç»å®Œæˆäº†è¡Œç¨‹åˆ‡åˆ†ï¼Œä¸”å·²ç»æŒ‰ç…§agent_idã€timeä¸¤ä¸ªå­—æ®µå‡åºæ’åˆ—ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ¥å£è¿›è¡Œé€”å¾„ç‚¹çš„æŠ½æ ·ï¼Œå¾—åˆ°å¸¦é€”å¾„ç‚¹çš„ODæ•°æ®, å…¶æ•°æ®æ ¼å¼æ»¡è¶³ `ODè¡¨è¦æ±‚`_

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    import pandas as pd
    from gotrackit.gps.GpsTrip import GpsPreProcess

    if __name__ == '__main__':
        # è¯»å–GPSæ•°æ®
        gps_gdf = pd.read_csv(r'data/output/gps/example/gps_trip.cssv')

        # æ–°å»ºä¸€ä¸ªGpsPreProcessç¤ºä¾‹
        grp = GpsPreProcess(gps_df=gps_gdf, use_multi_core=False)

        # è¿”å›çš„ç¬¬ä¸€ä¸ªæ•°æ®æ˜¯ODè¡¨(pd.DataFrame)ï¼Œç¬¬äºŒä¸ªæ•°æ®æ˜¯ODçº¿(gpd.GeoDataFrame)
        gps_od, od_line = grp.sampling_waypoints_od(way_points_num=2)
        gps_od.to_csv(r'./data/output/gps_od.csv', encoding='utf_8_sig', index=False)
        od_line.to_file(r'./data/output/gps_od.shp')


5.2.1. sampling_waypoints_odç›¸å…³å‚æ•°
::::::::::::::::::::::::::::::::::::::::::::::::

* way_points_num
    æ•´æ•°ï¼ŒODçš„é€”å¾„ç‚¹æ•°ç›®ï¼Œå¿…é¡»â‰¤10ï¼Œé»˜è®¤5ä¸ªé€”å¾„ç‚¹


6. åœ°å›¾åŒ¹é…
-------------------------------------------------

6.1. æ‰€éœ€æ•°æ®
`````````````

ä½¿ç”¨åœ°å›¾åŒ¹é…æ¥å£ï¼Œä½ éœ€è¦å‡†å¤‡è·¯ç½‘æ•°æ®å’ŒGPSæ•°æ®ã€‚

åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š


.. image:: _static/images/MatchGraph.png
    :align: center

----------------------------------------


.. _åœ°å›¾åŒ¹é…ä»£ç ç¤ºä¾‹:

6.2. å¸¸è§„åŒ¹é…ä»£ç ç¤ºä¾‹
````````````````````````

ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶ä»Gitä»“åº“è·å–ï¼š`0327test.zip <https://github.com/zdsjjtTLG/TrackIt/tree/main/data>`_

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import pandas as pd
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':

        # 1.è¯»å–GPSæ•°æ®
        # è¿™æ˜¯ä¸€ä¸ªæœ‰10è¾†è½¦çš„GPSæ•°æ®çš„æ–‡ä»¶, å·²ç»åšè¿‡äº†æ•°æ®æ¸…æ´—ä»¥åŠè¡Œç¨‹åˆ‡åˆ†
        # ç”¨äºåœ°å›¾åŒ¹é…çš„GPSæ•°æ®éœ€è¦ç”¨æˆ·è‡ªå·±è¿›è¡Œæ¸…æ´—ä»¥åŠè¡Œç¨‹åˆ‡åˆ†
        gps_df = pd.read_csv(r'./data/output/gps/sample/0327sample.csv')
        print(gps_df)
        # gps_df = gps_df[gps_df['agent_id'] == 'xa_car_4']

        # 2.æ„å»ºä¸€ä¸ªnet, è¦æ±‚è·¯ç½‘çº¿å±‚å’Œè·¯ç½‘ç‚¹å±‚å¿…é¡»æ˜¯WGS-84, EPSG:4326 åœ°ç†åæ ‡ç³»
        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        my_net = Net(link_gdf=link,
                     node_gdf=node)
        my_net.init_net()  # netåˆå§‹åŒ–

        # 3. åŒ¹é…
        mpm = MapMatch(net=my_net, gps_df=gps_df, gps_buffer=100, flag_name='xa_sample',
               use_sub_net=True, use_heading_inf=True,
               omitted_l=6.0, del_dwell=True, dwell_l_length=25.0, dwell_n=1,
               lower_n=2, is_lower_f=True,
               is_rolling_average=True, window=3,
               dense_gps=False,
               export_html=True, export_geo_res=True, use_gps_source=False,
               out_fldr=r'./data/output/match_visualization/xa_sample',
               gps_radius=10.0)

        # ç¬¬ä¸€ä¸ªè¿”å›ç»“æœæ˜¯åŒ¹é…ç»“æœè¡¨
        # ç¬¬äºŒä¸ªæ˜¯å‘ç”Ÿè­¦å‘Šçš„ç›¸å…³ä¿¡æ¯
        # ç¬¬ä¸‰ä¸ªæ˜¯åŒ¹é…é”™è¯¯çš„agentçš„idç¼–å·åˆ—è¡¨
        match_res, may_error_info, error_info = mpm.execute()
        print(match_res)
        match_res.to_csv(r'./data/output/match_visualization/xa_sample/match_res.csv', encoding='utf_8_sig', index=False)


6.2.1. åŒ¹é…ç»“æœè¡¨(match_res)å­—æ®µå«ä¹‰
::::::::::::::::::::::::::::::::::::::::::::::::

.. csv-table:: åœ°å›¾åŒ¹é…ç»“æœè¡¨å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µå«ä¹‰", "å­—æ®µç±»å‹"
    :widths: 15, 15, 40

    "agent_id","gpsç‚¹æ‰€å±agent_id","string"
    "seq","gpsç‚¹çš„åºåˆ—ID","int"
    "sub_seq","gpsç‚¹çš„å­åºåˆ—ID, å¦‚æœå­åºåˆ—>0, è¯´æ˜è¯¥ç‚¹æ˜¯åœ¨åŒ¹é…åè¡¥å‡ºæ¥çš„ç‚¹, ç§°ä¹‹ä¸ºåè¡¥ç‚¹, ä¸ä¼šå»è®¡ç®—å…¶åœ¨ç›®æ ‡è·¯æ®µä¸Šçš„æŠ•å½±ç‚¹","int"
    "time","gpså®šä½æ—¶é—´","datetime"
    "loc_type","gpsç‚¹ç±»å‹, ä¸‰ç±»: sï¼šæºGPSç‚¹ã€dï¼šå¢å¯†ç‚¹ã€cï¼šåè¡¥ç‚¹","string"
    "link_id","gpsåŒ¹é…è·¯æ®µçš„link_idï¼Œå¯¹åº”è·¯ç½‘çš„link_idå­—æ®µ","int"
    "from_node","gpsåŒ¹é…è·¯æ®µçš„èµ·å§‹èŠ‚ç‚¹(è¡¨å¾è¡Œè½¦æ–¹å‘èµ·ç‚¹)","int"
    "to_node","gpsåŒ¹é…è·¯æ®µçš„ç»ˆåˆ°èŠ‚ç‚¹(è¡¨å¾è¡Œè½¦æ–¹å‘ç»ˆç‚¹)","int"
    "lng","gpsç‚¹çš„ç»åº¦, EPSG:4326","float"
    "lat","gpsç‚¹çš„çº¬åº¦, EPSG:4326","float"
    "prj_lng","gpsç‚¹åœ¨åŒ¹é…è·¯æ®µä¸Šå¯¹åº”åŒ¹é…ç‚¹çš„ç»åº¦, EPSG:4326, åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","float"
    "prj_lat","gpsç‚¹åœ¨åŒ¹é…è·¯æ®µä¸Šå¯¹åº”åŒ¹é…ç‚¹çš„çº¬åº¦, EPSG:4326, åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","float"
    "dis_to_next","gpsæŠ•å½±ç‚¹ä¸ååºç›¸é‚»gpsæŠ•å½±ç‚¹çš„è·¯å¾„è·ç¦»(ä¸è€ƒè™‘åè¡¥ç‚¹), åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","float"
    "å…¶ä»–å­—æ®µç”¨æˆ·æŒ‡å®šè¾“å‡ºçš„å­—æ®µ", "å‚ç…§å‚æ•°user_field_list", ""


å…³äºsub_seqï¼š

.. image:: _static/images/gps_segmentize.png
    :align: center

--------------------------------------------------------------------------------


.. note::

   å¯¹äºdirä¸º0çš„åŒå‘è·¯æ®µï¼Œä¾‹ï¼šlink_id=12, from_node=2, to_node=3ï¼ŒåŒ¹é…ç»“æœä¸­åŒ¹é…åˆ°link_idä¸º12æ—¶ï¼Œå…¶(from_node, to_node) å¯èƒ½ä¸º(2, 3) ä¹Ÿå¯èƒ½ä¸º (3, 2), è¿™ä¸ªç”±GPSçš„å®é™…è¡Œè½¦æ–¹å‘å†³å®š



6.2.2. è­¦å‘Šä¿¡æ¯å’Œé”™è¯¯ä¿¡æ¯å«ä¹‰
::::::::::::::::::::::::::::::::::::::::::::::::

åœ°å›¾åŒ¹é…æ¥å£ä¼šè¿”å›ä¸‰ä¸ªç»“æœï¼Œç¬¬ä¸€ä¸ªæ˜¯åŒ¹é…ç»“æœè¡¨ï¼Œç¬¬äºŒä¸ªæ˜¯è­¦å‘Šçš„ç›¸å…³ä¿¡æ¯ï¼Œç¬¬ä¸‰ä¸ªæ˜¯åŒ¹é…å‘ç”Ÿé”™è¯¯çš„agent_idç¼–å·åˆ—è¡¨

* è­¦å‘Šä¿¡æ¯
    å‘ç”Ÿè­¦å‘Šçš„agentï¼Œå…¶åŒ¹é…ç»“æœï¼Œè¿åŒæ²¡æœ‰ä»»ä½•è­¦å‘Šçš„agentï¼Œä¼šä¸€èµ·ä¼šè¾“å‡ºåœ¨match_resä¸­

    è­¦å‘Šä¿¡æ¯may_error_infoçš„æ•°æ®ç»“æ„æ˜¯å­—å…¸ï¼šé”®è¡¨ç¤ºagent_idï¼Œå€¼æ˜¯ä¸€ä¸ªè¡¨ï¼Œè®°å½•äº†å½“å‰agentåœ¨åŒ¹é…è¿‡ç¨‹ä¸­å‘ç”Ÿè­¦å‘Šçš„è·¯æ®µä¿¡æ¯(å¯åœ¨HTMLä¸­å¯è§†åŒ–æŸ¥çœ‹)

    å¯¹å€¼(ä¸€ä¸ªDataFrame)çš„ç¤ºä¾‹è§£é‡Šï¼Œä»¥ä¸‹å›¾ç¬¬ä¸€è¡Œä¸ºä¾‹ï¼Œä¸€è¡Œä»£è¡¨äº†ä¸€æ¬¡è­¦å‘Šï¼Œæˆ‘ä»¬åªç”¨å…³å¿ƒfrom_ftåˆ—ã€to_ftåˆ—å€¼çš„ç¬¬2~3ä¸ªå…ƒç´ (è·¯æ®µçš„èµ·å§‹èŠ‚ç‚¹)ï¼ŒåŒ¹é…link(605186, 596721) åˆ° åŒ¹é…link(98359, 258807) ä¹‹é—´ä¸è¿é€šï¼Œè¡¨æ˜äº†å¯èƒ½å­˜åœ¨è·¯æ®µç¼ºå¤±


.. code-block:: python
    :linenos:

    UserWarning: gps seq: 10 -> 11 çŠ¶æ€è½¬ç§»å‡ºç°é—®é¢˜, from_link:(605186, 596721) -> to_link:(98359, 258807)
    UserWarning: gps seq: 111 -> 112 çŠ¶æ€è½¬ç§»å‡ºç°é—®é¢˜, from_link:(150627, 38018) -> to_link:(78195, 26627)


.. image:: _static/images/warn_info.jpg
    :align: center

----------------------------------------


* é”™è¯¯ä¿¡æ¯
    error_infoçš„æ•°æ®ç»“æ„æ˜¯åˆ—è¡¨ï¼Œè®°å½•çš„æ˜¯åŒ¹é…å‘ç”Ÿé”™è¯¯çš„agent_idï¼Œä¸€èˆ¬æ˜¯GPSæ•°æ®å…³è”ä¸åˆ°ä»»ä½•è·¯ç½‘ã€æˆ–è€…GPSæ•°æ®ç‚¹ä¸è¶³ä¸¤ä¸ªã€æˆ–è€…è·¯ç½‘çº¿å±‚æœ‰é‡å æŠ˜ç‚¹ï¼Œå¯¹äºè¿™äº›é”™è¯¯gotrackitéƒ½ä¼šè¾“å‡ºæŠ¥é”™ä¿¡æ¯ç„¶åè·³è¿‡è¯¥æ¬¡åŒ¹é…



.. _åœ°å›¾åŒ¹é…å‚æ•°è§£é‡Š:

6.2.3. åœ°å›¾åŒ¹é…æ¥å£MapMatchå‚æ•°è§£é‡Š
::::::::::::::::::::::::::::::::::::::::::::::::

* flag_name
    æ ‡è®°å­—ç¬¦åç§°, ä¼šç”¨äºæ ‡è®°è¾“å‡ºçš„å¯è§†åŒ–æ–‡ä»¶, é»˜è®¤"test"

* net
    gotrackitè·¯ç½‘å¯¹è±¡, å¿…é¡»æŒ‡å®š

* use_sub_net
    æ˜¯å¦åœ¨å­ç½‘ç»œä¸Šè¿›è¡Œè®¡ç®—, é»˜è®¤True

* gps_df
    GPSæ•°æ®, å¿…é¡»æŒ‡å®š

* time_format
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿, é»˜è®¤"%Y-%m-%d %H:%M:%S"ï¼Œå¯ä»¥å‚ç…§pandasä¸­pd.to_datetime()å‡½æ•°çš„formatå‚æ•°

    å‚è€ƒï¼š`pd.to_datetimeè§£é‡Š <https://pandas.pydata.org/pandas-docs/version/0.20/generated/pandas.to_datetime.html#>`_ã€`ISO_8601 <https://en.wikipedia.org/wiki/ISO_8601>`_

* time_unit
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„å•ä½, å¦‚æœæ—¶é—´åˆ—æ˜¯æ•°å€¼(ç§’æˆ–è€…æ¯«ç§’,s æˆ–è€… ms), ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§è¯¥å‚æ•°æ„å»ºæ—¶é—´åˆ—, é»˜è®¤'s'ã€‚Gotrackitä¼šå…ˆå°è¯•ä½¿ç”¨time_formatè¿›è¡Œæ—¶é—´åˆ—æ„å»ºï¼Œå¦‚æœå¤±è´¥ä¼šå†æ¬¡å°è¯•ä½¿ç”¨time_unitè¿›è¡Œæ—¶é—´åˆ—æ„å»º

* gps_buffer
    GPSçš„æœç´¢åŠå¾„, å•ä½ç±³, æ„ä¸ºåªé€‰å–æ¯ä¸ªgpsç‚¹é™„è¿‘gps_bufferç±³èŒƒå›´å†…çš„è·¯æ®µä½œä¸ºåˆæ­¥å€™é€‰è·¯æ®µ, é»˜è®¤200.0m

* gps_route_buffer_gap
    åŠå¾„å¢é‡, gps_buffer + gps_route_buffer_gap çš„åŠå¾„èŒƒå›´ç”¨äºè®¡ç®—å­ç½‘ç»œ, é»˜è®¤15.0m

* top_k
    é€‰å–æ¯ä¸ªGPSç‚¹bufferèŒƒå›´å†…çš„æœ€è¿‘çš„top_kä¸ªè·¯æ®µï¼Œé»˜è®¤20ã€‚æ¯ä¸ªGPSç‚¹ä¾æ®æŒ‡å®šçš„gps_bufferå»ºç«‹åœ†å½¢ç¼“å†²åŒºï¼Œç¼“å†²åŒºå…³è”çš„è·¯æ®µä¸ºè¯¥GPSç‚¹çš„åˆæ­¥å€™é€‰è·¯æ®µï¼Œç„¶åä¾æ®top_kå‚æ•°é€‰å–ç¦»è¯¥GPSç‚¹æœ€è¿‘çš„top_kä¸ªè·¯æ®µä½œä¸ºæœ€ç»ˆå€™é€‰è·¯æ®µ

    æ³¨æ„ï¼šå¯¹äºdirä¸º0çš„è·¯æ®µï¼Œå®é™…ä¼šè¢«æ‹†åˆ†ä¸ºä¸¤æ¡æ‹“æ‰‘ç›¸åçš„è·¯æ®µï¼Œå¦‚æœæŸGPSçš„bufferèŒƒå›´å†…å…³è”åˆ°äº†20æ¡åŒå‘è·¯æ®µï¼Œtop_kè‡³å°‘ä¸º40æ‰èƒ½å°†è¿™20æ¡åŒå‘è·¯æ®µé€‰ä¸ºæœ€ç»ˆå€™é€‰

* beta
    è¯¥å€¼è¶Šå¤§, çŠ¶æ€è½¬ç§»æ¦‚ç‡å¯¹äºè·ç¦»å·®(ç±³, ç›¸é‚»æŠ•å½±ç‚¹è·¯å¾„é•¿åº¦ ä¸ ç›¸é‚»GPSç‚¹çƒé¢è·ç¦» çš„è·ç¦»å·®)è¶Šä¸æ•æ„Ÿ, å¤§äº0çš„å€¼, é»˜è®¤6.0m

* gps_sigma
    è¯¥å€¼è¶Šå¤§, å‘å°„æ¦‚ç‡å¯¹è·ç¦»(ç±³, GPSç‚¹åˆ°å€™é€‰è·¯æ®µçš„è·ç¦»)è¶Šä¸æ•æ„Ÿ, å¤§äº0çš„å€¼, é»˜è®¤30.0m

* dis_para
    è·ç¦»(m)çš„ç¼©æ”¾ç³»æ•°, å¤§äº0çš„å€¼, é»˜è®¤0.1

* del_dwell
    æ˜¯å¦è¿›è¡Œåœç•™ç‚¹è¯†åˆ«å¹¶ä¸”åˆ é™¤åœç•™ç‚¹ï¼Œé»˜è®¤True

* dwell_l_length
    åœç•™ç‚¹è¯†åˆ«è·ç¦»é˜ˆå€¼, é»˜è®¤10m

* dwell_n
    è¶…è¿‡è¿ç»­dwell_nä¸ªç›¸é‚»GPSç‚¹çš„è·ç¦»å°äºdwell_l_lengthï¼Œé‚£ä¹ˆè¿™ä¸€ç»„ç‚¹å°±ä¼šè¢«è¯†åˆ«ä¸ºåœç•™ç‚¹ï¼Œé»˜è®¤2

* is_lower_f
    æ˜¯å¦å¯¹GPSæ•°æ®è¿›è¡Œæ•°æ®é™é¢‘, é€‚ç”¨äº: é«˜é¢‘-é«˜å®šä½è¯¯å·® GPSæ•°æ®, é»˜è®¤False

* lower_n
    é™é¢‘å€ç‡, é»˜è®¤2

* is_rolling_average
    æ˜¯å¦å¯ç”¨æ»‘åŠ¨çª—å£å¹³å‡å¯¹GPSæ•°æ®è¿›è¡Œé™å™ª, é»˜è®¤False

* window
    æ»‘åŠ¨çª—å£å¤§å°, é»˜è®¤2

* dense_gps
    æ˜¯å¦å¯¹GPSæ•°æ®è¿›è¡Œå¢å¯†, é»˜è®¤True

* dense_interval
    å½“ç›¸é‚»GPSç‚¹çš„çƒé¢è·ç¦»Lè¶…è¿‡dense_intervalå³è¿›è¡Œå¢å¯†, è¿›è¡Œ int(L / dense_interval) + 1  ç­‰åˆ†åŠ å¯†, é»˜è®¤100.0

.. image:: _static/images/gps_process.jpg
    :align: center

----------------------------------------

* use_heading_inf
    æ˜¯å¦åˆ©ç”¨GPSçš„å·®åˆ†æ–¹å‘å‘é‡ä¿®æ­£å‘å°„æ¦‚ç‡(åˆ©ç”¨GPSå‰åç‚¹ä½å¤§è‡´ä¼°è®¡èˆªå‘è§’), é€‚ç”¨äº: ä½å®šä½è¯¯å·® GPSæ•°æ® æˆ–è€… ä½é¢‘å®šä½æ•°æ®(é…åˆåŠ å¯†å‚æ•°), é»˜è®¤False

* heading_para_array
    å·®åˆ†æ–¹å‘ä¿®æ­£å‚æ•°, é»˜è®¤np.array([1.0, 1.0, 1.0, 0.1, 0.0001, 0.0001, 0.00001, 0.000001, 0.000001])

* omitted_l
    å•ä½ç±³ï¼Œå¦‚æœå‰ååºGPSç‚¹çš„å¹³å‡è·ç¦»å°äºè¯¥å€¼ï¼Œåˆ™è®¤ä¸ºè¯¥GPSç‚¹çš„èˆªå‘è§’ä¸å‡†ç¡®ï¼Œä¸ä¼šåœ¨è¯¥ç‚¹åº”ç”¨èˆªå‘è§’é™åˆ¶ï¼Œé»˜è®¤6.0m

å¯¹æ–¹å‘ä¿®æ­£ç³»æ•°çš„è§£é‡Šï¼š

.. image:: _static/images/heading_para_1.png
    :align: center

----------------------------------------

.. image:: _static/images/heading_para_2.png
    :align: center

----------------------------------------

* instant_output
    æ˜¯å¦æ¯åŒ¹é…å®Œä¸€æ¡è½¨è¿¹å°±å­˜å‚¨csvåŒ¹é…ç»“æœ, é»˜è®¤False

* export_html
    æ˜¯å¦è¾“å‡ºç½‘é¡µå¯è§†åŒ–ç»“æœhtmlæ–‡ä»¶, é»˜è®¤True

* use_gps_source
    æ˜¯å¦åœ¨HTMLå¯è§†åŒ–ç»“æœä¸­ä½¿ç”¨GPSæºæ•°æ®è¿›è¡Œå±•ç¤º, é»˜è®¤False

* export_all_agents
    æ˜¯å¦å°†æ‰€æœ‰agentçš„å¯è§†åŒ–å­˜å‚¨äºä¸€ä¸ªhtmlæ–‡ä»¶ä¸­

* gps_radius
    HTMLå¯è§†åŒ–ä¸­GPSç‚¹çš„åŠå¾„å¤§å°ï¼Œå•ä½ç±³ï¼Œé»˜è®¤8ç±³

* export_geo_res
    æ˜¯å¦è¾“å‡ºåŒ¹é…ç»“æœçš„geojsonå‡ ä½•å¯è§†åŒ–æ–‡ä»¶, é»˜è®¤False

* visualization_cache_times
    æ¯åŒ¹é…å®Œvisualization_cache_timesè¾†è½¦å†è¿›è¡Œç»“æœ(htmlã€geojsonå¯è§†åŒ–ç»“æœ)çš„ç»Ÿä¸€å­˜å‚¨(å¯å¹¶å‘å­˜å‚¨), é»˜è®¤50

* out_fldr
    ä¿å­˜åŒ¹é…ç»“æœçš„æ–‡ä»¶(htmlæ–‡ä»¶ã€geojsonæ–‡ä»¶ã€csvæ–‡ä»¶)ç›®å½•, é»˜è®¤å½“å‰ç›®å½•

* user_filed_list(v0.3.2æ–°å¢)
    GPSæ•°æ®è¡¨ä¸­å¯ä»¥éšåŒ¹é…ç»“æœä¸€åŒè¾“å‡ºçš„å­—æ®µåˆ—è¡¨ï¼Œ ä¾‹å¦‚:['gps_speed', 'origin_agent']ï¼Œè‹¥å¯ç”¨äº†æ»‘åŠ¨çª—å£å¹³å‡ï¼Œè¯¥å‚æ•°è‡ªåŠ¨å¤±æ•ˆï¼Œé»˜è®¤None

    è¿™äº›å­—æ®µå¿…é¡»åœ¨gpsè¡¨ä¸­å®é™…å­˜åœ¨, ä¸”åä¸èƒ½ä¸ä»¥ä¸‹å†…ç½®å­—æ®µç›¸åŒï¼šagent_idã€seqã€sub_seqã€timeã€loc_typeã€link_idã€dirã€from_nodeã€to_nodeã€lngã€latã€prj_lngã€prj_latã€dis_to_nextã€geometryã€prj_p


* use_para_grid
    æ˜¯å¦å¯ç”¨ç½‘æ ¼å‚æ•°æœç´¢

* para_grid
    ç½‘æ ¼å‚æ•°å¯¹è±¡

.. _æ„å»ºNetçš„ç›¸å…³å‚æ•°:
6.2.4. æ„å»ºNetæ—¶ç›¸å…³çš„å‚æ•°
::::::::::::::::::::::::::::::::::::::::::::::::

* link_path
    çº¿å±‚æ•°æ®çš„æ–‡ä»¶è·¯å¾„

* node_path
    ç‚¹å±‚æ•°æ®çš„æ–‡ä»¶è·¯å¾„

* link_gdf
    çº¿å±‚æ•°æ®GeoDataFrameï¼Œä¸link_pathåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª, æ¨èé‡‡ç”¨ä¼ å…¥link_gdfçš„æ–¹å¼

* node_gdf
    ç‚¹å±‚æ•°æ®GeoDataFrameï¼Œä¸node_pathåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª, æ¨èé‡‡ç”¨ä¼ å…¥node_gdfçš„æ–¹å¼

* cut_off
    è·¯å¾„æœç´¢æˆªæ–­é•¿åº¦, ç±³, é»˜è®¤1200.0m

* not_conn_cost
    ä¸è¿é€šè·¯å¾„çš„å¼€é”€ï¼Œé»˜è®¤1000.0m

* fmm_cache
    æ˜¯å¦å¯ç”¨é¢„è®¡ç®—ï¼Œè‹¥å¯ç”¨åï¼Œé¢„è®¡ç®—ç»“æœä¼šç¼“å­˜åœ¨fmm_cache_fldrä¸‹ï¼Œé»˜è®¤False

* fmm_cache_fldr
    å­˜å‚¨é¢„è®¡ç®—ç»“æœçš„ç›®å½•ï¼Œé»˜è®¤./

* recalc_cache
    æ˜¯å¦é‡æ–°é¢„è®¡ç®—ï¼Œé»˜è®¤Trueã€‚å–å€¼Falseæ—¶ï¼Œgotrackitä¼šå»fmm_cache_fldrä¸‹è¯»å–ç¼“å­˜ï¼Œè‹¥è¯»å–ä¸åˆ°åˆ™ä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—

* cache_slice
    å¤§äº0çš„æ•´æ•°ï¼Œè¡¨ç¤ºä½¿ç”¨å°†è·¯å¾„ç»“æœåˆ‡åˆ†ä¸ºcache_sliceéƒ¨åˆ†è¿›è¡Œæ•°æ®æ ‡å‡†åŒ–(å¤§è§„æ¨¡è·¯ç½‘ä¸‹å¢å¤§è¯¥å€¼å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º)

* is_hierarchical
    æ˜¯å¦å¯ç”¨å±‚æ¬¡å…³è”ï¼Œåœ¨è¶…å¤§è·¯ç½‘ã€è¾ƒé•¿GPSè½¨è¿¹çš„æƒ…å†µä¸‹å¼€å¯ä¸ºTrueï¼Œå¯ä»¥æ˜¾è‘—æå‡è‡ªå­ç½‘ç»œçš„ç©ºé—´å…³è”æ•ˆç‡ï¼Œé»˜è®¤False

* grid_len
    å±‚æ¬¡å…³è”ä¸­çš„æ …æ ¼è¾¹é•¿(m)ï¼Œé»˜è®¤2000m


æˆªæ­¢v0.3.1ï¼Œç”¨æˆ·åªå¯ä»¥è‡ªè¡ŒæŒ‡å®šä»¥ä¸Š12ä¸ªå‚æ•°ï¼Œå…¶ä»–çš„å‚æ•°ä¸ºå†…ç½®å‚æ•°(éƒ¨åˆ†å‚æ•°è¿˜æœªå¯ç”¨)ï¼Œç”¨æˆ·ä¸å¯è‡ªè¡ŒæŒ‡å®šï¼


6.3. å¯ç”¨è·¯å¾„é¢„å­˜å‚¨è¿›è¡ŒåŠ é€Ÿ
``````````````````````````````

åœ¨åœ°å›¾åŒ¹é…çš„è¿‡ç¨‹ä¸­, åœ¨ä»¥ä¸‹ä¸¤ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­å¼€é”€è¾ƒå¤§ï¼š

* GPSç‚¹åˆ°é‚»è¿‘å€™é€‰è·¯æ®µçš„æŠ•å½±å‚æ•°

* å€™é€‰è·¯æ®µåˆ°å€™é€‰è·¯æ®µä¹‹é—´çš„æœ€çŸ­è·¯å¾„è®¡ç®—å¼€é”€

ç„¶è€Œï¼Œè¿™éƒ¨åˆ†çš„è®¡ç®—ï¼Œåœ¨ä¸åŒçš„agentsè½¦è¾†åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šéƒ¨åˆ†éƒ½æ˜¯é‡å¤è®¡ç®—é¡¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½å¦åŸºäºä¸€ç§é¢„è®¡ç®—çš„æ€æƒ³ï¼Œå…ˆå°†æ‰€æœ‰å¯èƒ½çš„æœ€çŸ­è·¯è®¡ç®—ã€æŠ•å½±å‚æ•°è®¡ç®—é¢„å…ˆè®¡ç®—å‡ºæ¥å‘¢ï¼Ÿæˆ‘ä»¬å¯èƒ½ä»…ä»…åªéœ€è¦åœ¨åŒ¹é…å‰ç¨å¾®å¤šèŠ±ä¸€ç‚¹æ—¶é—´æ¥è¿›è¡Œé¢„è®¡ç®—ï¼Œç„¶åå°†è¿™äº›é¢„è®¡ç®—çš„ç»“æœå­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä»¥åæ¯æ¬¡åŒ¹é…åªéœ€è¦è¯»å–æŒ‡å®šè·¯å¾„çš„é¢„è®¡ç®—ç»“æœå°†å…¶åŠ è½½åˆ°å†…å­˜, æˆ‘ä»¬å³å¯ä»¥O(1)çš„æ—¶é—´å¤æ‚åº¦è·å¾—è¿™äº›æœ€çŸ­è·¯ç»“æœä»¥åŠæŠ•å½±å‚æ•°ç»“æœï¼Œgotrackitå®ç°äº†è¿™ä¸€è¿‡ç¨‹ï¼Œä»¥ä¸‹ä»£ç ä¸ºä½¿ç”¨é¢„è®¡ç®—çš„åŒ¹é…æ–¹å¼ï¼š

.. note::

   åªè¦è·¯ç½‘å‘ç”Ÿäº†ä»»ä½•å˜åŒ–,è¯·é‡æ–°è®¡ç®—è·¯å¾„ç¼“å­˜


.. note::

   è®¡ç®—è·¯å¾„ç¼“å­˜,è¯·ç¡®ä¿ä½ çš„è·¯æ®µçº¿å‹æ²¡æœ‰é‡å¤ç‚¹,ä½ å¯ä»¥ä½¿ç”¨ `æ¸…æ´—è·¯ç½‘çº¿å±‚æ•°æ®`_

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # æ„å»ºnetæ—¶æŒ‡å®šfmm_cacheå‚æ•°ä¸ºTrue, è¡¨ç¤ºåœ¨è¿™æ¬¡æ„å»ºnetå¯¹è±¡æ—¶è¿›è¡Œé¢„è®¡ç®—
        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        my_net = Net(link_gdf=link,
                     node_gdf=node,
                     fmm_cache=True, fmm_cache_fldr=r'./data/input/net/xian/', recalc_cache=True,
                     cut_off=800.0,
                     cache_slice=6)
        my_net.init_net()  # netåˆå§‹åŒ–

        # fmm_cache_fldrç”¨äºæŒ‡å®šå­˜å‚¨é¢„è®¡ç®—ç»“æœçš„æ–‡ä»¶ç›®å½•
        # cut_offä¸º800m, è¡¨ç¤ºæœ€çŸ­è·¯å¾„æœç´¢è¿‡ç¨‹ä¸­, åªè®¡ç®—æœ€çŸ­è·¯å¾„è·ç¦»å°äº800.0mçš„è·¯å¾„(è€ƒè™‘åˆ°ç›¸é‚»GPSç‚¹è·ç¦»è·¨åº¦ä¸ä¼šå¤ªå¤§)
        # cache_slice=6, è¡¨ç¤ºä½¿ç”¨å°†è·¯å¾„ç»“æœåˆ‡åˆ†ä¸º6éƒ¨åˆ†è¿›è¡Œæ•°æ®æ ‡å‡†åŒ–(å¤§è§„æ¨¡è·¯ç½‘é˜²æ­¢å†…å­˜æº¢å‡º)


ä»¥ä¸Šçš„è·¯ç½‘æ„å»ºçš„ä»£ç æ‰§è¡Œç»“æŸå, ä¼šåœ¨r'./data/input/net/test/0402BUG/load/'ä¸‹ç”Ÿæˆä¸¤ä¸ªé¢„è®¡ç®—ç»“æœæ–‡ä»¶, ç¬”è€…ç”¨æ·±åœ³çš„è·¯ç½‘(9wæ¡link, 8wä¸ªèŠ‚ç‚¹), é¢„è®¡ç®—çš„æ—¶é—´å¤§æ¦‚ä¸ºä¸¤åˆ†é’Ÿ, åœ¨ä½¿ç”¨çš„è·¯ç½‘æ²¡æœ‰ä»»ä½•å˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¸‹æ¬¡ä½¿ç”¨è¯¥è·¯ç½‘è¿›è¡ŒåŒ¹é…å¯ä»¥ç›´æ¥æŒ‡å®šé¢„è®¡ç®—ç»“æœçš„è·¯å¾„å³å¯, æ­¤æ—¶ç›´æ¥æŒ‡å®šrecalc_cache=False, æ„æ€ä¸ºç›´æ¥ä»fmm_cache_fldrä¸­è¯»å–é¢„è®¡ç®—ç»“æœ, ä¸å†é‡å¤é¢„è®¡ç®—çš„è¿‡ç¨‹


.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # æ„å»ºnetæ—¶æŒ‡å®šfmm_cacheå‚æ•°ä¸ºTrue, è¡¨ç¤ºåœ¨è¿™æ¬¡æ„å»ºnetå¯¹è±¡æ—¶è¿›è¡Œé¢„è®¡ç®—
        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        my_net = Net(link_gdf=link,
                     node_gdf=node,
                     fmm_cache=True, fmm_cache_fldr=r'./data/input/net/xian/', recalc_cache=False)
        my_net.init_net()  # netåˆå§‹åŒ–

        # recalc_cache=Falseæ„æ€ä¸ºç›´æ¥ä»fmm_cache_fldrä¸­è¯»å–é¢„è®¡ç®—ç»“æœ, ä¸å†é‡å¤é¢„è®¡ç®—çš„è¿‡ç¨‹

        # æ­¤æ—¶ä¼ å…¥çš„netå°±å¸¦æœ‰é¢„è®¡ç®—çš„ç»“æœ, åŒ¹é…é€Ÿåº¦ä¼šæå‡
        mpm = MapMatch(net=my_net, gps_df=gps_df, gps_buffer=100, flag_name='xa_sample',
                   use_sub_net=False, use_heading_inf=True,
                   omitted_l=6.0, del_dwell=True, dwell_l_length=25.0, dwell_n=1,
                   lower_n=2, is_lower_f=True,
                   is_rolling_average=True, window=3,
                   export_html=False, export_geo_res=False, use_gps_source=False,
                   out_fldr=r'./data/output/match_visualization/xa_sample', dense_gps=False,
                   gps_radius=20.0)
        match_res, may_error_info, error_info = mpm.execute()
        print(match_res)



æ„å»ºNetæ—¶é¢„è®¡ç®—ç›¸å…³çš„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š

* fmm_cache
    æ˜¯å¦å¯ç”¨è·¯å¾„ç¼“å­˜é¢„è®¡ç®—, é»˜è®¤False

* cache_cn
    ä½¿ç”¨å‡ ä¸ªæ ¸è¿›è¡Œè·¯å¾„é¢„è®¡ç®—, é»˜è®¤2

* fmm_cache_fldr
    å­˜å‚¨è·¯å¾„é¢„è®¡ç®—ç»“æœçš„æ–‡ä»¶ç›®å½•, é»˜è®¤./

* recalc_cache
    æ˜¯å¦é‡æ–°è®¡ç®—è·¯å¾„ç¼“å­˜, é»˜è®¤True

* cut_off
    è·¯å¾„æœç´¢æˆªæ–­é•¿åº¦, ç±³, é»˜è®¤1200.0m

* cache_name
    è·¯å¾„é¢„å­˜å‚¨çš„æ ‡å¿—åç§°, é»˜è®¤cache, ä¸¤ä¸ªç¼“å­˜æ–‡ä»¶çš„åç§°: {cache_name}_path_cache, {cache_name}_prj

* cache_slice
    å¯¹ç¼“å­˜è¿›è¡Œåˆ‡ç‰‡(åˆ‡ä¸ºcache_sliceä»½)åè½¬æ¢æ ¼å¼, è¿›è¡Œå­˜å‚¨(é˜²æ­¢å¤§è§„æ¨¡è·¯ç½‘å¯¼è‡´å†…å­˜æº¢å‡º), é»˜è®¤2 * cache_cn, å¦‚æœå†…å­˜æº¢å‡ºå¯ä»¥å¢å¤§è¯¥å€¼


6.4. å¯ç”¨å¤šæ ¸è¿›è¡Œå¹¶è¡ŒåŒ¹é…
``````````````````````````````

è‹¥æƒ³åœ¨å¤šæ¡è½¨è¿¹ä¸Šå¼€å¯å¹¶è¡ŒåŒ¹é…,è¯·å°†mpm.execute()æ›¿æ¢ä¸ºmpm.multi_core_execute(core_num=x),å½“æ‚¨çš„agentæ•°ç›®å¤§äº50æ—¶,å¤šæ ¸çš„æ•ˆç‡æå‡æ‰ä¼šè¾ƒä¸ºæ˜æ˜¾

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import pandas as pd
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':

        # 1.è¯»å–GPSæ•°æ®
        # è¿™æ˜¯ä¸€ä¸ªæœ‰150è¾†è½¦çš„GPSæ•°æ®çš„æ–‡ä»¶
        gps_df = pd.read_csv(r'./data/output/gps/150_agents.csv')
        print(gps_df)

        # 2.æ„å»ºä¸€ä¸ªnet, è¦æ±‚è·¯ç½‘çº¿å±‚å’Œè·¯ç½‘ç‚¹å±‚å¿…é¡»æ˜¯WGS-84, EPSG:4326 åœ°ç†åæ ‡ç³»
        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        my_net = Net(link_gdf=link,
                     node_gdf=node,
                     fmm_cache=True, fmm_cache_fldr=r'./data/input/net/xian/', recalc_cache=False)
        my_net.init_net()  # netåˆå§‹åŒ–

        # 3. åŒ¹é…
        mpm = MapMatch(net=my_net, gps_df=gps_df, gps_buffer=100, flag_name='xa_sample',
               use_sub_net=True, use_heading_inf=True,
               omitted_l=6.0, del_dwell=True, dwell_l_length=25.0, dwell_n=1,
               lower_n=2, is_lower_f=True,
               is_rolling_average=True, window=3,
               dense_gps=False,
               export_html=False, export_geo_res=False, use_gps_source=False,
               out_fldr=r'./data/output/match_visualization/xa_sample',
               gps_radius=10.0)

        match_res, may_error_info, error_info = mpm.multi_core_execute(core_num=6)
        print(match_res)
        match_res.to_csv(r'./data/output/match_visualization/xa_sample/match_res.csv', encoding='utf_8_sig', index=False)


* core_num
    ç”¨å‡ ä¸ªæ ¸è¿›è¡ŒåŒ¹é…, é»˜è®¤1




6.5. ç®€åŒ–è·¯ç½‘çº¿å‹åŠ é€ŸåŒ¹é…
``````````````````````````````

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å¯¹è·¯ç½‘çº¿å±‚çš„å‡ ä½•è¿›è¡Œç®€åŒ–

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import pandas as pd
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':

        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')

        # é€‚å½“ç®€åŒ–çº¿å‹ï¼Œsimplify(x)ä¸­çš„xå•ä½ä¸ºmï¼Œè¯¥æ¥å£ä¼šä½¿ç”¨é“æ ¼æ‹‰æ–¯-æ™®å…‹ç®—æ³•å¯¹çº¿å‹è¿›è¡Œç®€åŒ–ï¼Œè¯¥å€¼å¦‚é€‰å–çš„è¿‡å¤§ä¼šå¯¼è‡´æ‰€æœ‰linkéƒ½é€€åŒ–ä¸ºç›´çº¿
        link = link.to_crs('ä½ é€‰å®šçš„å¹³é¢æŠ•å½±åæ ‡ç³»')
        link['geometry'] = link['geometry'].simplify(1.0)
        link = link.to_crs('EPSG:4326')
        my_net = Net(link_gdf=link,
                     node_gdf=node)
        my_net.init_net()  # netåˆå§‹åŒ–

        # åŒ¹é…
        mpm = MapMatch(net=my_net, gps_df=gps_df, gps_buffer=100, flag_name='xa_sample',
               use_sub_net=True, use_heading_inf=True,
               omitted_l=6.0, del_dwell=True, dwell_l_length=25.0, dwell_n=1,
               lower_n=2, is_lower_f=True,
               is_rolling_average=True, window=3,
               dense_gps=False,
               export_html=False, export_geo_res=False, use_gps_source=False,
               out_fldr=r'./data/output/match_visualization/xa_sample',
               gps_radius=10.0)

        match_res, may_error_info, error_info = mpm.execute()
        print(match_res)
        match_res.to_csv(r'./data/output/match_visualization/xa_sample/match_res.csv', encoding='utf_8_sig', index=False)


6.6. åˆ©ç”¨åˆ†å±‚ç´¢å¼•åŠ é€Ÿç©ºé—´å…³è”æ•ˆç‡
```````````````````````````````````````

é€‚ç”¨äºè¶…å¤§è§„æ¨¡ç½‘ç»œä¸‹çš„é•¿è½¨è¿¹åŒ¹é…ï¼Œå¯ä»¥å‡å°‘å­ç½‘ç»œçš„ç©ºé—´å…³è”æ—¶é—´å¼€é”€ï¼Œåˆå§‹åŒ–Netæ—¶æŒ‡å®šis_hierarchicalä¸ºTrueå³å¯å¼€å¯ç©ºé—´åˆ†å±‚ç´¢å¼•



6.7. ä½¿ç”¨ç½‘æ ¼å‚æ•°ç¡®å®šåˆç†çš„åŒ¹é…å‚æ•°
```````````````````````````````````````

æœ¬åŒ…æ”¯æŒå¯¹åœ°å›¾åŒ¹é…æ¥å£ä¸­çš„ä¸‹é¢å››ä¸ªå‚æ•°æ‰§è¡Œç½‘æ ¼æœç´¢ï¼š

betaã€gps_sigmaã€omitted_lã€use_heading_inf

å³ï¼šéå†è¿™å››ä¸ªå‚æ•°å¯èƒ½çš„ç»„åˆï¼Œç›´åˆ°åŒ¹é…ç»“æœæ²¡æœ‰è­¦å‘Šï¼Œå¦‚æœæ‰€æœ‰çš„å‚æ•°ç»„åˆéƒ½æœ‰è­¦å‘Šï¼Œé‚£ä¹ˆå°†è¾“å‡ºæœ€åä¸€æ¬¡å‚æ•°ç»„åˆçš„åŒ¹é…ç»“æœï¼ŒåŒ¹é…ç»“æœè¿˜å°†è¿”å›å‚æ•°ç»„åˆå¯¹åº”çš„åŒ¹é…è­¦å‘Šæ•°é‡

ä½¿ç”¨ç½‘æ ¼å‚æ•°æœç´¢ï¼Œä½ åªéœ€è¦æ„å»ºä¸€ä¸ªç½‘æ ¼å‚æ•°ç±»ï¼Œå¹¶ä¸”æŒ‡å®šå„å‚æ•°çš„å–å€¼åˆ—è¡¨å³å¯


.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import pandas as pd
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':

        gps_df = gpd.read_file(r'./data/output/gps/dense_example/test999.geojson')

        # è¯·ç•™æ„shpæ–‡ä»¶çš„ç¼–ç ï¼Œå¯ä»¥æ˜¾ç¤ºæŒ‡å®šencodingï¼Œç¡®ä¿å­—æ®µæ²¡æœ‰ä¹±ç 
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        my_net = Net(link_gdf=link, node_gdf=node, fmm_cache=True,
                 recalc_cache=False, fmm_cache_fldr=r'./data/input/net/xian')
        my_net.init_net()


        # 3. æ–°å»ºä¸€ä¸ªç½‘æ ¼å‚æ•°å¯¹è±¡
        # æŒ‡å®šå‚æ•°çš„å–å€¼èŒƒå›´åˆ—è¡¨
        # å¯æŒ‡å®šå››ä¸ªå‚æ•°åˆ—è¡¨
        # beta_list: list[float] = Noneï¼Œgps_sigma_list: list[float] = None
        # use_heading_inf_list: list[bool] = Noneï¼Œomitted_l_list: list[float] = None
        pgd = ParaGrid(use_heading_inf_list=[False, True], beta_list=[0.1, 1.0], gps_sigma_list=[1.0, 5.0])

        # 4. åŒ¹é…
        # ä¼ å…¥ç½‘æ ¼å‚æ•°ï¼šuse_para_grid=True, para_grid=pgd
         mpm = MapMatch(net=my_net, gps_df=gps_df, is_rolling_average=True, window=2, flag_name='dense_example',
                   export_html=True, export_geo_res=True,
                   gps_buffer=400,
                   out_fldr=r'./data/output/match_visualization/dense_example',
                   dense_gps=True,
                   use_sub_net=True, dense_interval=50.0, use_gps_source=False, use_heading_inf=True,
                   gps_radius=15.0, use_para_grid=True, para_grid=pgd)
        res, warn_info, error_info = mpm.execute()
        print(res)
        print(warn_info)
        print(error_info)
        print(pd.DataFrame(pgd.search_res))
        res.to_csv(r'./data/output/match_visualization/dense_example/match_res.csv', encoding='utf_8_sig', index=False)

        # å¯ä»¥æŸ¥çœ‹ä¸åŒçš„å‚æ•°ç»„åˆä¸‹ï¼ŒåŒ¹é…è¿‡ç¨‹ä¸­çš„è­¦å‘Šæ•°é‡
        print(pd.DataFrame(pgd.search_res))

ä½¿ç”¨å‚æ•°ç½‘æ ¼è¿›è¡ŒåŒ¹é…ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç»„åˆå‚æ•°ï¼Œå¹¶ä¸”è¾“å‡ºä¸åŒå‚æ•°ç»„åˆä¸‹çš„è­¦å‘Šæ•°ï¼š

.. image:: _static/images/para_grid.jpg
    :align: center
-------------------------------------------------


6.8. åŒ¹é…ç»“æœå¯è§†åŒ–
``````````````````````````````

6.8.1 HTMLåŠ¨ç”»å¯è§†åŒ–
:::::::::::::::::::::::::::::::::::::::::

åœ°å›¾åŒ¹é…æ¥å£ä¸­çš„å‚æ•°export_htmlæ§åˆ¶æ˜¯å¦è¾“å‡ºHTMLåŠ¨ç”»(è¾ƒä¸ºè€—æ—¶)

HTMLå¯è§†åŒ–éœ€è¦è¿æ¥ç½‘ç»œ(ä¸­å›½å¢ƒå†…å¯èƒ½éœ€è¦ç§‘å­¦ä¸Šç½‘)ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰“å¼€ç”Ÿæˆçš„htmlæ–‡ä»¶ï¼ŒæŒ‰ç…§ä¸‹å›¾ç‚¹å¼€æ—¶é—´è½´æ’­æ”¾å™¨

.. image:: _static/images/å¯è§†åŒ–æ“ä½œ.gif
    :align: center
-----------------------------------------------


htmlå¯è§†åŒ–æ–‡ä»¶æ˜¯æˆ‘ä»¬å¯¹åŒ¹é…ç»“æœè¿›è¡Œæ’æŸ¥çš„é‡è¦æ–‡ä»¶ï¼Œå®ƒå¯ä»¥æ¸…æ™°çš„å±•ç¤ºåŒ¹é…è¿‡ç¨‹ï¼š

 `gotrackitåœ°å›¾åŒ¹é…åŒ…å‚æ•°è¯¦è§£ä¸é—®é¢˜æ’æŸ¥ <https://www.bilibili.com/video/BV1qK421Y7hV>`_


6.8.2 geojsonçŸ¢é‡æ–‡ä»¶å¯è§†åŒ–
:::::::::::::::::::::::::::::::::::::::::

åœ°å›¾åŒ¹é…æ¥å£ä¸­çš„å‚æ•°export_geo_resæ§åˆ¶æ˜¯å¦è¾“å‡ºåŒ¹é…ç»“æœgeojsonçŸ¢é‡å›¾å±‚(è¾ƒä¸ºè€—æ—¶)ï¼Œä¸€ä¸ªagentçš„åŒ¹é…çŸ¢é‡ç»“æœç”±å››ä¸ªæ–‡ä»¶ç»„æˆï¼š

{flag_name}-{agent_id}-gps.geojsonï¼šgpsç‚¹çŸ¢é‡å›¾å±‚

{flag_name}-{agent_id}-match_link.geojsonï¼šåŒ¹é…linkçŸ¢é‡å›¾å±‚

{flag_name}-{agent_id}-prj_l.geojsonï¼šæŠ•å½±çº¿çŸ¢é‡å›¾å±‚

{flag_name}-{agent_id}-prj_p.geojsonï¼šåŒ¹é…è·¯æ®µæŠ•å½±ç‚¹çŸ¢é‡å›¾å±‚

å¯ä½¿ç”¨GISè½¯ä»¶å¯è§†åŒ–ï¼Œå¦‚QGIS


6.9. åŒ¹é…ç»“æœä¸æ­£ç¡®çš„è°ƒå‚æ–¹æ³•
``````````````````````````````

6.9.1. ç¨‹åºæç¤º-é¢„å¤„ç†åGPSç‚¹ä¸è¶³ä¸¤ä¸ª,æ— æ³•åŒ¹é…
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


* å¯èƒ½åœç•™ç‚¹è¯†åˆ«å‚æ•°ä¸åˆç†
    å¯èƒ½ä½ çš„GPSæ•°æ®æ˜¯é«˜é¢‘å®šä½æ•°æ®, ç›¸é‚»ç‚¹çš„é—´è·å°äºdwell_l_length, æ­¤æ—¶æ°å¥½ä½ å¼€äº†åœç•™ç‚¹è¯†åˆ«åŠŸèƒ½, æ‰€æœ‰çš„GPSæ•°æ®è¢«å½“ä½œåœç•™ç‚¹åˆ é™¤äº†, ä½ éœ€è¦å…³æ‰åœç•™ç‚¹è¯†åˆ«çš„å¼€å…³, å†æ‰“å¼€æ•°æ®é™é¢‘, å®è§‚è·¯ç½‘åŒ¹é…ä¸éœ€è¦è¿™ä¹ˆé«˜é¢‘çš„GPSå®šä½


* å¯èƒ½æ˜¯gps_bufferè®¾ç½®çš„å¤ªå°
    å¤§éƒ¨åˆ†GPSæ•°æ®åœ¨gps_bufferå†…æ²¡æœ‰å…³è”åˆ°ä»»ä½•è·¯ç½‘, é‚£ä¹ˆè¿™éƒ¨åˆ†GPSæ•°æ®ä¼šè¢«åˆ é™¤


* å¯èƒ½æ˜¯æºæ•°æ®é—®é¢˜
    å¯èƒ½æ˜¯æ­¤è¾†è½¦çš„GPSæ•°æ®ç‚¹æœ¬èº«å°±ä¸è¶³ä¸¤ä¸ª


6.9.2. åœ¨htmlå¯è§†åŒ–ç»“æœä¸­çœ‹åˆ°åŒ¹é…è·¯å¾„ä¸è¿ç»­
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


* å¯èƒ½æ˜¯gps_bufferå’Œtop_kçš„å€¼å°äº†(70%çš„é”™è¯¯å¯èƒ½æ˜¯è¿™ä¸ªåŸå› )
    æ¯ä¸ªGPSç‚¹ä¾æ®æŒ‡å®šçš„gps_bufferå»ºç«‹åœ†å½¢ç¼“å†²åŒºï¼Œç¼“å†²åŒºå†…å…³è”åˆ°çš„è·¯æ®µä¸ºè¯¥GPSç‚¹çš„åˆæ­¥å€™é€‰è·¯æ®µï¼Œç„¶åä¾æ®top_kå‚æ•°ï¼Œä»åˆæ­¥å€™é€‰è·¯æ®µä¸­é€‰å–ç¦»è¯¥GPSç‚¹æœ€è¿‘çš„top_kä¸ªè·¯æ®µä½œä¸ºæœ€ç»ˆå€™é€‰è·¯æ®µï¼Œ
    å¦‚æœGPSæœ¬èº«å®šä½è¯¯å·®è¾ƒå¤§ï¼Œä¸”è¿™ä¸¤ä¸ªå€¼è®¾å®šçš„æ¯”è¾ƒå°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­£ç¡®çš„è·¯æ®µæ²¡æœ‰è¢«é€‰ä¸ºæœ€ç»ˆå€™é€‰è·¯æ®µ, ä»è€Œå¯¼è‡´åŒ¹é…è·¯å¾„ä¸è¿ç»­

    å¦‚æœå¯ç”¨äº†å¢å¯†å‚æ•°ï¼Œä¸€èˆ¬æ¥è®²ï¼Œæœ€å¥½è¦å¢å¤§gps_bufferå’Œtop_kçš„å€¼

* å¯èƒ½æ˜¯æºè½¨è¿¹ç‚¹è¾ƒä¸ºç¨€ç–(ç›¸é‚»GPSç‚¹é—´è·å¤§äº1000m), ä½†æ˜¯æ²¡æœ‰å¯ç”¨è½¨è¿¹ç‚¹è‡ªåŠ¨å¢å¯†
    å¢å¯†è½¨è¿¹ç‚¹: dense_gpsæŒ‡å®šä¸ºTrueï¼›dense_interval æ¨è100 ~ 500ï¼Œè¡¨ç¤ºç›¸é‚»GPSç‚¹çš„è·ç¦»åªè¦è¶…è¿‡dense_intervalï¼Œå°±ä¼šåœ¨è¿™ä¸¤ä¸ªç‚¹ä¹‹é—´è¿›è¡Œå¢å¯†


* å¯èƒ½æ˜¯cut_offé€‰å°äº†
    cut_offæ˜¯è·¯å¾„æœç´¢æˆªæ–­å€¼, é»˜è®¤1200m


* å¯èƒ½æ˜¯gps_sigmaã€betaè®¾å®šä¸åˆç†
    æˆ‘ä»¬å°†GPSç‚¹åˆ°å€™é€‰è·¯æ®µçš„è·ç¦»ç§°ä¸ºprj_dis

    betaè¡¨å¾çš„æ˜¯å¯¹åŒ¹é…è·¯å¾„ä¸è¿ç»­çš„æƒ©ç½šåŠ›åº¦ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼Œæƒ©ç½šåŠ›åº¦è¶Šå°ï¼Œ åœ¨GPSæ•°æ®è¯¯å·®è¾ƒå¤§æ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°è·¯å¾„ä¸è¿ç»­çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥è°ƒå°betaï¼Œå¢åŠ å¯¹ä¸è¿ç»­æƒ…å†µçš„æƒ©ç½šï¼Œè°ƒå¤§gps_sigma(gps_sigmaè¡¨å¾çš„æ˜¯å¯¹prj_disçš„æƒ©ç½šï¼Œgps_sigmaå€¼è¶Šå°ï¼Œå¯¹prj_disçš„æƒ©ç½šåŠ›åº¦è¶Šå¤§)ï¼Œå¼±åŒ–GPSç‚¹å®šä½è¯¯å·®çš„å½±å“

    **è°ƒå°beta, è°ƒå¤§gps_sigma**ï¼šç›´è§‚æ„ä¹‰åœ¨äºæ›´åŠ çœ‹é‡è·¯å¾„çš„è¿ç»­æ€§ï¼Œå¯ä»¥å®¹å¿è¾ƒå¤§çš„prj_dis(å³è¾ƒå¤§çš„å®šä½è¯¯å·®)

    **è°ƒå¤§beta, è°ƒå°gps_sigma**ï¼šç›´è§‚æ„ä¹‰åœ¨äºç®—æ³•å€¾å‘äºé€‰æ‹©prj_diså°çš„è·¯æ®µä½œä¸ºåŒ¹é…ç»“æœï¼Œè€Œä¸çœ‹é‡åŒ¹é…ç»“æœçš„è·¯å¾„è¿ç»­æ€§ï¼Œå½“gps_sigmaè¶‹è¿‘äº0ï¼Œbetaè¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼ŒåŒ¹é…ç®—æ³•å°±é€€åŒ–ä¸ºæœ€è¿‘é‚»åŒ¹é…

    æ³¨æ„ï¼šgps_sigmaã€betaçš„å¤§å°æ˜¯ç›¸å¯¹çš„


* å¯èƒ½æ˜¯åˆå§‹åŒ–netæ—¶çš„not_conn_costå€¼å°äº†
    è¿™ä¸ªè¡¨å¾çš„æ˜¯å¯¹äºè·¯å¾„ä¸è¿ç»­çš„æƒ©ç½šåŠ›åº¦, å€¼è¶Šå¤§, æƒ©ç½šåŠ›åº¦è¶Šå¤§, è¶Šä¸å¯èƒ½è½¬ç§»åˆ°ä¸è¿ç»­çš„è·¯æ®µä¸Š


* å¯èƒ½æ˜¯è·¯ç½‘æœ¬èº«ä¸è¿é€š
    æ£€æŸ¥åœ¨è·¯å¾„æ–­å¼€çš„ä½ç½®, è·¯ç½‘æ˜¯å¦è”é€š


* å¯èƒ½æ˜¯GPSæ•°æ®é—®é¢˜
    å¯èƒ½æ˜¯ä½ çš„GPSæ•°æ®å®šä½æ—¶é—´ç²¾åº¦ä¸å¤Ÿï¼Œå¦‚å‰åä¸¤ä¸ªç‚¹çš„å®šä½æ—¶é—´éƒ½æ˜¯2023-11-12 17:30ï¼Œæˆ–è€…éƒ½æ˜¯2023-11-12 17:30:55ï¼Œæœ¬åŒ…åœ¨æ„å»ºGPSå¯¹è±¡æ—¶ï¼Œä¼šæŒ‰ç…§æ—¶é—´åˆ—æ’åºï¼Œç›¸åŒçš„å®šä½æ—¶é—´å¯èƒ½å¯¼è‡´ä¸¤ä¸ªç‚¹çš„å®é™…å‰åé¡ºåºé¢ å€’ï¼Œä»è€Œå½±å“åŒ¹é…ï¼Œæ‰€ä»¥ç¡®ä¿ä½ çš„GPSæ•°æ®çš„å®šä½æ—¶é—´æ²¡æœ‰ç›¸åŒå€¼

* è·¯å¾„ç¼“å­˜æœªæ›´æ–°
    å¯ç”¨äº†è·¯å¾„ç¼“å­˜ï¼Œåœ¨è·¯ç½‘ç»“æ„å˜åŒ–åï¼Œæ²¡æœ‰é‡æ–°è®¡ç®—è·¯å¾„ç¼“å­˜ï¼Œå®é™…ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆè·¯ç½‘çš„ç¼“å­˜


* å¯èƒ½æ˜¯æ²¡æœ‰å¼€å¯æ–¹å‘é™åˆ¶
    æ²¡å¼€using_heading_inf, æˆ–è€…heading_para_arrayè®¾ç½®ä¸åˆç†


* å¼€äº†æ–¹å‘é™åˆ¶ä½†æ˜¯æ²¡æœ‰é€‰æ‹©åˆç†çš„åœç•™ç‚¹åˆ é™¤å‚æ•°ä»¥åŠé™é¢‘å‚æ•°
    å¼€äº†using_heading_inf, ä½†æ˜¯å·®åˆ†èˆªå‘è§’çš„è®¡ç®—åœ¨è·¯å£å—åˆ°äº†åœç•™ç‚¹çš„å½±å“å¯¼è‡´å·®åˆ†èˆªå‘è§’è®¡ç®—å¤±çœŸ




å¦‚æœæ‚¨ä»ç„¶æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·è¿›ç¾¤äº¤æµï¼š


.. image:: _static/images/wxq.jpg
    :align: center
-------------------------------------------------


6.9.3. ç¡®å®šåˆç†å‚æ•°çš„æ€è·¯
::::::::::::::::::::::::::::::::::

* é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¯¹GPSæ•°æ®çš„è´¨é‡æœ‰ä¸€å®šçš„è®¤è¯†ï¼Œé€šè¿‡ä½¿ç”¨GISè½¯ä»¶å°†GPSç‚¹æ‰“åœ¨åœ°å›¾ä¸Šï¼ŒåŒæ—¶å åŠ è·¯ç½‘ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨è·ç¦»æµ‹é‡å·¥å…·å¤§æ¦‚å¾—åˆ°GPSç‚¹åˆ°è·¯æ®µçš„è·ç¦»ï¼Œé‚£ä¹ˆä½ çš„gps_bufferå‚æ•°çš„é€‰å–å°±å¯ä»¥å‚è€ƒè¿™ä¸ªè·ç¦»ï¼Œå¦‚æœç»å¤§å¤šæ•°GPSç‚¹åˆ°åŒ¹é…è·¯æ®µçš„è·ç¦»éƒ½æ˜¯xç±³å·¦å³ï¼Œé‚£ä¹ˆgps_bufferä¸€å®šè¦å¤§äºxï¼Œåå‘äºä¿å®ˆçš„ä¼°è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å– x + 100ä¸ºgps_buffer

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

* top_kå‚æ•°å«ä¹‰ä¸ºï¼šé€‰å–GPSå®šä½ç‚¹åœ†å½¢(åŠå¾„ä¸ºgps_buffer)èŒƒå›´å†…æœ€è¿‘çš„top_kä¸ªè·¯æ®µä½œä¸ºå€™é€‰è·¯æ®µï¼Œé»˜è®¤20ï¼Œåœ¨gps_bufferå¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œç»§ç»­å¢åŠ gps_bufferçš„å€¼æ„ä¹‰ä¸å¤§ï¼Œå› ä¸ºä½ çš„gps_bufferå†å¤§ï¼Œæœ€è¿‘çš„top_kä¸ªè·¯æ®µä¹Ÿä¸ä¼šå‘ç”Ÿæ”¹å˜

* å¯¹äºtop_kï¼Œç‰¹åˆ«æ³¨æ„ï¼š
    å¯¹äºdirä¸º0çš„è·¯æ®µï¼Œå®é™…ä¼šè¢«æ‹†åˆ†ä¸ºä¸¤æ¡æ‹“æ‰‘ç›¸åçš„è·¯æ®µï¼Œå¦‚æœæŸGPSçš„bufferèŒƒå›´å†…å…³è”åˆ°äº†20æ¡åŒå‘è·¯æ®µï¼Œtop_kè‡³å°‘ä¸º40æ‰èƒ½å°†è¿™20æ¡åŒå‘è·¯æ®µé€‰ä¸ºæœ€ç»ˆå€™é€‰

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

* æœ€çŸ­è·¯æœç´¢æˆªæ–­åŠå¾„cut_offï¼šè¿™ä¸ªå€¼çš„é€‰å–ä¹Ÿå’ŒGPSæ•°æ®å½¢æ€æœ‰å…³ï¼Œé»˜è®¤1200mï¼Œå¦‚æœä½ çš„GPSæœ¬èº«å°±æ˜¯ä½é¢‘çš„æ•°æ®ï¼Œç›¸é‚»GPSç‚¹çš„ç›´çº¿è·ç¦»è¶…è¿‡äº†1200ç±³ï¼Œé‚£ä¹ˆå»ºè®®cut_offä¹Ÿè¦è°ƒå¤§ä¸€äº›ã€‚å°¤å…¶æ˜¯åœ¨å¯¹GPSæ•°æ®åšäº†é™é¢‘çš„æƒ…å†µä¸‹ï¼Œç›¸é‚»GPSç‚¹çš„è·ç¦»å˜çš„æ›´å¤§äº†

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

* gps_sigmaå’Œbetaå¯ä»¥ä½¿ç”¨ç½‘æ ¼å‚æ•°è¿›è¡Œæœç´¢ç¡®å®šä¸€ç»„åˆé€‚çš„å‚æ•°å€¼


ç›¸å…³ç±»çš„å‚æ•°å’Œæ–¹æ³•å¯å‚è§ï¼š

- :doc:`ç±»æ–¹æ³•æ±‡æ€»`

7. å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³æ–¹æ¡ˆ
----------------------------


7.1. æ„å»ºnetå¯¹è±¡é”™è¯¯æŠ¥åæ ‡ç³»ä¸åŒ¹é…
``````````````````````````````````````````````

.. image:: _static/images/bug_no_crs_error.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼š

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')

        link = link.to_crs('EPSG:4326')
        node = node.to_crs('EPSG:4326')

        # å¦‚æœè¿˜æŠ¥é”™, å†åŠ ä¸‹é¢è¿™ä¸ª
        # link.crs.srs = 'EPSG:4326'
        # node.crs.srs = 'EPSG:4326'

        my_net = Net(link_gdf=link, node_gdf=node)
        my_net.init_net()  # netåˆå§‹åŒ–


7.2. ä½¿ç”¨jupyteræŠ¥netå¯¹è±¡æ— planar_crså±æ€§
``````````````````````````````````````````````


.. image:: _static/images/bug_no_planar_crs.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨pycharm


7.3. pyogrio.errors.FieldError
``````````````````````````````````````````````

fionaç‰ˆæœ¬æˆ–è€…GDALç‰ˆæœ¬ä¸å…¼å®¹

.. image:: _static/images/fiona_bug.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼šç›¸å…³åœ°ç†ä¿¡æ¯åº“æ¨èä»¥ä¸‹ç‰ˆæœ¬ï¼š

gdal(3.8.4)ã€shapely(2.0.3)ã€fiona(1.9.5)ã€pyproj(3.6.1)ã€geopandas(0.14.3)ã€keplergl(0.3.2)


7.4.  shapelyåº“è­¦å‘Š
````````````````````````````````````````````````````````````````````````````````````````````````````````````````
å‡ºç°è­¦å‘Šä¿¡æ¯ï¼šRuntimeWarning:invalid value encountered in line locate pointreturn lib.line locate point(line, other)


è¯¥è­¦å‘Šä¼šå½±å“åŒ¹é…ç»“æœï¼Œå‡ºç°è¯¥è­¦å‘Šçš„åŸå› æ˜¯å› ä¸ºä½ çš„è·¯ç½‘çº¿å±‚çš„å‡ ä½•ä¸­æœ‰é‡å¤ç‚¹

.. image:: _static/images/dup_points_warning.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆ-ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # æ–¹æ¡ˆ1ï¼šå»é™¤é‡å¤ç‚¹åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf['geometry'] = link_gdf['geometry'].remove_repeated_points(1e-6)


        # æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸…æ´—æ¥å£åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf = ng.NetReverse.clean_link_geo(gdf=link_gdf, plain_crs='EPSG:32649', l_threshold=1.0)


7.5.  Invalid projection: EPSG:nan
````````````````````````````````````````````````````````````````````````````````````````````````````````````````

å¢ƒå¤–è·¯ç½‘æ„å»ºå¤±è´¥ï¼Œæ˜¯BUGï¼Œæ›´æ–°gotrackitåˆ°æœ€æ–°ç‰ˆæœ¬å³å¯è§£å†³

.. image:: _static/images/crs_error.png
    :align: center

--------------------------------------------------------


7.6.  è¾“å‡ºçš„è·¯ç½‘æ–‡ä»¶å­—æ®µä¸­ï¼šä¸­æ–‡å˜ä¸ºä¹±ç 
````````````````````````````````````````````````````````````````````````````````````````````````````````````````
gotrackitå­˜å‚¨è·¯ç½‘æ–‡ä»¶æ—¶ï¼Œé»˜è®¤ç¼–ç ä¸ºgbkï¼Œä½ éœ€è¦æ£€æŸ¥ä½ çš„åŸå§‹è·¯ç½‘æ–‡ä»¶çš„ç¼–ç æ˜¯å¦ä¸ºgbk

--------------------------------------------------------------------------------------


7.7.  è¾“å‡ºHTMLå¤±è´¥ï¼š Object of type bytes is not JSON serializable
````````````````````````````````````````````````````````````````````````````````````````````````````````````````
å¯èƒ½æ˜¯è·¯ç½‘æ–‡ä»¶ç¼–ç é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹å›¾çš„é”™è¯¯åŸå› æ˜¯ï¼šgpd.read_file()è¯»å–è·¯ç½‘æ—¶æ²¡æœ‰æŒ‡å®šåˆé€‚çš„ç¼–ç ï¼Œå¯¼è‡´road_nameåˆ—æ˜¯bytesç±»å‹ï¼Œä½†æ˜¯gotrackitåœ¨è¾“å‡ºHTMLæ—¶ä¼šé»˜è®¤å°†ç”¨æˆ·è·¯ç½‘çš„æ‰€æœ‰å­—æ®µè¿›è¡Œè¾“å‡ºï¼Œæ‰€ä»¥å¯¼è‡´äº†è¾“å‡ºå¤±è´¥

.. image:: _static/images/json_serializable.png
    :align: center
--------------------------------------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼šè¯»å–shpæ–‡ä»¶æ—¶æŒ‡å®šæ­£ç¡®çš„ç¼–ç  æˆ–è€… åˆ é™¤æœ‰ç¼–ç é—®é¢˜çš„å­—æ®µå†æ„å»ºNet

gotrackitï¼šv0.3.1ä¼šå¯¹è¾“å‡ºHTMLçš„è·¯ç½‘å­—æ®µè¿›è¡Œé™åˆ¶ï¼Œåªè¾“å‡ºå…³é”®æ‹“æ‰‘å­—æ®µ


7.8.  è®¡ç®—å‘å°„çŸ©é˜µå‡ºé”™:ValueError(cannot convert float NaN to integer )
````````````````````````````````````````````````````````````````````````````````````````````````````````````````
è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºè·¯ç½‘çº¿å±‚ä¸­çº¿å‹æœ‰é‡å æŠ˜ç‚¹


.. image:: _static/images/dup_zd_error.png
    :align: center
--------------------------------------------------------------------------------------

è§£å†³æ–¹æ¡ˆ-ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # æ–¹æ¡ˆ1ï¼šå»é™¤é‡å¤ç‚¹åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf['geometry'] = link_gdf['geometry'].remove_repeated_points(1e-6)


        # æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸…æ´—æ¥å£åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf = ng.NetReverse.clean_link_geo(gdf=link_gdf, plain_crs='EPSG:32649', l_threshold=1.0)
