ğŸš€ å¦‚ä½•ä½¿ç”¨
===================================


1. å®‰è£…gotrackit
--------------------

å®‰è£…å‰ç¡®ä¿pythonç¯å¢ƒä¸­æœ‰ä»¥ä¸‹å‰ç½®ä¾èµ–åº“ï¼Œæ‹¬å·ä¸­ä¸ºä½œè€…ä½¿ç”¨ç‰ˆæœ¬(åŸºäºpython3.11)ï¼Œä»…ä¾›å‚è€ƒ

* geopandas(0.14.1)

* geopy(2.4.1)

* gdal(3.4.3)

* networkx(3.2.1)

* shapely(2.0.2)

* pandas(2.0.3)

* numpy(1.26.2)

* pyproj(3.6.1)

* keplergl(0.3.2)


geopandasä¸ºæœ€æ–°ç‰ˆæœ¬, å¦‚æœä¸æ˜¯æœ€æ–°ç‰ˆæœ¬å¯èƒ½ä¼šæŠ¥é”™(æœ‰ä¸ªå‡½æ•°æ—§ç‰ˆæœ¬æ²¡æœ‰)

ä½¿ç”¨pipå®‰è£… ::

    pip install -i https://pypi.org/simple/ gotrackit


å·²ç»å®‰è£…ï¼Œå¯ä»¥å‡çº§å·²æœ‰ç‰ˆæœ¬ ::

    pip install --upgrade  -i https://pypi.org/simple/ gotrackit



2. ç®—æ³•åŒ…æ¦‚è§ˆ
--------------------

2.1. æ¨¡å—æ¦‚è§ˆ
````````````````
åŒ…æ‹¬äº†ä¸‰ä¸ªæ¨¡å—ï¼š`GPSæ•°æ®ç”Ÿäº§`_ ã€`è·¯ç½‘ç”Ÿäº§`_ ã€`åœ°å›¾åŒ¹é…`_ ä»¥åŠ `åŒ¹é…è¿‡ç¨‹å¯è§†åŒ–`_ ã€‚



.. _GPSæ•°æ®ç”Ÿäº§:

2.1.1. GPSæ•°æ®ç”Ÿäº§
::::::::::::::::::::::::::
è¯¥æ¨¡å—ä¾æ‰˜è·¯ç½‘æ–‡ä»¶æ¨¡æ‹Ÿè½¦è¾†è¡Œé©¶å¹¶ä¸”äº§ç”ŸGPSæ•°æ®ï¼Œå½“ç”¨æˆ·æ²¡æœ‰å®é™…çš„GPSæ•°æ®æ—¶å¯ä»¥å€ŸåŠ©è¯¥æ¨¡å—ç”Ÿäº§æ•°æ®ã€‚


åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/GpsGenGraph.png
    :align: center

----------------------------------------

å…·ä½“çš„ä»£ç å®æ“è§ `GPSæ•°æ®ç”Ÿäº§ä»£ç ç¤ºä¾‹`_ ã€‚

.. _è·¯ç½‘ç”Ÿäº§:

2.1.2. è·¯ç½‘ç”Ÿäº§
::::::::::::::::::::::::::

.. note::

   é€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘ä¸¥ç¦ç”¨äºå•†ä¸šè¡Œä¸ºï¼Œä»…é™äºæ•™è‚²ä»¥åŠç§‘å­¦ç ”ç©¶ã€‚


è·¯ç½‘ç”Ÿäº§å·¥å…·ç”¨äºå¸®åŠ©ç”¨æˆ·è·å–è·¯ç½‘æ•°æ®ï¼Œä»¥åŠå¯¹è·¯ç½‘æ•°æ®è¿›è¡Œå„ç§æ£€æŸ¥ä¸ä¼˜åŒ–ï¼Œä½ åªéœ€å¯¥å¯¥å‡ è¡Œä»£ç ä¾¿å¯ä»¥è·å¾—è·¯ç½‘æ•°æ®ã€‚

è·¯ç½‘ç”Ÿäº§çš„ä¸»è¦æµç¨‹ä¸ºï¼šä¾æ®ç ”ç©¶åŒºåŸŸèŒƒå›´æ„é€ OD --> åŸºäºODè¯·æ±‚è·¯å¾„è§„åˆ’ --> åŸºäºè·¯å¾„è§„åˆ’ç»“æœæ‰§è¡Œç©ºé—´ä¼˜åŒ–å®ç°è·¯ç½‘é€†å‘

.. image:: _static/images/netreverse_tech_way.png
    :align: center

--------------------------------------------------------------------------------

æœ¬å¼€æºåŒ…å°†ç›¸å…³çš„æ–¹æ³•éƒ½å°è£…ä¸ºäº†æ ‡å‡†å‡½æ•°æ¥å£ï¼Œæ‚¨åªç”¨æä¾›ä¸€ä¸ªkeyä¾¿å¯ä»¥è¿›è¡Œä¸­å›½å¢ƒå†…ä»»æ„åŒºåŸŸè·¯ç½‘çš„è·å–ã€‚


* æ„é€ OD
    æä¾›åŸºäºä»»æ„å½¢çŠ¶åŒºåŸŸéšæœºæ„é€ ODçš„æ–¹æ³•ï¼›

    æä¾›åŸºäºåœ°å—æ„é€ å½¢å¿ƒå‡ºè¡ŒODçš„æ–¹æ³•ï¼›

    æä¾›åŸºäºGPSæ•°æ®ç²¾å‡†æ„é€ å¸¦é€”å¾„ç‚¹ODçš„æ–¹æ³•ï¼›

    æ”¯æŒè‡ªå®šä¹‰æ„é€ ODã€‚

.. _od_type:

.. image:: _static/images/od_gen.png
    :align: center

--------------------------------------------------------------------------------

ä¸‰å¼ å›¾åˆ†åˆ«å¯¹åº”od_typeå‚æ•°ä¸ºrand_odã€region_odã€gps_based

æ„é€ ODéå¸¸é‡è¦ï¼Œå› ä¸ºODæ„é€ çš„è¶Šç²¾å‡†ï¼Œè·¯å¾„è§„åˆ’æ‰€è¦†ç›–çš„é“è·¯è·¯æ®µå°±è¶Šå…¨é¢ï¼Œæˆ‘ä»¬å¾—åˆ°çš„è·¯ç½‘è¦†ç›–ç‡å°±è¶Šé«˜ã€‚

.. _ODè¡¨è¦æ±‚:

å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ODï¼Œè¯·æä¾›ä»¥ä¸‹å­—æ®µè¦æ±‚çš„ODè¡¨ï¼š

.. csv-table:: ODè¡¨å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 5, 40

    "od_id","int","ODå”¯ä¸€ç¼–ç ï¼Œä¸å…è®¸ä¸ºç©º"
    "o_x","float","èµ·ç‚¹ç»åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "o_y","float","èµ·ç‚¹çº¬åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "d_x","float","ç»ˆç‚¹ç»åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "d_y","float","ç»ˆç‚¹çº¬åº¦ï¼Œä¸å…è®¸ä¸ºç©ºï¼ŒGCJ-02åæ ‡ç³»"
    "hh","int","è¯·æ±‚æ—¶æ®µ(0~23)ï¼Œå¦‚æœå¯¹æ¯ä¸ªODæœ‰å…·ä½“çš„è¯·æ±‚æ—¶æ®µé™åˆ¶ï¼Œè¯·ç¡®ä¿æœ‰è¯¥åˆ—ï¼Œä¸”å°†ignore_hhç½®ä¸ºFalseï¼Œä¸å…è®¸æœ‰ç©ºå€¼ï¼›å¦‚æœæ²¡æœ‰æ—¶æ®µé™åˆ¶, è¯¥åˆ—å¯ä»¥ä¸æä¾›"
    "way_points","string","é€”å¾„ç‚¹åæ ‡ä¸²ï¼Œæœ€å¤šæ”¯æŒ10ä¸ªé€”å¾„ç‚¹ï¼Œå…è®¸ä¸ºç©º"

æ ·ä¾‹ODæ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: ODæ ·ä¾‹æ•°æ®
    :header: "od_id", "o_x", "o_y", "d_x", "d_y", "way_points"
    :widths: 3, 5, 5, 5, 5, 10

    "1","120.73054930354505","31.672649340942495","120.73338512634608","31.667515168299673","120.73176445980103,31.6705214428833"
    "2","120.73050669059927","31.666431974714015","120.74717247617396","31.669917988588765","120.73119124695165,31.666929583950083;120.7380010705855,31.66916745090122"
    "3", "120.74229535581601","31.660716341555","120.74250979515529","31.652820575113125",""

--------------------------------------------------------------------------------


* è·¯å¾„è§„åˆ’è¯·æ±‚
    æ‚¨åªéœ€è¦ç”³è¯·ä¸€ä¸ª `å¼€å‘è€…key <https://lbs.amap.com>`_ ï¼›

    æ”¯æŒè‡ªç”±è¯·æ±‚ã€æŒ‰ç…§æ—¶æ®µè¯·æ±‚ã€‚


* ç©ºé—´ä¼˜åŒ–
    è·¯å¾„æ‹†åˆ†ï¼šåŸºäºè·¯å¾„æ‹“æ‰‘ç‚¹æ‹†åˆ†æœ€å°è·¯æ®µï¼›

    æ‹“æ‰‘å…³è”ï¼šç”Ÿäº§ç‚¹å±‚ï¼Œæ·»åŠ æ‹“æ‰‘å…³ç³»ï¼›

    è·¯æ®µæ‹“æ‰‘ä¼˜åŒ–ï¼šä»¥ä¸€å®šçš„é™åˆ¶è§„åˆ™å°†è·¯æ®µè¿›è¡Œåˆå¹¶ï¼Œæ”¯æŒå±æ€§é™åˆ¶ã€ç´¯è®¡é•¿åº¦é™åˆ¶ã€æœ€å¤§è½¬è§’é™åˆ¶ã€ç¯æ£€æµ‹ï¼›

    é‡å è·¯æ®µè¯†åˆ«ï¼šéƒ¨åˆ†è·¯å¾„è·ç¦»éå¸¸è¿‘ï¼Œä½†æ˜¯å´æ²¡æœ‰å®Œå…¨é‡åˆï¼Œæœ¬åŒ…å¯ä»¥è¿›è¡Œè¯†åˆ«ä¸ä¼˜åŒ–ï¼›

    è”é€šæ€§æ ¡å‡†ï¼šè¯†åˆ«è·¯ç½‘ä¸­æ½œåœ¨çš„ä¸è¿é€šèŠ‚ç‚¹å¹¶è¿›è¡Œå¤„ç†ã€‚


ç©ºé—´ä¼˜åŒ–çš„ç›¸å…³ç±»å‚æ•°å¯è§ï¼š:doc:`ç±»æ–¹æ³•æ±‡æ€»`


ç©ºé—´ä¼˜åŒ–çš„å…·ä½“å†…å®¹å¯ä»¥æŸ¥çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢ï¼š`ä»è·¯å¾„è§„åˆ’æ¥å£é€†å‘è·¯ç½‘çš„ä¸€ç§æ–¹æ³• <https://juejin.cn/post/7268187099526152247>`_


å…·ä½“çš„ä»£ç å®æ“è§ `è·¯ç½‘ç”Ÿäº§ä»£ç ç¤ºä¾‹`_


.. _åœ°å›¾åŒ¹é…:

2.1.3. åœ°å›¾åŒ¹é…
::::::::::::::::::::::::::

ä¾æ‰˜è·¯ç½‘æ–‡ä»¶ã€GPSæ•°æ®ï¼Œå¯¹GPSæ•°æ®è¿›è¡Œåœ°å›¾åŒ¹é…ï¼ŒåŒ¹é…ç»“æœç»™å‡ºæ¯ä¸ªGPSç‚¹å®é™…åŒ¹é…è·¯æ®µä¿¡æ¯ã€‚

åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/MatchGraph.png
    :align: center

----------------------------------------

å…·ä½“çš„ä»£ç å®æ“è§ `åœ°å›¾åŒ¹é…ä»£ç ç¤ºä¾‹`_ ã€‚


.. _åŒ¹é…è¿‡ç¨‹å¯è§†åŒ–:

2.1.4. keplerå¯è§†åŒ–
::::::::::::::::::::::::::


å°†åŒ¹é…ç»“æœç»Ÿä¸€è¾“å‡ºåˆ°HTMLæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥æ–‡ä»¶æ’­æ”¾åŒ¹é…åŠ¨ç”»ã€‚

åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/visualization.png
    :align: center

----------------------------------------


å…·ä½“çš„ä»£ç å®æ“è§ä¸‹æ–‡ç¤ºä¾‹ä»£ç ã€‚


2.2. æ•°æ®è¦æ±‚
````````````````

è¿™ä¸‰ä¸ªæ¨¡å—æ‰€æ¶‰åŠçš„æ•°æ®è¯´æ˜å¦‚ä¸‹ï¼š

2.2.1. è·¯ç½‘æ•°æ®
::::::::::::::::::::::::::
è·¯ç½‘ç”±çº¿å±‚æ–‡ä»¶å’Œç‚¹å±‚æ–‡ä»¶ç»„æˆï¼Œä¸¤ä¸ªæ–‡ä»¶å­˜åœ¨å…³è”å…³ç³»ã€‚`è¥¿å®‰æ ·ä¾‹è·¯ç½‘ <https://github.com/zdsjjtTLG/TrackIt/tree/main/data/input/net/xian>`_


(1) è·¯ç½‘-ç‚¹å±‚
'''''''''''''

è·¯ç½‘ç‚¹å±‚æ–‡ä»¶å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: èŠ‚ç‚¹å±‚å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 15, 40

    "node_id","int","èŠ‚ç‚¹å”¯ä¸€ç¼–ç "
    "geometry","geometry","èŠ‚ç‚¹åæ ‡å‡ ä½•åˆ—"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."

æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: èŠ‚ç‚¹æ ·ä¾‹æ•°æ®
    :header: "node_id", "geometry"
    :widths: 3, 20

    "4290","POINT (108.84059274796762 34.20380728755708)"
    "7449","POINT (108.83996876020116 34.20398312458892)"
    "19893","POINT (108.8410333043887 34.20538952458989)"
    "22765","POINT (108.8396462868452 34.20358068920948)"
    "29974","POINT (108.84304743483109 34.20477124733548)"
    "31762","POINT (108.84007099594207 34.20303962600771)"
    "34152","POINT (108.84337595161946 34.20450390550994)"
    "44441","POINT (108.8435151462407 34.204686083275455)"
    "63637","POINT (108.8415703783543 34.20233450491169)"
    "68869","POINT (108.842021912175 34.20431362229388)"
    "82793","POINT (108.84178453991281 34.204420171642816)"
    "91199","POINT (108.84129068661863 34.20558291058989)"
    "92706","POINT (108.84207500541686 34.2041637658475)"
    "118381","POINT (108.84208596575294 34.20486654570958)"
    "122487","POINT (108.84210722600966 34.20202954576994)"
    "124862","POINT (108.83952308374874 34.20369843029777)"
    "145105","POINT (108.84239758378014 34.20309169152201)"
    "166381","POINT (108.84139277469502 34.20644679433629)"
    "169462","POINT (108.84160833213731 34.20363712972413)"
    "170508","POINT (108.841425074665 34.203330912749905)"
    "177594","POINT (108.84176365682967 34.202564765029564)"
    "181808","POINT (108.84049555540867 34.20432194107051)"
    "191714","POINT (108.84048418194278 34.208751404812496)"
    "198856","POINT (108.84627615033686 34.205495498912406)"
    "199563","POINT (108.84081270761097 34.208564048548254)"

.. note::

   ç‚¹å±‚è¡¨çš„geometryå­—æ®µä¸­ä¸å…è®¸å‡ºç°MultiPointç±»å‹ï¼Œä¸æ”¯æŒä¸‰ç»´åæ ‡ã€‚



(2) è·¯ç½‘-çº¿å±‚
'''''''''''''

è·¯ç½‘çº¿å±‚æ–‡ä»¶å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: çº¿å±‚å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 10, 10, 30

    "link_id","int","è·¯æ®µå”¯ä¸€ç¼–ç "
    "from_node","int","è·¯æ®µæ‹“æ‰‘èµ·ç‚¹èŠ‚ç‚¹ç¼–å·"
    "to_node","int","è·¯æ®µæ‹“æ‰‘ç»ˆç‚¹èŠ‚ç‚¹ç¼–å·"
    "dir","int","è·¯æ®µæ–¹å‘ï¼Œå–å€¼ä¸º0æˆ–è€…1ï¼Œ 0ä»£è¡¨åŒå‘é€šè¡Œï¼Œ1ä»£è¡¨é€šè¡Œæ–¹å‘ä¸ºè·¯æ®µæ‹“æ‰‘æ­£å‘"
    "length","float","è·¯æ®µé•¿åº¦ï¼Œå•ä½ç±³"
    "geometry","geometry","è·¯æ®µå‡ ä½•çº¿å‹"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."



æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: çº¿å±‚æ ·ä¾‹æ•°æ®
    :header: "link_id", "dir", "length", "from_node", "to_node", "road_name", "geometry"
    :widths: 5, 5,5,5,5,5,40

    "50542","1","379.03","191714","19893","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.84048418194278 34.208751404812496, 108.8410333043887 34.20538952458989)"
    "50545","1","112.13","170508","63637","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.841425074665 34.203330912749905, 108.8415703783543 34.20233450491169)"
    "91646","1","120.66","177594","169462","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84176365682967 34.202564765029564, 108.84160833213731 34.20363712972413)"
    "117776","1","91.19","22765","4290","ç§‘æŠ€å…«è·¯","LINESTRING (108.8396462868452 34.20358068920947, 108.84059274796762 34.20380728755708)"
    "117777","1","142.87","4290","92706","ç§‘æŠ€å…«è·¯","LINESTRING (108.84059274796762 34.20380728755708, 108.84207500541686 34.2041637658475)"
    "225724","1","126.28","92706","34152","ç§‘æŠ€å…«è·¯","LINESTRING (108.84207500541686 34.2041637658475, 108.84337595161946 34.20450390550994)"
    "353809","1","309.67","198856","29974","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84627615033686 34.205495498912406, 108.84304743483109 34.20477124733548)"
    "353810","1","123.30","29974","82793","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84304743483109 34.20477124733548, 108.84178453991281 34.204420171642816)"
    "50543","1","232.85","19893","170508","è¥¿ä¸‰ç¯å…¥å£","LINESTRING (108.8410333043887 34.20538952458989, 108.84113550636526 34.204842890573545, 108.841425074665 34.203330912749905)"
    "60333","1","131.43","19893","181808","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.8410333043887 34.20538952458989, 108.84097922452833 34.2053414459058, 108.8409571929787 34.20530941808315, 108.84094718092301 34.205266415141416, 108.84093116775695 34.205121436415766, 108.84088210545373 34.20495040838689, 108.84082903440334 34.20481036268511, 108.84074291369149 34.204649265874245, 108.84062975122784 34.20448312297699, 108.84049555540867 34.20432194107051)"
    "60342","1","114.48","181808","124862","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84049555540867 34.20432194107051, 108.84036636411828 34.20419775516095, 108.84024318008004 34.20409657182006, 108.84004387862637 34.203972261359624, 108.83952308374874 34.20369843029777)"
    "72528","1","144.36","44441","68869","ç§‘æŠ€å…«è·¯","LINESTRING (108.8435151462407 34.204686083275455, 108.84276803395724 34.20449685714005, 108.842021912175 34.20431362229388)"
    "72530","1","241.31","68869","124862","ç§‘æŠ€å…«è·¯","LINESTRING (108.842021912175 34.20431362229388, 108.84045752847501 34.20392001061749, 108.83999080892261 34.20380622377766, 108.83952308374874 34.20369843029777)"
    "91647","1","219.39","169462","91199","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84160833213731 34.20363712972413, 108.84159129993026 34.20371207446149, 108.84158127801764 34.20379302941826, 108.84129068661863 34.20558291058989)"
    "91650","1","336.01","91199","199563","è¥¿å¤ªå…¬è·¯","LINESTRING (108.84129068661863 34.20558291058989, 108.8412796652767 34.20563687282872, 108.8412686439326 34.205690835063145, 108.84115642068461 34.20631242560034, 108.84081270761097 34.208564048548254)"
    "117778","1","210.78","92706","145105","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84207500541686 34.2041637658475, 108.84246760555624 34.204148454345315, 108.84259079504238 34.204121677386546, 108.84270897833433 34.204073898662514, 108.84278409570048 34.20403104344158, 108.84285420666204 34.203972184904536, 108.84290829376307 34.20390730060347, 108.84296138178485 34.20381142505641, 108.84298842958638 34.20372550103973, 108.84300445983821 34.203650554222975, 108.8430044667493 34.203564583429824, 108.84298844855175 34.20348958118876, 108.84295640699884 34.20340355495798, 108.84291334698771 34.20333950217767, 108.84283823977152 34.203258399651446, 108.84274109807303 34.203189254785585, 108.84262893217804 34.20313507862982, 108.84249973838324 34.20310286525956, 108.84239758378014 34.20309169152201)"
    "117796","1","101.54","145105","169462","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84239758378014 34.20309169152201, 108.84226337833424 34.20310245441332, 108.84214018818257 34.20312823114287, 108.84201599437151 34.20317699810311, 108.84191984203596 34.20324080868778, 108.84186074674892 34.20329968553512, 108.84168846217199 34.20355129904852, 108.84166642567236 34.203584249318894, 108.84160833213731 34.20363712972413)"
    "142834","1","137.18","44441","118381","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.8435151462407 34.204686083275455, 108.84286516861593 34.20465297225673, 108.84270392291693 34.20466868749383, 108.84255369259174 34.20469541771726, 108.8423543849143 34.204749053102546, 108.84220415103883 34.204807771645406, 108.84208596575294 34.20486654570958)"
    "142840","1","109.65","118381","91199","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84208596575294 34.20486654570958, 108.84193572856508 34.20495725275265, 108.84187062536941 34.20500012448543, 108.84174241973271 34.205111862398475, 108.84152206339351 34.2053314019811, 108.84138183320681 34.205508095978935, 108.84129068661863 34.20558291058989)"
    "313011","1","185.48","170508","31762","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.841425074665 34.203330912749905, 108.84138201087228 34.20329884814687, 108.8413549721588 34.20326181330508, 108.84133394278078 34.20322378932678, 108.84130691144021 34.20309478566952, 108.84126886083386 34.20299375316963, 108.84121578539629 34.2029126874992, 108.84113566851988 34.20282657599954, 108.84107557946284 34.2027784867213, 108.84098444236022 34.20272934315392, 108.84090432074107 34.20269821275392, 108.84078013032108 34.202671003329115, 108.84065193124133 34.202670777488386, 108.84052272903759 34.202686544240095, 108.8404205674005 34.20271835309855, 108.84031840430188 34.20276615639653, 108.84024328324365 34.202814007367984, 108.84015714222738 34.20289482758925, 108.8401090614738 34.20296471879859, 108.84007099594207 34.20303962600771)"
    "313030","1","107.96","31762","4290","ä¸ˆå…«ç«‹äº¤","LINESTRING (108.84007099594207 34.20303962600771, 108.84004995701892 34.20311456333897, 108.84003893335381 34.20319451669712, 108.84004393467363 34.203275498082384, 108.8400609552723 34.203350502775116, 108.8401090222339 34.20345255324469, 108.8401681085395 34.20352763233158, 108.8402271964761 34.2035817184994, 108.84032334095258 34.20365086500884, 108.84044152120677 34.20370005708676, 108.84059274796762 34.20380728755708)"
    "336493","1","268.77","122487","82793","è¥¿ä¸‰ç¯è¾…è·¯","LINESTRING (108.84210722600966 34.20202954576994, 108.84186570306134 34.20393847725639, 108.84178453991281 34.204420171642816)"
    "336495","1","229.43","82793","166381","è¥¿ä¸‰ç¯è¾…è·¯","LINESTRING (108.84178453991281 34.204420171642816, 108.84169935963888 34.205036812701614, 108.84162421311767 34.20542354934598, 108.84139277469502 34.20644679433629)"
    "353811","1","175.06","82793","7449","ç§‘æŠ€å…«è·¯è¾…è·¯","LINESTRING (108.84178453991281 34.204420171642816, 108.8409632885549 34.20423679420731, 108.83996876020116 34.20398312458892)"


.. note::

   çº¿å±‚è¡¨çš„geometryå­—æ®µä¸­ä¸å…è®¸å‡ºç°MultiLineStringç±»å‹ï¼Œåªå…è®¸LineStringç±»å‹ï¼Œä¸æ”¯æŒä¸‰ç»´åæ ‡ã€‚



(3) ç‚¹å±‚ã€çº¿å±‚å…³è”å…³ç³»
''''''''''''''''''''''''''

æŒ‰ç…§ä»¥ä¸Šæ ·ä¾‹æ•°æ®å‡†å¤‡è·¯ç½‘æ–‡ä»¶ï¼Œshpã€geojsonç­‰æ ¼å¼éƒ½å¯ä»¥ã€‚

æ ·ä¾‹æ•°æ®åœ¨QGIS(æˆ–è€…TransCADç­‰å…¶ä»–GISè½¯ä»¶)ä¸­è¿›è¡Œå¯è§†åŒ–ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š

.. image:: _static/images/sample_net.png
    :align: center

* çº¿å±‚dirå­—æ®µä¸æ‹“æ‰‘æ–¹å‘
    çº¿å±‚çš„ç®­å¤´æ–¹å‘ä¸ºæ‹“æ‰‘æ–¹å‘(å³linkå±‚geometryä¸­çš„æŠ˜ç‚¹è¡Œè¿›æ–¹å‘)ï¼Œdirå­—æ®µæ‰€æè¿°çš„è¡Œè½¦æ–¹å‘å°±æ˜¯ä¸ä¹‹å…³è”çš„ï¼Œdirä¸º1ä»£è¡¨è¯¥æ¡linkæ˜¯å•å‘è·¯æ®µï¼Œè¡Œè½¦æ–¹å‘ä¸æ‹“æ‰‘æ–¹å‘ä¸€è‡´ï¼Œdirä¸º0ä»£è¡¨è¯¥æ¡linkæ˜¯åŒå‘è·¯æ®µ


* ç‚¹å±‚node_idä¸çº¿å±‚from_nodeã€to_nodeå…³è”
    Linkå±‚ä¸­ï¼šä¸€æ¡linkçš„from_nodeã€to_nodeå±æ€§å¯¹åº”èŠ‚ç‚¹å±‚çš„node_id

.. image:: _static/images/LinkNodeCon.png
    :align: center


-------------------------------------

åœ¨æœ¬åœ°å›¾åŒ¹é…åŒ…ä¸­ï¼Œä½¿ç”¨Netå¯¹è±¡æ¥ç®¡ç†è·¯ç½‘ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šLinkå±‚å’ŒNodeå±‚æ–‡ä»¶è·¯å¾„æˆ–è€…ä¼ å…¥linkå±‚å’Œnodeå±‚çš„GeoDataFrameï¼Œä¾¿å¯ä»¥åˆ›å»ºä¸€ä¸ªNetå¯¹è±¡ï¼Œè¿™ä¸ªNetå¯¹è±¡æ˜¯æˆ‘ä»¬å¼€å±•GPSæ•°æ®ç”Ÿäº§ã€åœ°å›¾åŒ¹é…çš„åŸºå‡†Netï¼Œè¿™ä¸ªNetå¯¹è±¡æä¾›äº†å¾ˆå¤šæ“ä½œè·¯ç½‘çš„æ–¹æ³•ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹è·¯ç½‘è¿›è¡Œæ“ä½œã€‚

.. image:: _static/images/create_net.png
    :align: center

-------------------------------------



å¦‚æœæ‚¨æ²¡æœ‰è·¯ç½‘æ•°æ®ï¼Œè¯·å‚è€ƒ `è·¯ç½‘ç”Ÿäº§`_ ã€‚


2.2.2. GPSå®šä½æ•°æ®
::::::::::::::::::::::::::


GPSæ•°æ®å­—æ®µè¦æ±‚å¦‚ä¸‹ï¼š

.. csv-table:: GPSæ•°æ®å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µç±»å‹", "å­—æ®µè¯´æ˜"
    :widths: 15, 15, 40

    "agent_id","string","è½¦è¾†å”¯ä¸€ç¼–ç ,å‡†ç¡®æ¥è¯´è¿™ä¸ªå­—æ®µæ ‡æ³¨çš„æ˜¯è½¦è¾†çš„æŸä¸€æ¬¡å®Œæ•´å‡ºè¡Œ"
    "lng","float","ç»åº¦"
    "lat","float","çº¬åº¦"
    "time","string","å®šä½æ—¶é—´æˆ³"
    "heading","float","èˆªå‘è§’,è¯¥å­—æ®µä¸æ˜¯å¿…éœ€å­—æ®µ"
    "å…¶ä»–éå¿…éœ€å­—æ®µ","...","..."

æ ·ä¾‹æ•°æ®å¦‚ä¸‹ï¼š

.. csv-table:: GPSæ ·ä¾‹æ•°æ®
    :header: "agent_id", "lng", "lat", "time"
    :widths: 5,10,10,10

    "22413","113.8580665194923","22.774040768110932","2024-01-15 16:00:29"
    "22413","113.85816528930164","22.774241671596673","2024-01-15 16:00:59"
    "22413","113.86015961029372","22.77713838336715","2024-01-15 16:01:29"
    "22413","113.86375221173896","22.779334473598812","2024-01-15 16:02:00"
    "22413","113.864148301839","22.77953193554016","2024-01-15 16:02:29"
    "22413","113.86793876830578","22.78092681645836","2024-01-15 16:02:59"

åœ¨æœ¬åœ°å›¾åŒ¹é…åŒ…ä¸­ï¼Œä½¿ç”¨GpsPointsGdfå¯¹è±¡æ¥ç®¡ç†ä¸€è¾†è½¦çš„ä¸€æ¬¡å‡ºè¡Œè½¨è¿¹æ•°æ®ï¼Œç”¨æˆ·åœ¨æ„å»ºGpsPointsGdfä¹‹å‰åº”è¯¥å…ˆå¯¹GPSæ•°æ®åšé¢„å¤„ç†å¦‚è¡Œç¨‹åˆ‡åˆ†ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªè½¦è¾†å”¯ä¸€ç¼–ç agent_idæ¥æ ‡æ³¨è¿™æ¬¡å‡ºè¡Œï¼ŒGpsPointsGdfæä¾›äº†å¾ˆå¤šæ“ä½œGPSæ•°æ®çš„æ–¹æ³•

.. image:: _static/images/gps_obj.png
    :align: center

----------------------------------------



3. GPSæ•°æ®ç”Ÿäº§
-----------------------------


3.1. æ‰€éœ€æ•°æ®
`````````````

æœ¬æ¨¡å—åªéœ€è·¯ç½‘æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œå…ˆä¾æ®è·¯ç½‘æ•°æ®åˆå§‹åŒ–ä¸€ä¸ªNetå¯¹è±¡ï¼Œç„¶ååˆå§‹åŒ–ä¸€ä¸ªè·¯å¾„å¯¹è±¡å’Œä¸€ä¸ªCarè½¦è¾†å¯¹è±¡ï¼Œç„¶åæ–°å»ºä¸€ä¸ªè¡Œç¨‹ä¿¡æ¯æ”¶é›†å™¨å¯¹è±¡RouteInfoCollectorï¼Œå³å¯è·å–GPSæ•°æ®ã€‚

åŸºæœ¬æµç¨‹ä¸ºï¼š

.. image:: _static/images/GpsGenGraph.png
    :align: center

----------------------------------------


.. _GPSæ•°æ®ç”Ÿäº§ä»£ç ç¤ºä¾‹:

3.2. ä»£ç ç¤ºä¾‹
`````````````

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net,Route,Car, RouteInfoCollector,å­—æ®µåç§°å¸¸é‡(è¿™ä¸€æ­¥æ˜¯å›ºå®šæ“ä½œ)
    import datetime
    from gotrackit.map.Net import Net
    from gotrackit.generation.GpsGen import Route
    from gotrackit.GlobalVal import NetField, GpsField
    from gotrackit.generation.GpsGen import Car, RouteInfoCollector

    net_field = NetField()
    gps_field = GpsField()


    if __name__ == '__main__':
        # 1.æ„å»ºä¸€ä¸ªnet, è¦æ±‚è·¯ç½‘çº¿å±‚å’Œè·¯ç½‘ç‚¹å±‚å¿…é¡»æ˜¯WGS-84, EPSG:4326 åœ°ç†åæ ‡ç³»
        my_net = Net(link_path=r'data/input/net/xian/modifiedConn_link.shp',
                     node_path=r'data/input/net/xian/modifiedConn_node.shp',
                     weight_field='length')

        # è·¯ç½‘å¯¹è±¡åˆå§‹åŒ–(ä¸€å®šè¦åš)
        my_net.init_net()

        # 3.æ–°å»ºä¸€ä¸ªè·¯å¾„route, ç”¨äºåˆ†é…ç»™è½¦è¾†carä½œä¸ºè·¯å¾„å¯¼èˆªçš„è¾“å…¥
        # è‹¥ä¸æŒ‡å®šft_seq, åˆ™ä½¿ç”¨o_node -> d_nodeè¿›è¡Œæœè·¯(carå¯¹è±¡ä¼šè‡ªåŠ¨æœè·¯)è·å–è·¯å¾„
        # è‹¥æ²¡æœ‰æŒ‡å®šo_nodeå’Œd_node, ä¹Ÿæ²¡æœ‰æŒ‡å®šft_seq, åˆ™ä½¿ç”¨éšæœºè·¯å¾„
        # o_nodeå’Œd_nodeæŒ‡çš„æ˜¯æœ¬æ¬¡è¡Œç¨‹çš„èµ·ç‚¹èŠ‚ç‚¹å’Œç»ˆç‚¹èŠ‚ç‚¹(å¯¹åº”linkå±‚å’Œnodeå±‚æ„å»ºçš„Netå¯¹è±¡)
        route = Route(net=my_net)

        # å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æŒ‡å®šo_nodeå’Œd_node
        # route.o_node = 176356
        # route.d_node = 228133

        # å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æŒ‡å®šo_nodeå’Œd_node
        # route.ft_seq = [(137226, 42212), (42212, 21174), (21174, 39617)]

        # 4.æ–°å»ºä¸€ä¸ªè¡Œç¨‹ä¿¡æ¯æ”¶é›†å™¨å¯¹è±¡, å¯¹æ•°æ®è¿›è¡Œç»Ÿä¸€ç®¡ç†
        # è½¨è¿¹ä¿¡æ¯å’ŒGPSåæ ‡ä¿¡æ¯éƒ½æ˜¯å¹³é¢åæ ‡ç³», éœ€è¦è½¬åŒ–ä¸ºåœ°ç†åæ ‡ç³»åå†è¿›è¡Œå­˜å‚¨
        data_col = RouteInfoCollector(from_crs=my_net.planar_crs, to_crs=my_net.geo_crs, convert_prj_sys=True)

        # 5.è®¾ç½®ä»¿çœŸå‚æ•°, å¹¶ä¸”åˆå§‹åŒ–ä¸€ä¸ªè½¦è¾†å®ä½“
        _time_step = 0.1  # ä»¿çœŸæ­¥é•¿, s
        speed_miu = 12.0  # é€Ÿåº¦æœŸæœ›å€¼
        speed_sigma = 3.6  # é€Ÿåº¦æ ‡å‡†å·®
        save_gap = 5  # æ¯å¤šå°‘ä»¿çœŸæ­¥ä¿å­˜ä¸€æ¬¡è½¦è¾†çœŸå®ä½ç½®æ•°æ®
        loc_frequency = 3.0  # æ¯å¤šå°‘sè¿›è¡Œä¸€æ¬¡GPSå®šä½
        loc_error_sigma = 20.0  # å®šä½è¯¯å·®æ ‡å‡†å·®(m)
        loc_error_miu = 0.0  # å®šä½è¯¯å·®æ ‡å‡†æœŸæœ›å€¼(m)

        # ä½¿ç”¨forå¾ªç¯åˆ›å»ºä¸‰è¾†è½¦
        # å‡ºå‘æ—¶é—´éƒ½æ˜¯datetime.datetime(year=2022, month=5, day=12, hour=16, minute=14, second=0)
        for car_id in [rf'xa_car_{i}' for i in range(0, 3)]:
            # 6.æ–°å»ºè½¦å¯¹è±¡, åˆ†é…ä¸€ä¸ªè½¦è¾†ID, é…å¤‡ä¸€ä¸ªç”µå­åœ°å›¾net, ä¸”è®¾ç½®ä»¿çœŸå‚æ•°
            car = Car(net=my_net, time_step=_time_step, route=route,
                      agent_id=car_id, speed_miu=speed_miu, speed_sigma=speed_sigma,
                      loc_frequency=loc_frequency, loc_error_sigma=loc_error_sigma, loc_error_miu=loc_error_miu,
                      start_time=datetime.datetime(year=2022, month=5, day=12, hour=16, minute=14, second=0),
                      save_gap=save_gap)

            # å¼€å§‹è¡Œè½¦
            car.start_drive()

            # æ”¶é›†æ•°æ®
            data_col.collect_trajectory(car.get_trajectory_info())
            data_col.collect_gps(car.get_gps_loc_info())

        # 7.å­˜å‚¨æ•°æ®(åŒæ—¶ä¼šå°†ç»“æœè¿”å›)
        # æŒ‡å®šå­˜å‚¨æ–‡ä»¶ç±»å‹å‚æ•°: file_type(geojsonæˆ–è€…csv)
        # æŒ‡å®šå­˜å‚¨æ–‡ä»¶ç›®å½•å‚æ•°: out_fldr
        # æŒ‡å®šå­˜å‚¨æ–‡ä»¶åç§°(ä¸å¸¦åç¼€): file_name
        trajectory_gdf = data_col.save_trajectory(file_type='geojson', out_fldr=r'./data/output/trajectory/', file_name='test_xa')
        gps_gdf = data_col.save_gps_info(file_type='geojson', out_fldr=r'./data/output/gps/', file_name='test_xa')
        mix_gdf = data_col.save_mix_info(file_type='geojson', out_fldr=r'./data/output/mix/', file_name='test_xa')

ç›¸å…³ç±»çš„å‚æ•°å’Œæ–¹æ³•å¯å‚è§ï¼š:doc:`ç±»æ–¹æ³•æ±‡æ€»`



4. è·¯ç½‘ç”Ÿäº§
-------------------------

.. note::

   é€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘ä¸¥ç¦ç”¨äºå•†ä¸šè¡Œä¸ºï¼Œä»…é™äºæ•™è‚²ä»¥åŠç§‘å­¦ç ”ç©¶ã€‚


.. note::

   è¯·æ³¨æ„ï¼šé€šè¿‡è¯¥æ–¹å¼è·å–çš„è·¯ç½‘çš„åæ ‡ç³»æ˜¯GCJ-02ï¼Œä¸€èˆ¬çš„GPSæ•°æ®åæ ‡ç³»éƒ½æ˜¯WGS-84ã€‚

è·¯ç½‘ç”Ÿäº§çš„ç›¸å…³å‡½æ•°ä¸éœ€è¦æ‚¨æä¾›ä»»ä½•çš„ç©ºé—´åœ°ç†ä¿¡æ¯æ–‡ä»¶ï¼Œåªéœ€æŒ‡å®šèŒƒå›´ã€å’Œç”³è¯· `å¼€å‘è€…key <https://lbs.amap.com>`_ å³å¯è·å–è·¯ç½‘ã€‚

.. _è·¯ç½‘ç”Ÿäº§ä»£ç ç¤ºä¾‹:

ä½¿ç”¨è·¯ç½‘ç”Ÿäº§å·¥å…·ï¼Œå…ˆä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng



4.1. æŒ‡å®šçŸ©å½¢åŒºåŸŸ, åŸºäºçŸ©å½¢åŒºåŸŸéšæœºæ„é€ OD, è·å–è·¯ç½‘
`````````````````````````````````````````````````````

* åˆå§‹åŒ–NetReverseç±»
    flag_nameï¼šé¡¹ç›®åç§°ï¼Œå¿…é¡»æŒ‡å®šï¼›

    net_out_fldrï¼šæœ€ç»ˆè·¯ç½‘çš„å­˜å‚¨ç›®å½•ï¼Œå¿…é¡»æŒ‡å®šï¼›

    plain_crsï¼šè¦ä½¿ç”¨çš„å¹³é¢æŠ•å½±åæ ‡ç³»ï¼Œå¿…é¡»æŒ‡å®šã€‚

* è¯·æ±‚å‚æ•°
    key_listï¼šå¼€å‘è€…keyå€¼åˆ—è¡¨ï¼Œå¿…é¡»æŒ‡å®šï¼›

    binary_path_fldrï¼šè¯·æ±‚è·¯å¾„æºæ–‡ä»¶çš„å­˜å‚¨ç›®å½•ï¼Œå¿…é¡»æŒ‡å®šï¼›

    save_log_fileï¼šæ˜¯å¦ä¿å­˜æ—¥å¿—æ–‡ä»¶ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤Falseï¼›

    log_fldrï¼šæ—¥å¿—çš„å­˜å‚¨ç›®å½•ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤Noneï¼›

    min_lngï¼Œmin_latï¼šçŸ©å½¢åŒºåŸŸå·¦ä¸‹è§’ç»çº¬åº¦åæ ‡(GCJ-02åæ ‡)ï¼Œå¿…é¡»æŒ‡å®šï¼›

    wï¼Œhï¼šçŸ©å½¢åŒºåŸŸçš„å®½åº¦å’Œé«˜åº¦(ç±³)ï¼Œå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤å€¼2000ï¼Œ2000ï¼›

    od_typeï¼šç”ŸæˆODçš„ç±»å‹ï¼Œå¿…é¡»æŒ‡å®šï¼Œå«ä¹‰è§ï¼š`od_type`_ ï¼›

    od_numï¼Œgap_nï¼Œmin_od_lengthï¼šç”Ÿæˆçš„odæ•°ã€åˆ’åˆ†ç½‘æ ¼æ•°ã€æœ€å°çš„odç›´çº¿è·ç¦»é™åˆ¶ï¼Œéå¿…é¡»æŒ‡å®šï¼Œé»˜è®¤100ï¼Œ1000ï¼Œ1200ï¼›

    æŒ‡å®šçŸ©å½¢åŒºåŸŸçš„å·¦ä¸‹ç‚¹ç»çº¬åº¦åæ ‡(GCJ-02åæ ‡ç³»)ï¼Œä»¥åŠçŸ©å½¢åŒºåŸŸçš„å®½åº¦å’Œé•¿åº¦(å•ä½ç±³)ï¼Œå¿…é¡»æŒ‡å®šã€‚


æ‰€æœ‰å‚æ•°è§£é‡Šè§ :doc:`ç±»æ–¹æ³•æ±‡æ€»`


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š


.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_rectangle', net_out_fldr=r'./data/output/reverse/test_rectangle/',
                       plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=40)

        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_rectangle/',
                                     w=1500, h=1500, min_lng=126.665019, min_lat=45.747539, od_type='rand_od',
                                     od_num=200, gap_n=1000, min_od_length=800)

è¿è¡Œè¯¥ä»£ç åï¼Œå…ˆåœ¨ç›®å½•./data/output/request/test_rectangle/ä¸‹ç”Ÿæˆè·¯å¾„æºæ–‡ä»¶ï¼Œç„¶ååœ¨ç›®å½•./data/output/reverse/test_rectangle/ä¸‹ç”ŸæˆFinalLink.shpå’ŒFinalNode.shpæ–‡ä»¶


4.2. è‡ªå®šä¹‰é¢åŸŸæ–‡ä»¶, åŸºäºè‡ªå®šä¹‰åŒºåŸŸéšæœºæ„é€ OD, è·å–è·¯ç½‘
`````````````````````````````````````````````````````````


æˆ‘ä»¬é€šè¿‡è¯»å–diy_region.shpæ¥æŒ‡å®šæˆ‘ä»¬æ„é€ éšæœºODçš„åŒºåŸŸèŒƒå›´ï¼š

.. image:: _static/images/diy_region.png
    :align: center

-------------------------------------------------------

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_diy_region', net_out_fldr=r'./data/output/reverse/test_diy_region/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        target_region_gdf = gpd.read_file(r'./data/input/region/diy_region.shp')
        print(target_region_gdf)
        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_diy_region/',
                                     region_gdf=target_region_gdf, od_type='rand_od', gap_n=1000,
                                     min_od_length=1200, od_num=20)


4.3. è‡ªå®šä¹‰é¢åŸŸæ–‡ä»¶, åŸºäºå¤šä¸ªè‡ªå®šä¹‰åŒºåŸŸæ„é€ åŒºåŸŸ-åŒºåŸŸçš„OD, è·å–è·¯ç½‘
```````````````````````````````````````````````````````````````````````

è¯»å–äº¤é€šå°åŒºæ–‡ä»¶ï¼ŒæŒ‡å®šod_typeä¸ºregion_odï¼Œä¼šè‡ªåŠ¨æ„é€ ä¸¤ä¸¤åœ°å—å½¢å¿ƒä¹‹é—´çš„ODã€‚ä½¿ç”¨è¯¥æ–¹æ³•æ„é€ ODï¼Œéœ€è¦ç¡®ä¿é¢åŸŸæ–‡ä»¶ä¸­åŒ…å«region_idå­—æ®µã€‚


.. image:: _static/images/test_taz.png
    :align: center

-------------------------------------------------------


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_taz', net_out_fldr=r'./data/output/reverse/test_taz/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        target_region_gdf = gpd.read_file(r'./data/input/region/simple_taz.shp')
        print(target_region_gdf)
        nv.generate_net_from_request(key_list=['ä½ çš„Key'],
                                     log_fldr=r'./', save_log_file=True,
                                     binary_path_fldr=r'./data/output/request/test_taz/',
                                     region_gdf=target_region_gdf, od_type='region_od')


4.4. åŸºäºè·¯å¾„æºæ–‡ä»¶, è·å–è·¯ç½‘
```````````````````````````````````````````````````````````````

å¦‚æœå·²ç»æœ‰äº†è¯·æ±‚å¥½çš„è·¯å¾„æºæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥ä»è·¯å¾„æºæ–‡ä»¶ä¸­åˆ›å»ºè·¯ç½‘ï¼Œåªéœ€è¦æŒ‡å®šè·¯å¾„æºæ–‡ä»¶ç›®å½•å’Œè·¯å¾„æºæ–‡ä»¶åç§°åˆ—è¡¨

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_pickle', net_out_fldr=r'./data/output/reverse/test_pickle/',
                           plain_prj='EPSG:32650', save_tpr_link=True, angle_threshold=20)
        nv.generate_net_from_pickle(binary_path_fldr=r'./data/output/request/test_taz/',
                                    pickle_file_name_list=['14_test_taz_gd_path_1'])


4.5. åŸºäºè‡ªå®šä¹‰OD, è¿›è¡Œè·¯å¾„è¯·æ±‚è·å–è·¯ç½‘
```````````````````````````````````````````````````````````````

ä½ å¯ä»¥é€šè¿‡è‡ªå·±çš„ç›¸å…³ç®—æ³•å»æ„é€ ODï¼Œç¡®ä¿ODè¡¨ç¬¦åˆ `ODè¡¨è¦æ±‚`_ ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ODå»è¯·æ±‚è·¯å¾„ã€æ„é€ è·¯ç½‘

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        nv = ng.NetReverse(flag_name='test_diy_od', net_out_fldr=r'./data/output/reverse/test_diy_od/',
                           plain_prj='EPSG:32651', save_tpr_link=True, angle_threshold=20)
        nv.generate_net_from_request(binary_path_fldr=r'./data/output/request/test_diy_od/',
                                     key_list=['ä½ çš„Key'],
                                     od_file_path=r'./data/output/od/è‹å·å¸‚.csv', od_type='diy_od')

        # æˆ–è€…
        # diy_od_df = pd.read_csv(r'./data/output/od/è‹å·å¸‚.csv')
        # nv.generate_net_from_request(binary_path_fldr=r'./data/output/request/test_diy_od/',
        #                              key_list=['ä½ çš„Key'],
        #                              od_df=diy_od_df,
        #                              od_type='diy_od')


æœ¬ç®—æ³•åŒ…æä¾›äº†ä¸€ä¸ªä¾æ®GPSæ•°æ®æ¥ç”Ÿäº§è‡ªå®šä¹‰ODçš„æ¥å£ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        sz_test_gps_gdf = pd.read_csv(r'./data/output/gps/real_sz/TaxiData2.csv')
        sz_test_gps_gdf.rename(
            columns={'VehicleNum': 'agent_id', 'longitude': 'lng', 'latitude': 'lat', 'timestamp': 'time'}, inplace=True)
        nv = ng.NetReverse()
        gps_od, od_line = nv.generate_od_by_gps(gps_df=sz_test_gps_gdf, way_points_num=7)
        print(gps_od)
        gps_od.to_csv(r'./data/output/gps/real_sz/gps_od.csv', encoding='utf_8_sig', index=False)
        od_line.to_file(r'./data/output/gps/real_sz/gps_od.shp')

nv.generate_od_by_gpsçš„ç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š

è¿”å›çš„ç¬¬ä¸€ä¸ªæ•°æ®æ˜¯ODè¡¨(pd.DataFrame)ï¼Œç¬¬äºŒä¸ªæ•°æ®æ˜¯ODçº¿(gpd.GeoDataFrame)

* gps_dfã€time_unitã€time_formatã€plain_crs
    GPSæ•°æ®ç›¸å…³å‚æ•°ï¼Œä¸åœ°å›¾åŒ¹é…æ¥å£ä¸€æ ·çš„æ•°æ®è¦æ±‚

* group_gap_threshold
    æ—¶é—´é˜ˆå€¼ï¼Œå•ä½ç§’ï¼Œå¦‚æœå‰åGPSç‚¹çš„å®šä½æ—¶é—´è¶…è¿‡è¯¥é˜ˆï¼Œåˆ™åœ¨è¯¥ç‚¹å‡ºåˆ‡åˆ†ä¸»è¡Œç¨‹ï¼Œé»˜è®¤360s

* min_distance_threshold
    å­è¡Œç¨‹åˆ‡åˆ†è·ç¦»é˜ˆå€¼ï¼Œå•ä½ç±³ï¼Œé»˜è®¤10.0m

* dwell_accu_time
    æ—¶é—´é˜ˆå€¼ï¼Œç§’ï¼Œé»˜è®¤60ç§’

* n
    æ•´æ•°ï¼Œå¦‚æœè¶…è¿‡è¿ç»­nä¸ªgpsç‚¹çš„è·ç¦»å°äºmin_distance_threshold ä¸” æŒç»­æ—¶é—´è¶…è¿‡dwell_accu_timeï¼Œé‚£ä¹ˆè¯¥å¤„è¢«è¯†åˆ«ä¸ºåœç•™ç‚¹ï¼Œä»è¯¥å¤„åˆ‡åˆ†å­è¡Œç¨‹ï¼Œé»˜è®¤5

* way_points_num
    æ•´æ•°ï¼ŒODçš„é€”å¾„ç‚¹æ•°ç›®ï¼Œå¿…é¡»â‰¤9ï¼Œé»˜è®¤5ä¸ªé€”å¾„ç‚¹


4.6. åŸºäºå·²æœ‰è·¯ç½‘çº¿å±‚, ç”Ÿäº§ç‚¹å±‚
`````````````````````````````````````````

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚ï¼Œç¼ºå°‘æ‹“æ‰‘å…³è”å…³ç³»ä»¥åŠç‚¹å±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ„å»ºç‚¹å±‚ä»¥åŠæ·»åŠ çº¿å±‚çš„æ‹“æ‰‘å…³è”



ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # å¯¹link.shpçš„è¦æ±‚: åªéœ€è¦æœ‰geometryå­—æ®µå³å¯, ä½†æ˜¯geometryå­—æ®µçš„å‡ ä½•å¯¹è±¡å¿…é¡»ä¸ºLineStringç±»å‹(ä¸å…è®¸Zåæ ‡)
        nv = ng.NetReverse()
        link_gdf = gpd.read_file(r'./data/output/create_node/link.shp')
        print(link_gdf)
        new_link_gdf, new_node_gdf, node_group_status_gdf = nv.create_node_from_link(link_gdf=link_gdf, using_from_to=False,
                                                                                     update_link_field_list=['link_id',
                                                                                                             'from_node',
                                                                                                             'to_node',
                                                                                                             'length'],
                                                                                     plain_prj='EPSG:32651',
                                                                                     modify_minimum_buffer=0.7,
                                                                                     execute_modify=True,
                                                                                     ignore_merge_rule=True,
                                                                                     out_fldr=r'./data/output/create_node/')


4.7. åŸºäºå·²æœ‰æ ‡å‡†è·¯ç½‘, æ£€æŸ¥è·¯ç½‘çš„è”é€šæ€§å¹¶è¿›è¡Œä¿®å¤
`````````````````````````````````````````````````

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚å’Œç‚¹å±‚(ä¸”å­—æ®µå’Œæ‹“æ‰‘å…³è”å…³ç³»æ»¡è¶³æœ¬ç®—æ³•åŒ…çš„è¦æ±‚)ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ¥æ£€æŸ¥è·¯ç½‘çš„è”é€šæ€§


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        link_gdf = gpd.read_file(r'./data/input/net/test/sz/FinalLink.shp')
        node_gdf = gpd.read_file(r'./data/input/net/test/sz/FinalNode.shp')

        # net_file_typeæŒ‡çš„æ˜¯è¾“å‡ºè·¯ç½‘æ–‡ä»¶çš„ç±»å‹
        nv = ng.NetReverse(net_file_type='shp', conn_buffer=0.8, net_out_fldr=r'./data/input/net/test/sz/')
        new_link_gdf, new_node_gdf = nv.modify_conn(link_gdf=link_gdf, node_gdf=node_gdf, book_mark_name='sz_conn_test', generate_mark=True)

        print(new_link_gdf)
        print(new_node_gdf)

åœ¨net_out_fldrä¸‹ä¼šç”Ÿæˆè”é€šæ€§ä¿®å¤å®Œæˆåçš„è·¯ç½‘æ–‡ä»¶ä»¥åŠxmlç©ºé—´ä¹¦ç­¾æ–‡ä»¶ï¼Œå°†xmlæ–‡ä»¶å¯¼å…¥åˆ°QGISå¯ä»¥æŸ¥çœ‹ä¿®å¤çš„ç‚¹ä½æƒ…å†µä»¥ä¾¿æ’æŸ¥æ˜¯å¦æ‰€æœ‰ä¿®å¤éƒ½æ˜¯åˆç†çš„


ä»€ä¹ˆæ˜¯è”é€šæ€§ä¿®å¤ï¼Ÿ

.. image:: _static/images/conn_1.png
    :align: center

--------------------------------------------------------------------------------

.. image:: _static/images/conn_2.png
    :align: center

--------------------------------------------------------------------------------



4.8. æ¸…æ´—ä½ çš„è·¯ç½‘çº¿å±‚æ•°æ®
`````````````````````````````````````````````````

å¦‚æœä½ å·²ç»æœ‰äº†è·¯ç½‘çº¿å±‚æ•°æ®, ä½ å¯èƒ½æƒ³ä½¿ç”¨nv.create_node_from_linkå‡½æ•°æ¥ç”Ÿäº§ç‚¹å±‚ä»¥åŠç”Ÿäº§æ‹“æ‰‘å…³è”ä»¥å¾—åˆ°æ ‡å‡†çš„è·¯ç½‘æ•°æ®ï¼Œä½†æ˜¯nv.create_node_from_linkå¯èƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºä½ çš„è·¯ç½‘çº¿å±‚æ•°æ®å¯èƒ½åŒ…å«äº†Multiç±»å‹æˆ–è€…æ˜¯å¸¦æœ‰zåæ ‡æˆ–è€…æ˜¯çº¿å¯¹è±¡ä¸­å«æœ‰å¤§é‡çš„é‡å ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨nvç±»çš„é™æ€æ–¹æ³•clean_link_geoæ¥æ¶ˆé™¤zåæ ‡ä»¥åŠmultiç±»å‹


ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # è¯»å–æ•°æ®
        df = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')

        # å¤„ç†geometry
        link_gdf = ng.NetReverse.clean_link_geo(gdf=df, plain_crs='EPSG:32649', l_threshold=1.0)


4.9. è·¯æ®µåˆ’åˆ†
`````````````````````````````````````````````````

ä½ å·²ç»æœ‰äº†ä¸€å¥—linkå’Œnodeæ–‡ä»¶, ä½ å¸Œæœ›å¯¹linkå±‚è¿›è¡Œè·¯æ®µé‡å¡‘ï¼Œå³å°†é•¿åº¦å¤§äºL(m)çš„è·¯æ®µéƒ½è¿›æ‰“æ–­ï¼ŒåŒæ—¶ç‚¹å±‚æ•°æ®ä¹Ÿä¼šéšä¹‹è‡ªåŠ¨å˜åŒ–


åˆ’åˆ†å‰ï¼š

.. image:: _static/images/before_divide.png
    :align: center

--------------------------------------------------------------------------------

åˆ’åˆ†åï¼š

.. image:: _static/images/after_divide.png
    :align: center

--------------------------------------------------------------------------------

ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng


.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        link = gpd.read_file(r'./data/input/net/test/0317/link1.geojson')
        node = gpd.read_file(r'./data/input/net/test/0317/node1.geojson')

        nv = ng.NetReverse()
        # æ‰§è¡Œåˆ’åˆ†è·¯ç½‘
        # divide_l: æ‰€æœ‰é•¿åº¦å¤§äºdivide_lçš„è·¯æ®µéƒ½å°†æŒ‰ç…§divide_lè¿›è¡Œåˆ’åˆ†
        # min_l: åˆ’åˆ†åå¦‚æœå‰©ä¸‹çš„è·¯æ®µé•¿åº¦å°äºmin_l, é‚£ä¹ˆæ­¤æ¬¡åˆ’åˆ†å°†ä¸è¢«å…è®¸
        new_link, new_node = nv.divide_links(link_gdf=link, node_gdf=node, divide_l=50, min_l=5.0)

        new_link.to_file(r'./data/input/net/test/0317/divide_link.geojson', driver='GeoJSON', encoding='gbk')
        new_node.to_file(r'./data/input/net/test/0317/divide_node.geojson', driver='GeoJSON', encoding='gbk')


4.10. idé‡æ˜ å°„
`````````````````````````````````````````````````

ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å— ::

    import gotrackit.netreverse.NetGen as ng

å¦‚æœä½ çš„linkè¡¨çš„link_idæˆ–è€…nodeè¡¨çš„node_idæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•´æ•°, ä½¿ç”¨è¿™æ ·çš„è·¯ç½‘å­˜åœ¨é£é™©ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°è¿›è¡ŒIDé‡æ˜ å°„

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        l = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        n = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')
        print(l[['link_id', 'from_node', 'to_node']])
        print(n[['node_id']])
        nv = ng.NetReverse()
        nv.remapping_link_node_id(l, n)
        print(l[['link_id', 'from_node', 'to_node']])
        print(n[['node_id']])


4.11. è·¯ç½‘è·¯æ®µã€èŠ‚ç‚¹é‡å¡‘
`````````````````````````````````````````````````

ä½ å·²ç»æœ‰äº†ä¸€å¥—linkæ–‡ä»¶ï¼Œä½†æ˜¯å…¶å­˜åœ¨æŠ˜ç‚¹è”é€šæ€§é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š

.. image:: _static/images/before_redivide.jpg
    :align: center

--------------------------------------------------------------------------------


å¯ä»¥ä½¿ç”¨è¯¥æ¥å£è¿›è¡Œè·¯æ®µå’ŒèŠ‚ç‚¹çš„é‡å¡‘ä»¥åŠè”é€šæ€§çš„ä¼˜åŒ–ï¼Œä½ åªéœ€è¦è¾“å…¥ä¸€ä¸ªçº¿å±‚ï¼Œè¯¥å‡½æ•°ä¼šå¸®ä½ é‡å¡‘èŠ‚ç‚¹åˆ’åˆ†ä»¥åŠè·¯æ®µåˆ’åˆ†ï¼Œå¹¶ä¸”ä¿®å¤è”é€šæ€§

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        # è¯»å–æ•°æ®
        origin_link = gpd.read_file(r'./data/input/net/test/0402BUG/load/test_link.geojson')
        print(origin_link)

        # ä¸ºé˜²æ­¢çº¿å±‚çº¿å‹æœ‰é‡å¤ç‚¹ï¼Œå…ˆåšæ¸…æ´—
        origin_link = ng.NetReverse.clean_link_geo(gdf=origin_link, l_threshold=1.0, plain_crs='EPSG:32650')

        # multi_core_merge=Trueè¡¨ç¤ºå¯ç”¨å¤šè¿›ç¨‹è¿›è¡Œæ‹“æ‰‘ä¼˜åŒ–
        # merge_core_numè¡¨ç¤ºå¯ç”¨ä¸¤ä¸ªæ ¸
        nv = ng.NetReverse(net_out_fldr=r'./data/input/net/test/0402BUG/redivide',
                           plain_prj='EPSG:32650', flag_name='new_divide', multi_core_merge=True,
                           merge_core_num=2)

        # è·¯æ®µã€èŠ‚ç‚¹é‡æ–°åˆ’åˆ†ã€è”é€šæ€§ä¿®å¤ï¼Œæ–°çš„ç½‘ç»œæ–‡ä»¶åœ¨net_out_fldrä¸‹ç”Ÿæˆ
        nv.redivide_link_node(link_gdf=origin_link)


é‡å¡‘ä¿®å¤åï¼š

.. image:: _static/images/after_redivide.jpg
    :align: center

--------------------------------------------------------------------------------

å‡½æ•°æ–¹æ³•çš„ç›¸å…³å‚æ•°è§ :doc:`ç±»æ–¹æ³•æ±‡æ€»`


5. åœ°å›¾åŒ¹é…
----------------------------

5.1. æ‰€éœ€æ•°æ®
`````````````

ä½¿ç”¨åœ°å›¾åŒ¹é…æ¥å£ï¼Œä½ éœ€è¦å‡†å¤‡è·¯ç½‘æ•°æ®å’ŒGPSæ•°æ®ã€‚

åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š


.. image:: _static/images/MatchGraph.png
    :align: center

----------------------------------------


.. _åœ°å›¾åŒ¹é…ä»£ç ç¤ºä¾‹:

5.2. ä»£ç ç¤ºä¾‹
`````````````````

ç”¨åˆ°çš„æ•°æ®æ–‡ä»¶ä»Gitä»“åº“è·å–ï¼š`0327test.zip <https://github.com/zdsjjtTLG/TrackIt/tree/main/data>`_

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import pandas as pd
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':

        # 1.è¯»å–GPSæ•°æ®
        # è¿™æ˜¯ä¸€ä¸ªæœ‰10è¾†è½¦çš„GPSæ•°æ®çš„æ–‡ä»¶, å·²ç»åšè¿‡äº†æ•°æ®æ¸…æ´—ä»¥åŠè¡Œç¨‹åˆ‡åˆ†
        # ç”¨äºåœ°å›¾åŒ¹é…çš„GPSæ•°æ®éœ€è¦ç”¨æˆ·è‡ªå·±è¿›è¡Œæ¸…æ´—ä»¥åŠè¡Œç¨‹åˆ‡åˆ†
        gps_df = pd.read_csv(r'./data/output/gps/sample/0327sample.csv')
        print(gps_df)
        # gps_df = gps_df[gps_df['agent_id'] == 'xa_car_4']

        # 2.æ„å»ºä¸€ä¸ªnet, è¦æ±‚è·¯ç½‘çº¿å±‚å’Œè·¯ç½‘ç‚¹å±‚å¿…é¡»æ˜¯WGS-84, EPSG:4326 åœ°ç†åæ ‡ç³»
        my_net = Net(link_path=r'./data/input/net/xian/modifiedConn_link.shp',
                     node_path=r'./data/input/net/xian/modifiedConn_node.shp')
        my_net.init_net()  # netåˆå§‹åŒ–

        # 3. åŒ¹é…
        mpm = MapMatch(net=my_net, gps_df=gps_df, gps_buffer=100, flag_name='xa_sample',
               use_sub_net=True, use_heading_inf=True,
               omitted_l=6.0, del_dwell=True, dwell_l_length=25.0, dwell_n=1,
               lower_n=2, is_lower_f=True,
               is_rolling_average=True, window=3,
               dense_gps=False,
               export_html=True, export_geo_res=True, use_gps_source=False,
               html_fldr=r'./data/output/match_visualization/xa_sample',
               gps_radius=10.0)

        # ç¬¬ä¸€ä¸ªè¿”å›ç»“æœæ˜¯åŒ¹é…ç»“æœè¡¨
        # ç¬¬äºŒä¸ªæ˜¯å‘ç”Ÿè­¦å‘Šçš„è·¯æ®µèŠ‚ç‚¹ç¼–å·
        match_res, warn_info = mpm.execute()
        for may_error_agent in warn_info.keys():
            print(may_error_agent)
            print(warn_info[may_error_agent])
        print(match_res)
        match_res.to_csv(r'./data/output/match_visualization/xa_sample/match_res.csv', encoding='utf_8_sig', index=False)


åœ°å›¾åŒ¹é…æ¥å£çš„å®Œæ•´å‚æ•°è§£é‡Šï¼š

* flag_name
    æ ‡è®°å­—ç¬¦åç§°, ä¼šç”¨äºæ ‡è®°è¾“å‡ºçš„å¯è§†åŒ–æ–‡ä»¶, é»˜è®¤"test"

* net
    gotrackitè·¯ç½‘å¯¹è±¡, å¿…é¡»æŒ‡å®š

* use_sub_net
    æ˜¯å¦åœ¨å­ç½‘ç»œä¸Šè¿›è¡Œè®¡ç®—, é»˜è®¤True

* gps_df
    GPSæ•°æ®, å¿…é¡»æŒ‡å®š

* time_format
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿, é»˜è®¤"%Y-%m-%d %H:%M:%S"

* time_unit
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„å•ä½, å¦‚æœæ—¶é—´åˆ—æ˜¯æ•°å€¼(ç§’æˆ–è€…æ¯«ç§’,s æˆ–è€… ms), ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§è¯¥å‚æ•°æ„å»ºæ—¶é—´åˆ—, é»˜è®¤'s'

* gps_buffer
    GPSçš„æœç´¢åŠå¾„, å•ä½ç±³, æ„ä¸ºåªé€‰å–æ¯ä¸ªgpsç‚¹é™„è¿‘gps_bufferç±³èŒƒå›´å†…çš„è·¯æ®µä½œä¸ºå€™é€‰è·¯æ®µ, é»˜è®¤90.0m

* gps_route_buffer_gap
    åŠå¾„å¢é‡, gps_buffer + gps_route_buffer_gap çš„åŠå¾„èŒƒå›´ç”¨äºè®¡ç®—å­ç½‘ç»œ, é»˜è®¤25.0m

* max_increment_times
    å¢é‡æœç´¢æ¬¡æ•°, é»˜è®¤2

* increment_buffer
    å¢é‡åŠå¾„, é»˜è®¤20.0m

* top_k
    é€‰å–æ¯ä¸ªGPSç‚¹bufferèŒƒå›´å†…çš„æœ€è¿‘çš„top_kä¸ªè·¯æ®µï¼Œé»˜è®¤20

* beta
    è¯¥å€¼è¶Šå¤§, çŠ¶æ€è½¬ç§»æ¦‚ç‡å¯¹äºè·ç¦»(m)è¶Šä¸æ•æ„Ÿ, é»˜è®¤20.0m

* gps_sigma
    è¯¥å€¼è¶Šå¤§, å‘å°„æ¦‚ç‡å¯¹è·ç¦»(m)è¶Šä¸æ•æ„Ÿ, é»˜è®¤20.0m

* dis_para
    è·ç¦»(m)çš„æŠ˜å‡ç³»æ•°, é»˜è®¤0.1

* del_dwell
    æ˜¯å¦è¿›è¡Œåœç•™ç‚¹è¯†åˆ«å¹¶ä¸”åˆ é™¤åœç•™ç‚¹ï¼Œé»˜è®¤True

* dwell_l_length
    åœç•™ç‚¹è¯†åˆ«è·ç¦»é˜ˆå€¼, é»˜è®¤10m

* dwell_n
    è¶…è¿‡è¿ç»­dwell_nä¸ªç›¸é‚»GPSç‚¹çš„è·ç¦»å°äºdwell_l_lengthï¼Œé‚£ä¹ˆè¿™ä¸€ç»„ç‚¹å°±ä¼šè¢«è¯†åˆ«ä¸ºåœç•™ç‚¹ï¼Œé»˜è®¤2

* is_lower_f
    æ˜¯å¦å¯¹GPSæ•°æ®è¿›è¡Œæ•°æ®é™é¢‘ç‡, é€‚ç”¨äº: é«˜é¢‘-é«˜å®šä½è¯¯å·® GPSæ•°æ®, é»˜è®¤False

* lower_n
    é™é¢‘å€ç‡, é»˜è®¤2

* is_rolling_average
    æ˜¯å¦å¯ç”¨æ»‘åŠ¨çª—å£å¹³å‡å¯¹GPSæ•°æ®è¿›è¡Œé™å™ª, é»˜è®¤False

* window
    æ»‘åŠ¨çª—å£å¤§å°, é»˜è®¤2

* dense_gps
    æ˜¯å¦å¯¹GPSæ•°æ®è¿›è¡Œå¢å¯†, é»˜è®¤False

* dense_interval
    å½“ç›¸é‚»GPSç‚¹çš„ç›´çº¿è·ç¦»Lè¶…è¿‡dense_intervalå³è¿›è¡Œå¢å¯†, è¿›è¡Œ int(L / dense_interval) + 1  ç­‰åˆ†åŠ å¯†, é»˜è®¤80.0

.. image:: _static/images/gps_process.jpg
    :align: center

----------------------------------------

* use_heading_inf
    æ˜¯å¦åˆ©ç”¨GPSçš„å·®åˆ†æ–¹å‘å‘é‡ä¿®æ­£å‘å°„æ¦‚ç‡, é€‚ç”¨äº: ä½å®šä½è¯¯å·® GPSæ•°æ® æˆ–è€… ä½é¢‘å®šä½æ•°æ®(é…åˆåŠ å¯†å‚æ•°), é»˜è®¤False

* heading_para_array
    å·®åˆ†æ–¹å‘ä¿®æ­£å‚æ•°, é»˜è®¤np.array([1.0, 1.0, 1.0, 0.1, 0.00001, 0.00001, 0.00001, 0.000001, 0.000001])

* omitted_l
    å•ä½ç±³ï¼Œå¦‚æœå‰ååºGPSç‚¹çš„å¹³å‡è·ç¦»å°äºè¯¥å€¼ï¼Œåˆ™è®¤ä¸ºè¯¥GPSç‚¹çš„èˆªå‘è§’ä¸å‡†ç¡®ï¼Œä¸ä¼šåœ¨è¯¥ç‚¹åº”ç”¨èˆªå‘è§’é™åˆ¶ï¼Œé»˜è®¤6.0m

å¯¹æ–¹å‘ä¿®æ­£ç³»æ•°çš„è§£é‡Šï¼š

.. image:: _static/images/heading_para_1.png
    :align: center

----------------------------------------

.. image:: _static/images/heading_para_2.png
    :align: center

----------------------------------------

* export_html
    æ˜¯å¦è¾“å‡ºç½‘é¡µå¯è§†åŒ–ç»“æœhtmlæ–‡ä»¶, é»˜è®¤True

* export_all_agents
    æ˜¯å¦å°†æ‰€æœ‰agentçš„å¯è§†åŒ–å­˜å‚¨äºä¸€ä¸ªhtmlæ–‡ä»¶ä¸­

* export_geo_res
    æ˜¯å¦è¾“å‡ºåŒ¹é…ç»“æœçš„å‡ ä½•å¯è§†åŒ–æ–‡ä»¶, é»˜è®¤False

* visualization_cache_times
    æ¯åŒ¹é…å®Œvisualization_cache_timesè¾†è½¦å†è¿›è¡Œç»“æœçš„ç»Ÿä¸€å­˜å‚¨(å¯å¹¶å‘å­˜å‚¨), é»˜è®¤50

* multi_core_save
    æ˜¯å¦å¯ç”¨å¤šè¿›ç¨‹è¿›è¡Œç»“æœå­˜å‚¨ï¼Œé»˜è®¤False

* use_gps_source
    æ˜¯å¦åœ¨å¯è§†åŒ–ç»“æœä¸­ä½¿ç”¨GPSæºæ•°æ®è¿›è¡Œå±•ç¤º, é»˜è®¤False

* html_fldr
    ä¿å­˜å¯è§†åŒ–ç»“æœçš„æ–‡ä»¶(htmlæ–‡ä»¶å’Œgeojsonæ–‡ä»¶)ç›®å½•, é»˜è®¤å½“å‰ç›®å½•

* node_num_threshold
    é»˜è®¤2000

* multi_core
    æ˜¯å¦å¯ç”¨å¤šæ ¸åŒ¹é…, é»˜è®¤True, è¿™ä¸ªå¤šæ ¸åŒ¹é…æŒ‡çš„æ˜¯åœ¨å•æ¡è½¨è¿¹ä¸Šçš„å¤šè¿›ç¨‹åŒ¹é…

* core_num
    ç”¨å‡ ä¸ªæ ¸è¿›è¡ŒåŒ¹é…, é»˜è®¤1

* gps_radius
    HTMLå¯è§†åŒ–ä¸­GPSç‚¹çš„åŠå¾„å¤§å°ï¼Œå•ä½ç±³ï¼Œé»˜è®¤8ç±³


åœ°å›¾åŒ¹é…ç»“æœè¡¨å­—æ®µå«ä¹‰ä¸ºï¼š

.. csv-table:: åœ°å›¾åŒ¹é…ç»“æœè¡¨å­—æ®µè¯´æ˜
    :header: "å­—æ®µåç§°", "å­—æ®µå«ä¹‰", "å­—æ®µç±»å‹"
    :widths: 15, 15, 40

    "seq","gpsç‚¹çš„åºåˆ—ID","int"
    "sub_seq","gpsç‚¹çš„å­åºåˆ—ID, å¦‚æœå­åºåˆ—>0, è¯´æ˜è¯¥ç‚¹æ˜¯åœ¨åŒ¹é…åè¡¥å‡ºæ¥çš„ç‚¹, ç§°ä¹‹ä¸ºåè¡¥ç‚¹, ä¸ä¼šå»è®¡ç®—å…¶åœ¨ç›®æ ‡è·¯æ®µä¸Šçš„æŠ•å½±ç‚¹","int"
    "lng","gpsç‚¹çš„ç»åº¦, EPSG:4326","float"
    "lat","gpsç‚¹çš„çº¬åº¦, EPSG:4326","float"
    "geometry","gpsç‚¹çš„å‡ ä½•å¯¹è±¡","geometry"
    "prj_lng","gpsç‚¹åœ¨åŒ¹é…è·¯æ®µä¸ŠæŠ•å½±ç‚¹çš„ç»åº¦, EPSG:4326, åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","geometry"
    "prj_lat","gpsç‚¹åœ¨åŒ¹é…è·¯æ®µä¸ŠæŠ•å½±ç‚¹çš„çº¬åº¦, EPSG:4326, åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","geometry"
    "prj_geo","gpsåœ¨åŒ¹é…è·¯æ®µä¸ŠæŠ•å½±ç‚¹çš„å‡ ä½•å¯¹è±¡, åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","geometry"
    "dis_to_next","gpsæŠ•å½±ç‚¹ä¸ååºç›¸é‚»gpsæŠ•å½±ç‚¹çš„è·¯å¾„è·ç¦»(ä¸è€ƒè™‘åè¡¥ç‚¹), åè¡¥ç‚¹çš„è¯¥å€¼ä¸ºç©º","float"
    "time","gpså®šä½æ—¶é—´","datetime"
    "link_id","gpsåŒ¹é…è·¯æ®µçš„link_idï¼Œå¯¹åº”è·¯ç½‘çš„link_idå­—æ®µ","int"
    "from_node","gpsåŒ¹é…è·¯æ®µçš„èµ·å§‹èŠ‚ç‚¹(è¡¨å¾è¡Œè½¦æ–¹å‘èµ·ç‚¹)","int"
    "to_node","gpsåŒ¹é…è·¯æ®µçš„ç»ˆåˆ°èŠ‚ç‚¹(è¡¨å¾è¡Œè½¦æ–¹å‘ç»ˆç‚¹)","int"

å…³äºsub_seqï¼š

.. image:: _static/images/gps_segmentize.png
    :align: center

--------------------------------------------------------------------------------


åŒ¹é…ç»“æœHTMLå¯è§†åŒ–ï¼šæ‰“å¼€ç”Ÿæˆçš„htmlæ–‡ä»¶ï¼ŒæŒ‰ç…§ä¸‹å›¾ç‚¹å¼€æ—¶é—´è½´æ’­æ”¾å™¨

.. image:: _static/images/html_visualization.png
    :align: center

----------------------------------------


ç›¸å…³ç±»çš„å‚æ•°å’Œæ–¹æ³•å¯å‚è§ï¼š

- :doc:`ç±»æ–¹æ³•æ±‡æ€»`

6. å¸¸è§æŠ¥é”™ä»¥åŠè§£å†³æ–¹æ¡ˆ
----------------------------


6.1. æ„å»ºnetå¯¹è±¡é”™è¯¯æŠ¥åæ ‡ç³»ä¸åŒ¹é…
``````````````````````````````````````````````

.. image:: _static/images/bug_no_crs_error.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼š

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')

        link = link.to_crs('EPSG:4326')
        node = node.to_crs('EPSG:4326')

        my_net = Net(link_gdf=link, node_gdf=node)
        my_net.init_net()  # netåˆå§‹åŒ–


6.2. ä½¿ç”¨jupyteræŠ¥netå¯¹è±¡æ— planar_crså±æ€§
``````````````````````````````````````````````


.. image:: _static/images/bug_no_planar_crs.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨pycharm


6.3. pyogrio.errors.FieldError
``````````````````````````````````````````````

fionaç‰ˆæœ¬æˆ–è€…GDALç‰ˆæœ¬ä¸å…¼å®¹

.. image:: _static/images/fiona_bug.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼šç›¸å…³åœ°ç†ä¿¡æ¯åº“æ¨èä»¥ä¸‹ç‰ˆæœ¬ï¼š

gdal(3.8.4)ã€shapely(2.0.3)ã€fiona(1.9.5)ã€pyproj(3.6.1)ã€geopandas(0.14.3)ã€keplergl(0.3.2)


6.4.  shapelyåº“è­¦å‘Š
````````````````````````````````````````````````````````````````````````````````````````````````````````````````
å‡ºç°è­¦å‘Šä¿¡æ¯ï¼šRuntimeWarning:invalid value encountered in line locate pointreturn lib.line locate point(line, other)


è¯¥è­¦å‘Šä¼šå½±å“åŒ¹é…ç»“æœï¼Œå‡ºç°è¯¥è­¦å‘Šçš„åŸå› æ˜¯å› ä¸ºä½ çš„è·¯ç½‘çº¿å±‚çš„å‡ ä½•ä¸­æœ‰é‡å¤ç‚¹

.. image:: _static/images/dup_points_warning.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆï¼šå…ˆä½¿ç”¨è·¯ç½‘çº¿å±‚çš„æ¸…æ´—æ¥å£è¿›è¡Œé¢„å¤„ç†

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # è¯»å–æ•°æ®
        df = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')

        # å¤„ç†geometry
        link_gdf = ng.NetReverse.clean_link_geo(gdf=df, plain_crs='EPSG:32649', l_threshold=1.0)