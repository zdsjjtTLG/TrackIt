ğŸ›¢ï¸ æŠ¥é”™æ±‡æ€»
===================================

æ„å»ºnetå¯¹è±¡é”™è¯¯æŠ¥åæ ‡ç³»ä¸åŒ¹é…
--------------------------------------------------------

.. image:: _static/images/bug_no_crs_error.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼š

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—Net, MapMatch
    import geopandas as gpd
    from gotrackit.map.Net import Net
    from gotrackit.MapMatch import MapMatch


    if __name__ == '__main__':
        link = gpd.read_file(r'./data/input/net/xian/modifiedConn_link.shp')
        node = gpd.read_file(r'./data/input/net/xian/modifiedConn_node.shp')

        link = link.to_crs('EPSG:4326')
        node = node.to_crs('EPSG:4326')

        # å¦‚æœè¿˜æŠ¥é”™, å†åŠ ä¸‹é¢è¿™ä¸ª
        # link.crs.srs = 'EPSG:4326'
        # node.crs.srs = 'EPSG:4326'

        my_net = Net(link_gdf=link, node_gdf=node)
        my_net.init_net()  # netåˆå§‹åŒ–

ä½¿ç”¨jupyteræŠ¥netå¯¹è±¡æ— planar_crså±æ€§
--------------------------------------------------------


.. image:: _static/images/bug_no_planar_crs.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨pycharm


pyogrio.errors.FieldError
--------------------------------------------------------

fionaç‰ˆæœ¬æˆ–è€…GDALç‰ˆæœ¬ä¸å…¼å®¹

.. image:: _static/images/fiona_bug.png
    :align: center

--------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼šç›¸å…³åœ°ç†ä¿¡æ¯åº“æ¨èä»¥ä¸‹ç‰ˆæœ¬ï¼š

gdal(3.8.4)ã€shapely(2.0.3)ã€fiona(1.9.5)ã€pyproj(3.6.1)ã€geopandas(0.14.3)ã€keplergl(0.3.2)


shapelyåº“è­¦å‘Š
--------------------------------------------------------
å‡ºç°è­¦å‘Šä¿¡æ¯ï¼šRuntimeWarning:invalid value encountered in line locate pointreturn lib.line locate point(line, other)


è¯¥è­¦å‘Šä¼šå½±å“åŒ¹é…ç»“æœï¼Œå‡ºç°è¯¥è­¦å‘Šçš„åŸå› æ˜¯å› ä¸ºä½ çš„è·¯ç½‘çº¿å±‚çš„å‡ ä½•ä¸­æœ‰é‡å¤ç‚¹

.. image:: _static/images/dup_points_warning.png
    :align: center

--------------------------------------------------------


è§£å†³æ–¹æ¡ˆ-ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # æ–¹æ¡ˆ1ï¼šå»é™¤é‡å¤ç‚¹åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf['geometry'] = link_gdf['geometry'].remove_repeated_points(1e-6)


        # æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸…æ´—æ¥å£åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf = ng.NetReverse.clean_link_geo(gdf=link_gdf, plain_crs='EPSG:32649', l_threshold=1.0)


Invalid projection: EPSG:nan
--------------------------------------------------------

å¢ƒå¤–è·¯ç½‘æ„å»ºå¤±è´¥ï¼Œæ˜¯BUGï¼Œæ›´æ–°gotrackitåˆ°æœ€æ–°ç‰ˆæœ¬å³å¯è§£å†³

.. image:: _static/images/crs_error.png
    :align: center

--------------------------------------------------------


è¾“å‡ºçš„è·¯ç½‘æ–‡ä»¶å­—æ®µä¸­ï¼šä¸­æ–‡å˜ä¸ºä¹±ç 
--------------------------------------------------------
gotrackitå­˜å‚¨è·¯ç½‘æ–‡ä»¶æ—¶ï¼Œé»˜è®¤ç¼–ç ä¸ºgbkï¼Œä½ éœ€è¦æ£€æŸ¥ä½ çš„åŸå§‹è·¯ç½‘æ–‡ä»¶çš„ç¼–ç æ˜¯å¦ä¸ºgbk

--------------------------------------------------------------------------------------


è¾“å‡ºHTMLå¤±è´¥ï¼š Object of type bytes is not JSON serializable
----------------------------------------------------------------------------------------------------------------
å¯èƒ½æ˜¯è·¯ç½‘æ–‡ä»¶ç¼–ç é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹å›¾çš„é”™è¯¯åŸå› æ˜¯ï¼šgpd.read_file()è¯»å–è·¯ç½‘æ—¶æ²¡æœ‰æŒ‡å®šåˆé€‚çš„ç¼–ç ï¼Œå¯¼è‡´road_nameåˆ—æ˜¯bytesç±»å‹ï¼Œä½†æ˜¯gotrackitåœ¨è¾“å‡ºHTMLæ—¶ä¼šé»˜è®¤å°†ç”¨æˆ·è·¯ç½‘çš„æ‰€æœ‰å­—æ®µè¿›è¡Œè¾“å‡ºï¼Œæ‰€ä»¥å¯¼è‡´äº†è¾“å‡ºå¤±è´¥

.. image:: _static/images/json_serializable.png
    :align: center
--------------------------------------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼šè¯»å–shpæ–‡ä»¶æ—¶æŒ‡å®šæ­£ç¡®çš„ç¼–ç  æˆ–è€… åˆ é™¤æœ‰ç¼–ç é—®é¢˜çš„å­—æ®µå†æ„å»ºNet

gotrackitï¼šv0.3.1ä¼šå¯¹è¾“å‡ºHTMLçš„è·¯ç½‘å­—æ®µè¿›è¡Œé™åˆ¶ï¼Œåªè¾“å‡ºå…³é”®æ‹“æ‰‘å­—æ®µ


è®¡ç®—å‘å°„çŸ©é˜µå‡ºé”™:ValueError(cannot convert float NaN to integer )
-------------------------------------------------------------------------------------------------
è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºè·¯ç½‘çº¿å±‚ä¸­çº¿å‹æœ‰é‡å æŠ˜ç‚¹


.. image:: _static/images/dup_zd_error.png
    :align: center
--------------------------------------------------------------------------------------

è§£å†³æ–¹æ¡ˆ-ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':

        # æ–¹æ¡ˆ1ï¼šå»é™¤é‡å¤ç‚¹åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf['geometry'] = link_gdf['geometry'].remove_repeated_points(1e-6)


        # æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ¸…æ´—æ¥å£åå†æ„å»ºNet
        link_gdf = gpd.read_file(r'./data/output/request/0304/é“è·¯åŒçº¿20230131_84.shp')
        link_gdf = ng.NetReverse.clean_link_geo(gdf=link_gdf, plain_crs='EPSG:32649', l_threshold=1.0)

è·¯ç½‘è·å–æŠ¥é”™/åœ°å›¾åŒ¹é…æŠ¥é”™:ValueError: cannot insert node_id, already exists
--------------------------------------------------------------------------------------------------------
è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸ºgeopandasç‰ˆæœ¬ä¸ºæœ€æ–°1.0.0å¼•èµ·çš„ï¼Œæœ€æ–°ç‰ˆæœ¬å‚æ•°æœ‰äº†è¾ƒå¤§å˜åŠ¨ï¼Œgotrackitv0.3.5ç›®å‰è¿˜æ²¡æœ‰é’ˆå¯¹1.0.0åšæ›´æ–°


.. image:: _static/images/0630BUG.png
    :align: center
--------------------------------------------------------------------------------------

è§£å†³æ–¹æ¡ˆï¼š ä¸è¦ä½¿ç”¨æœ€æ–°ç‰ˆçš„geopandasï¼Œé™çº§åˆ°0.14.3


è¾“å‡ºHTMLå¤±è´¥ï¼šOne of the arguments is of incorrect type
----------------------------------------------------------------------------------------------------------------

.. image:: _static/images/html_error.jpg
    :align: center
--------------------------------------------------------------------------------------

å·²ç»å®šä½åˆ°é—®é¢˜ï¼Œç›®å‰æ­£åœ¨æµ‹è¯•é˜¶æ®µï¼Œé¢„è®¡0.3.7ä¿®å¤

å¦‚æœæœ€æ–°ç‰ˆæœ¬ä»ç„¶æŠ¥é”™ï¼Œé‚£å°±åº”è¯¥æ˜¯keplerçš„é—®é¢˜ï¼Œå»ºè®®é‡å¼€æ–°ç¯å¢ƒï¼ŒæŒ‰ç…§gotrackitçš„ä¾èµ–åº“ç‰ˆæœ¬è¿›è¡Œä¾èµ–åº“çš„é‡æ–°å®‰è£…


FutureWarning
--------------------------------------------------------
è¿™ä¸ªæ˜¯è­¦å‘Šï¼Œpandasæé†’ç”¨æˆ·æŸä¸ªæ–¹æ³•åœ¨æœªæ¥ä¼šè¢«èˆå¼ƒï¼Œå¯¹åŒ¹é…æ²¡æœ‰å½±å“ï¼Œå¦‚æœä¸æƒ³çœ‹åˆ°è¯¥è­¦å‘Šï¼Œå¯ä»¥åœ¨ä¸»ç¨‹åºåŠ ä¸Šä»¥ä¸‹ä»£ç ï¼š

.. code-block:: python
    :linenos:

    import pandas as pd

    if __name__ == '__main__':
        pd.set_option('future.no_silent_downcasting', True)


è¯¥è­¦å‘Šä¼šåœ¨0.3.6ç‰ˆæœ¬ä¸­é€šè¿‡ä¼˜åŒ–ä»£ç æ¥æ¶ˆé™¤


è¾“å‡ºHTMLæ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯å´æ²¡æœ‰è¾“å‡ºHTML
--------------------------------------------------------
ç”±äºæœ€åä¸€ä¸ªAgentçš„GPSæ•°æ®æ²¡æœ‰å…³è”åˆ°ä»»ä½•è·¯ç½‘ï¼Œç¨‹åºæå‰é€€å‡ºäº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¾“å‡ºHTML.

è§£å†³æ–¹æ¡ˆ1ï¼šåŒ¹é…å‰å…ˆå‰”é™¤å…³è”ä¸åˆ°ä»»ä½•è·¯ç½‘çš„GPSæ•°æ®

è§£å†³æ–¹æ¡ˆ2ï¼šæŒ‡å®šå‚æ•°visualization_cache_times = 1



redivide_link_nodeå‡½æ•°æŠ¥é”™
--------------------------------------------------------

.. image:: _static/images/redivide_link_node_bug.jpg
    :align: center
--------------------------------------------------------------------------------------


åŸå› ï¼šç”±äºè¾“å…¥çš„è·¯ç½‘çº¿å±‚ä¸­æœ‰èµ·ç»ˆç‚¹ç›¸åŒçš„link

è§£å†³æ–¹æ¡ˆï¼š

1.å…ˆå»é™¤è·¯ç½‘çº¿å±‚ä¸­ç›¸åŒèµ·ç»ˆç‚¹çš„linkï¼Œç„¶åreset_index()é‡è®¾ç´¢å¼•

2.ç­‰å¾…0.3.8ç‰ˆæœ¬æ›´æ–°


æŠ¥é”™ï¼šçº¿å±‚æœ‰é‡å¤ç‚¹-overlapping points
----------------------------------------------------------------------------------------------------------

åœ¨ä½¿ç”¨è·¯ç½‘ç›¸å…³å¤„ç†å‡½æ•°æ—¶å¦‚æœå‡ºç°ä»¥ä¸‹æŠ¥é”™ï¼š

link geometry has overlapping points, please use the redivide_link_node function to handle it

.. image:: _static/images/loop_error.png
    :align: center
--------------------------------------------------------------------------------------


è¿™ç§æƒ…å†µæ˜¯å› ä¸ºè·¯ç½‘çº¿å±‚æœ‰ç¯è·¯æˆ–è€…è‡ªç›¸äº¤çº¿æ®µï¼Œè¯·å¯¹çº¿å±‚å’Œç‚¹å±‚åšä»¥ä¸‹æ¸…æ´—åå†è¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œ(è¯¥æ­¥æ“ä½œåœ¨0.3.13ç‰ˆæœ¬ä¸­ä¼šæ•´åˆåˆ°cleanå‡½æ•°ä¸­)ï¼š

.. code-block:: python
    :linenos:


    if __name__ == '__main__':

        link_gdf = gpd.read_file(r'XXX')
        node_gdf = gpd.read_file(r'XXX')

        # åˆ é™¤è‡ªç›¸äº¤å¯¹è±¡å’Œç¯è·¯
        link_gdf.reset_index(inplace=True, drop=True)
        link_gdf.drop(index=link_gdf[~link_gdf['geometry'].is_simple].index, inplace=True, axis=0)
        link_gdf.drop(index=link_gdf[link_gdf['from_node'] == link_gdf['to_node']].index, inplace=True, axis=0)
        link_gdf.reset_index(inplace=True, drop=True)

        # ç»Ÿä¸€èŠ‚ç‚¹å±‚
        node_gdf.reset_index(inplace=True, drop=True)
        used_node = set(link_gdf['from_node']) | set(link_gdf['to_node'])
        node_gdf.drop(index=node_gdf[~node_gdf['node_id'].isin(used_node)].index, inplace=True, axis=0)
        node_gdf.reset_index(inplace=True, drop=True)
