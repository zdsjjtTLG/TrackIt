ğŸŒ æ—¶ç©ºå¯è§†åŒ–
===================================

gotrackitä¸­æä¾›äº†å¯¹kepleréƒ¨åˆ†å¯è§†åŒ–åŠŸèƒ½çš„å°è£…ï¼Œä½¿ç”¨KeplerVisç±»å³å¯è½»æ¾è¿›è¡Œç½‘é¡µç«¯çš„åŠ¨æ€å¯è§†åŒ–ã€‚

KeplerVisç±»æ¦‚è¿°
--------------------------------------------

å¼•å…¥KeplerVis ::

    from gotrackit.visualization import KeplerVis

ç„¶åæ„å»ºKeplerViså®ä¾‹ ::

    kv = KeplerVis(map_style='dark)


KeplerVisçš„åˆå§‹åŒ–å‚æ•°ä¸ºï¼š

* zoom
    int, ç¼©æ”¾å±‚çº§, é»˜è®¤15

* cen_loc
    list or tuple, åœ°å›¾ä¸­å¿ƒç‚¹ç»çº¬åº¦åæ ‡ï¼Œé»˜è®¤[108.9437, 34.231]

* show_roads
    bool, æ˜¯å¦åœ¨åº•å›¾ä¸Šæ˜¾ç¤ºè·¯ç½‘å›¾å±‚ï¼Œé»˜è®¤False

* map_style
    str, åœ°å›¾é£æ ¼, é»˜è®¤dark, å¯é€‰dark, light, muted, muted_night, satellite
    å…¶ä¸­satelliteæ˜¯å«æ˜Ÿåº•å›¾

æ·»åŠ ç‚¹å›¾å±‚
--------------------------------------------

ä½¿ç”¨KeplerVisç±»æä¾›çš„add_point_layerå³å¯ä¸ºåº•å›¾åŠ ä¸Šä¸€ä¸ªç‚¹å±‚

.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—
    import pandas as pd
    from gotrackit.visualization import KeplerVis

    if __name__ == '__main__':

        # è¯»å–ç‚¹å±‚æ–‡ä»¶æ•°æ®
        point_df = pd.read_csv(r'p.csv')

        # æ–°å»ºKeplerVisç±»
        kv = KeplerVis()

        # æ·»åŠ ç‚¹å±‚
        kv.add_point_layer(data=point_df, lng_field='lng', lat_field='lat', set_avg_zoom=True)

        # è¾“å‡ºHTMLåˆ°æœ¬åœ°
        # æ­¤å‡½æ•°ä¹Ÿä¼šè¿”å›ä¸€ä¸ªmapå¯¹è±¡ï¼Œå¯åœ¨jupyterç¯å¢ƒä¸‹è¿›è¡Œäº¤äº’å¼æ“ä½œ
        map = kv.export_html(height=600, out_fldr=r'./', file_name='point')

add_point_layeråŠŸèƒ½å‚æ•°ï¼š

* data
    pd.DataFrameï¼Œç‚¹å±‚å›¾å±‚æ•°æ®ï¼Œå¿…å¡«å‚æ•°

* lng_field
    str, ç»åº¦å­—æ®µ, é»˜è®¤'lng'

* lat_field
    str, çº¬åº¦å­—æ®µ, é»˜è®¤'lat'

* altitude_field
    str, é«˜ç¨‹å­—æ®µ, é»˜è®¤None

* layer_id
    str, å›¾å±‚ID, é»˜è®¤point-1, è‹¥æœ‰å¤šä¸ªpointå›¾å±‚, é»˜è®¤point-1, point-2,...é€’å¢

* radius
    float, ç‚¹åŠå¾„å¤§å°, é»˜è®¤3.0

* color
    list, ç‚¹çš„å¡«å……é¢œè‰²(RGBè‰²å€¼), é»˜è®¤[65, 72, 88]

* set_avg_zoom
    bool, æ˜¯å¦è‡ªåŠ¨å®šä½ä¸­å¿ƒç‚¹, é»˜è®¤True

ï¼ˆå¯é€‰ï¼‰è‹¥æ•°æ®ä¸­åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œè¯·æŒ‡å®šæ—¶é—´åˆ—æ ¼å¼å‚æ•°ï¼š

* time_field
    str, æ—¶é—´åˆ—å­—æ®µåç§°ï¼Œé»˜è®¤None

* time_format
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿, é»˜è®¤"%Y-%m-%d %H:%M:%S"ï¼Œå¯ä»¥å‚ç…§pandasä¸­pd.to_datetime()å‡½æ•°çš„formatå‚æ•°

    å‚è€ƒï¼š`pd.to_datetimeè§£é‡Š <https://pandas.pydata.org/pandas-docs/version/0.20/generated/pandas.to_datetime.html#>`_ã€`ISO_8601 <https://en.wikipedia.org/wiki/ISO_8601>`_

* time_unit
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„å•ä½, å¦‚æœæ—¶é—´åˆ—æ˜¯æ•°å€¼(ç§’æˆ–è€…æ¯«ç§’,s æˆ–è€… ms), ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§è¯¥å‚æ•°æ„å»ºæ—¶é—´åˆ—, é»˜è®¤'s'ã€‚Gotrackitä¼šå…ˆå°è¯•ä½¿ç”¨time_formatè¿›è¡Œæ—¶é—´åˆ—æ„å»ºï¼Œå¦‚æœå¤±è´¥ä¼šå†æ¬¡å°è¯•ä½¿ç”¨time_unitè¿›è¡Œæ—¶é—´åˆ—æ„å»º


* speed
    float, æ—¶é—´åŠ¨ç”»æ’­æ”¾é€Ÿåº¦, é»˜è®¤0.3



æ·»åŠ geoå›¾å±‚
--------------------------------------------

ä½¿ç”¨KeplerVisç±»æä¾›çš„add_geo_layerå³å¯ä¸ºåº•å›¾åŠ ä¸Šä»»ä½•ä¸€ä¸ªå‡ ä½•å›¾å±‚


.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—
    import geopandas as gpd
    from gotrackit.visualization import KeplerVis

    if __name__ == '__main__':

        # è¯»å–å‡ ä½•æ–‡ä»¶
        region_df = gpd.read_file(r'region.shp')

        # æ–°å»ºKeplerVisç±»
        kv = KeplerVis()

        # æ·»åŠ ç‚¹å±‚
        kv.add_geo_layer(data=region_df, set_avg_zoom=True)

        # è¾“å‡ºHTMLåˆ°æœ¬åœ°
        # æ­¤å‡½æ•°ä¹Ÿä¼šè¿”å›ä¸€ä¸ªmapå¯¹è±¡ï¼Œå¯åœ¨jupyterç¯å¢ƒä¸‹è¿›è¡Œäº¤äº’å¼æ“ä½œ
        map = kv.export_html(height=600, out_fldr=r'./', file_name='region')

add_geo_layeråŠŸèƒ½å‚æ•°ï¼š


* data
    gpd.GeoDataFrameï¼Œå‡ ä½•å›¾å±‚æ•°æ®ï¼Œå¿…å¡«å‚æ•°

* layer_id
    str, å›¾å±‚ID, é»˜è®¤geo-1, è‹¥æœ‰å¤šä¸ªgeoå›¾å±‚, é»˜è®¤geo-1,geo-2,...é€’å¢

* width
    float, æ˜¾ç¤ºå®½åº¦

* color
    list, ç‚¹çš„å¡«å……é¢œè‰²(RGBè‰²å€¼), é»˜è®¤[65, 72, 88]

* stroke_color
    list, è¾¹ç¼˜å¡«å……é¢œè‰²(RGBè‰²å€¼), é»˜è®¤[65, 72, 88]

* set_avg_zoom
    bool, æ˜¯å¦è‡ªåŠ¨å®šä½ä¸­å¿ƒç‚¹, é»˜è®¤True

ï¼ˆå¯é€‰ï¼‰è‹¥æ•°æ®ä¸­åŒ…å«æ—¶é—´ä¿¡æ¯ï¼Œè¯·æŒ‡å®šæ—¶é—´åˆ—æ ¼å¼å‚æ•°ï¼š

* time_field
    str, æ—¶é—´åˆ—å­—æ®µåç§°ï¼Œé»˜è®¤None

* time_format
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿, é»˜è®¤"%Y-%m-%d %H:%M:%S"ï¼Œå¯ä»¥å‚ç…§pandasä¸­pd.to_datetime()å‡½æ•°çš„formatå‚æ•°

    å‚è€ƒï¼š`pd.to_datetimeè§£é‡Š <https://pandas.pydata.org/pandas-docs/version/0.20/generated/pandas.to_datetime.html#>`_ã€`ISO_8601 <https://en.wikipedia.org/wiki/ISO_8601>`_

* time_unit
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„å•ä½, å¦‚æœæ—¶é—´åˆ—æ˜¯æ•°å€¼(ç§’æˆ–è€…æ¯«ç§’,s æˆ–è€… ms), ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§è¯¥å‚æ•°æ„å»ºæ—¶é—´åˆ—, é»˜è®¤'s'ã€‚Gotrackitä¼šå…ˆå°è¯•ä½¿ç”¨time_formatè¿›è¡Œæ—¶é—´åˆ—æ„å»ºï¼Œå¦‚æœå¤±è´¥ä¼šå†æ¬¡å°è¯•ä½¿ç”¨time_unitè¿›è¡Œæ—¶é—´åˆ—æ„å»º


* speed
    float, æ—¶é—´åŠ¨ç”»æ’­æ”¾é€Ÿåº¦, é»˜è®¤0.3



æ·»åŠ è·¯å¾„åŠ¨ç”»å›¾å±‚
--------------------------------------------

ä½¿ç”¨KeplerVisç±»æä¾›çš„add_trip_layerå³å¯ä¸ºåº•å›¾åŠ ä¸Šä¸€ä¸ªè·¯å¾„åŠ¨ç”»å›¾å±‚ï¼Œæ‰€éœ€æ•°æ®å¿…é¡»è¦åŒ…å«åæ ‡åˆ—ä¿¡æ¯(æ”¯æŒ3ç»´åæ ‡)ä»¥åŠæ—¶é—´åˆ—ä¿¡æ¯ï¼š`è·¯å¾„åŠ¨ç”»æ ·ä¾‹æ•°æ® <https://github.com/zdsjjtTLG/TrackIt/tree/main/data/input/Trip-Example-Data>`_


.. image:: _static/images/kvs/hk_trip.gif
    :align: center

--------------------------------------------------------------------------------



.. code-block:: python
    :linenos:

    # 1. ä»gotrackitå¯¼å…¥ç›¸å…³æ¨¡å—
    import pandas as pd
    from gotrackit.visualization import KeplerVis

    if __name__ == '__main__':

        # è¯»å–å‡ ä½•æ–‡ä»¶
        trip_df = pd.read_csv(r'trip.csv')

        # æ–°å»ºKeplerVisç±»
        kv = KeplerVis()

        # æ·»åŠ ç‚¹å±‚
        kv.add_trip_layer(trip_df, lng_field='lng', lat_field='lat')

        # è¾“å‡ºHTMLåˆ°æœ¬åœ°
        # æ­¤å‡½æ•°ä¹Ÿä¼šè¿”å›ä¸€ä¸ªmapå¯¹è±¡ï¼Œå¯åœ¨jupyterç¯å¢ƒä¸‹è¿›è¡Œäº¤äº’å¼æ“ä½œ
        map = kv.export_html(height=600, out_fldr=r'./', file_name='trip')

add_trip_layeråŠŸèƒ½å‚æ•°ï¼š

* data
    pd.DataFrameï¼Œè½¨è¿¹æ•°æ®

* lng_field
    str, ç»åº¦å­—æ®µ, é»˜è®¤'lng'

* lat_field
    str, çº¬åº¦å­—æ®µ, é»˜è®¤'lat'

* altitude_field
    str, é«˜ç¨‹å­—æ®µ, é»˜è®¤None(å³é»˜è®¤ä¸å¯ç”¨ä¸‰ç»´åæ ‡)

* layer_id
    str, å›¾å±‚ID, é»˜è®¤trip-1, è‹¥æœ‰å¤šä¸ªtripå›¾å±‚, é»˜è®¤trip-1,trip-2,...é€’å¢

* set_avg_zoom
    bool, æ˜¯å¦è‡ªåŠ¨å®šä½ä¸­å¿ƒç‚¹, é»˜è®¤True

* thickness
    float, è½¨è¿¹çš„æ˜¾ç¤ºå®½åº¦, é»˜è®¤2.0

* opacity
    floatï¼Œè½¨è¿¹çš„é€æ˜åº¦

* color
    list, è½¨è¿¹çš„é¢œè‰²(RGBè‰²å€¼), é»˜è®¤[241, 225, 37]

* trail_length
    float, è·¯å¾„æ‹–å°¾é•¿åº¦, é»˜è®¤120

* time_format
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¨¡æ¿, é»˜è®¤"%Y-%m-%d %H:%M:%S"ï¼Œå¯ä»¥å‚ç…§pandasä¸­pd.to_datetime()å‡½æ•°çš„formatå‚æ•°

    å‚è€ƒï¼š`pd.to_datetimeè§£é‡Š <https://pandas.pydata.org/pandas-docs/version/0.20/generated/pandas.to_datetime.html#>`_ã€`ISO_8601 <https://en.wikipedia.org/wiki/ISO_8601>`_

* time_unit
    GPSæ•°æ®ä¸­æ—¶é—´åˆ—çš„å•ä½, å¦‚æœæ—¶é—´åˆ—æ˜¯æ•°å€¼(ç§’æˆ–è€…æ¯«ç§’,s æˆ–è€… ms), ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‰ç…§è¯¥å‚æ•°æ„å»ºæ—¶é—´åˆ—, é»˜è®¤'s'ã€‚Gotrackitä¼šå…ˆå°è¯•ä½¿ç”¨time_formatè¿›è¡Œæ—¶é—´åˆ—æ„å»ºï¼Œå¦‚æœå¤±è´¥ä¼šå†æ¬¡å°è¯•ä½¿ç”¨time_unitè¿›è¡Œæ—¶é—´åˆ—æ„å»º


å›¾å±‚å åŠ ä¸åœ°å›¾è¾“å‡º
--------------------------------------------

å åŠ å¤šä¸ªå›¾å±‚ï¼š

.. code-block:: python
    :linenos:

    if __name__ == '__main__':
        kv.add_point_layer(point_df, lng_field='lng', lat_field='lat')
        kv.add_geo_layer(region_gdf)
        kv.add_trip_layer(trip_df, lng_field='lng', lat_field='lat')
        map = kv.export_html(height=600, out_fldr=r'./', file_name='map')
